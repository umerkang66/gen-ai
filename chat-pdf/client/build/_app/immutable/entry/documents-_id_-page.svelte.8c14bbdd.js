var ts=Object.defineProperty;var es=(ot,f,z)=>f in ot?ts(ot,f,{enumerable:!0,configurable:!0,writable:!0,value:z}):ot[f]=z;var Dt=(ot,f,z)=>(es(ot,typeof f!="symbol"?f+"":f,z),z),he=(ot,f,z)=>{if(!f.has(ot))throw TypeError("Cannot "+z)};var m=(ot,f,z)=>(he(ot,f,"read from private field"),z?z.call(ot):f.get(ot)),Z=(ot,f,z)=>{if(f.has(ot))throw TypeError("Cannot add the same private member more than once");f instanceof WeakSet?f.add(ot):f.set(ot,z)},pt=(ot,f,z,p)=>(he(ot,f,"write to private field"),p?p.call(ot,z):f.set(ot,z),z),ie=(ot,f,z,p)=>({set _(T){pt(ot,f,T,z)},get _(){return m(ot,f,p)}}),lt=(ot,f,z)=>(he(ot,f,"access private method"),z);import{S as SvelteComponent,i as init,s as safe_not_equal,k as element,l as claim_element,m as children,h as detach,n as attr,p as set_style,b as insert_hydration,E as append_hydration,C as noop,o as onMount,_ as onDestroy,w as binding_callbacks,y as create_component,a as space,e as empty,z as claim_component,c as claim_space,A as mount_component,d as transition_out,f as check_outros,g as transition_in,B as destroy_component,v as group_outros,q as text,r as claim_text,u as set_data}from"../chunks/index.2d05c76a.js";import{b as beforeNavigate}from"../chunks/navigation.b59769ff.js";import{r as resetAll,s as sendMessage,C as ChatPanel}from"../chunks/ChatPanel.15e5e9cd.js";import{b as getAugmentedNamespace}from"../chunks/axios.4b626cb3.js";import{A as AuthGuard}from"../chunks/AuthGuard.6b78fbea.js";function commonjsRequire(ot){throw new Error('Could not dynamically require "'+ot+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var pdf={exports:{}};const __viteBrowserExternal={},__viteBrowserExternal$1=Object.freeze(Object.defineProperty({__proto__:null,default:__viteBrowserExternal},Symbol.toStringTag,{value:"Module"})),require$$5=getAugmentedNamespace(__viteBrowserExternal$1);(function(module,exports){(function(f,z){module.exports=z()})(globalThis,()=>(()=>{var __webpack_modules__=[,(ot,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.VerbosityLevel=f.Util=f.UnknownErrorException=f.UnexpectedResponseException=f.TextRenderingMode=f.RenderingIntentFlag=f.PermissionFlag=f.PasswordResponses=f.PasswordException=f.PageActionEventType=f.OPS=f.MissingPDFException=f.MAX_IMAGE_SIZE_TO_CACHE=f.LINE_FACTOR=f.LINE_DESCENT_FACTOR=f.InvalidPDFException=f.ImageKind=f.IDENTITY_MATRIX=f.FormatError=f.FeatureTest=f.FONT_IDENTITY_MATRIX=f.DocumentActionEventType=f.CMapCompressionType=f.BaseException=f.BASELINE_FACTOR=f.AnnotationType=f.AnnotationStateModelType=f.AnnotationReviewState=f.AnnotationReplyType=f.AnnotationMode=f.AnnotationMarkedState=f.AnnotationFlag=f.AnnotationFieldFlag=f.AnnotationEditorType=f.AnnotationEditorPrefix=f.AnnotationEditorParamsType=f.AnnotationBorderStyleType=f.AnnotationActionEventType=f.AbortException=void 0,f.assert=yt,f.bytesToString=k,f.createPromiseCapability=Pt,f.createValidAbsoluteUrl=c,f.getModificationDate=At,f.getVerbosityLevel=ft,f.info=nt,f.isArrayBuffer=gt,f.isArrayEqual=Et,f.objectFromMap=x,f.objectSize=b,f.setVerbosityLevel=st,f.shadow=h,f.string32=o,f.stringToBytes=e,f.stringToPDFString=ut,f.stringToUTF8String=ct,f.unreachable=bt,f.utf8StringToString=mt,f.warn=dt;const z=[1,0,0,1,0,0];f.IDENTITY_MATRIX=z;const p=[.001,0,0,.001,0,0];f.FONT_IDENTITY_MATRIX=p;const T=1e7;f.MAX_IMAGE_SIZE_TO_CACHE=T;const $=1.35;f.LINE_FACTOR=$;const G=.35;f.LINE_DESCENT_FACTOR=G;const et=G/$;f.BASELINE_FACTOR=et;const I={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256};f.RenderingIntentFlag=I;const S={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3};f.AnnotationMode=S;const g="pdfjs_internal_editor_";f.AnnotationEditorPrefix=g;const w={DISABLE:-1,NONE:0,FREETEXT:3,INK:15};f.AnnotationEditorType=w;const C={FREETEXT_SIZE:1,FREETEXT_COLOR:2,FREETEXT_OPACITY:3,INK_COLOR:11,INK_THICKNESS:12,INK_OPACITY:13};f.AnnotationEditorParamsType=C;const y={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048};f.PermissionFlag=y;const d={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4};f.TextRenderingMode=d;const _={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3};f.ImageKind=_;const s={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26};f.AnnotationType=s;const r={MARKED:"Marked",REVIEW:"Review"};f.AnnotationStateModelType=r;const P={MARKED:"Marked",UNMARKED:"Unmarked"};f.AnnotationMarkedState=P;const R={ACCEPTED:"Accepted",REJECTED:"Rejected",CANCELLED:"Cancelled",COMPLETED:"Completed",NONE:"None"};f.AnnotationReviewState=R;const A={GROUP:"Group",REPLY:"R"};f.AnnotationReplyType=A;const t={INVISIBLE:1,HIDDEN:2,PRINT:4,NOZOOM:8,NOROTATE:16,NOVIEW:32,READONLY:64,LOCKED:128,TOGGLENOVIEW:256,LOCKEDCONTENTS:512};f.AnnotationFlag=t;const l={READONLY:1,REQUIRED:2,NOEXPORT:4,MULTILINE:4096,PASSWORD:8192,NOTOGGLETOOFF:16384,RADIO:32768,PUSHBUTTON:65536,COMBO:131072,EDIT:262144,SORT:524288,FILESELECT:1048576,MULTISELECT:2097152,DONOTSPELLCHECK:4194304,DONOTSCROLL:8388608,COMB:16777216,RICHTEXT:33554432,RADIOSINUNISON:33554432,COMMITONSELCHANGE:67108864};f.AnnotationFieldFlag=l;const a={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5};f.AnnotationBorderStyleType=a;const n={E:"Mouse Enter",X:"Mouse Exit",D:"Mouse Down",U:"Mouse Up",Fo:"Focus",Bl:"Blur",PO:"PageOpen",PC:"PageClose",PV:"PageVisible",PI:"PageInvisible",K:"Keystroke",F:"Format",V:"Validate",C:"Calculate"};f.AnnotationActionEventType=n;const u={WC:"WillClose",WS:"WillSave",DS:"DidSave",WP:"WillPrint",DP:"DidPrint"};f.DocumentActionEventType=u;const E={O:"PageOpen",C:"PageClose"};f.PageActionEventType=E;const i={ERRORS:0,WARNINGS:1,INFOS:5};f.VerbosityLevel=i;const M={NONE:0,BINARY:1};f.CMapCompressionType=M;const V={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91};f.OPS=V;const Y={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};f.PasswordResponses=Y;let Q=i.WARNINGS;function st(F){Number.isInteger(F)&&(Q=F)}function ft(){return Q}function nt(F){Q>=i.INFOS&&console.log(`Info: ${F}`)}function dt(F){Q>=i.WARNINGS&&console.log(`Warning: ${F}`)}function bt(F){throw new Error(F)}function yt(F,B){F||bt(B)}function U(F){if(!F)return!1;switch(F.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function c(F,B=null,W=null){if(!F)return null;try{if(W&&typeof F=="string"){if(W.addDefaultProtocol&&F.startsWith("www.")){const Ct=F.match(/\./g);Ct&&Ct.length>=2&&(F=`http://${F}`)}if(W.tryConvertEncoding)try{F=ct(F)}catch{}}const _t=B?new URL(F,B):new URL(F);if(U(_t))return _t}catch{}return null}function h(F,B,W,_t=!1){return Object.defineProperty(F,B,{value:W,enumerable:!_t,configurable:!0,writable:!1}),W}const v=function(){function B(W,_t){this.constructor===B&&bt("Cannot initialize BaseException."),this.message=W,this.name=_t}return B.prototype=new Error,B.constructor=B,B}();f.BaseException=v;class j extends v{constructor(B,W){super(B,"PasswordException"),this.code=W}}f.PasswordException=j;class D extends v{constructor(B,W){super(B,"UnknownErrorException"),this.details=W}}f.UnknownErrorException=D;class q extends v{constructor(B){super(B,"InvalidPDFException")}}f.InvalidPDFException=q;class H extends v{constructor(B){super(B,"MissingPDFException")}}f.MissingPDFException=H;class K extends v{constructor(B,W){super(B,"UnexpectedResponseException"),this.status=W}}f.UnexpectedResponseException=K;class X extends v{constructor(B){super(B,"FormatError")}}f.FormatError=X;class L extends v{constructor(B){super(B,"AbortException")}}f.AbortException=L;function k(F){(typeof F!="object"||F===null||F.length===void 0)&&bt("Invalid argument for bytesToString");const B=F.length,W=8192;if(B<W)return String.fromCharCode.apply(null,F);const _t=[];for(let Ct=0;Ct<B;Ct+=W){const J=Math.min(Ct+W,B),ht=F.subarray(Ct,J);_t.push(String.fromCharCode.apply(null,ht))}return _t.join("")}function e(F){typeof F!="string"&&bt("Invalid argument for stringToBytes");const B=F.length,W=new Uint8Array(B);for(let _t=0;_t<B;++_t)W[_t]=F.charCodeAt(_t)&255;return W}function o(F){return String.fromCharCode(F>>24&255,F>>16&255,F>>8&255,F&255)}function b(F){return Object.keys(F).length}function x(F){const B=Object.create(null);for(const[W,_t]of F)B[W]=_t;return B}function O(){const F=new Uint8Array(4);return F[0]=1,new Uint32Array(F.buffer,0,1)[0]===1}function N(){try{return new Function(""),!0}catch{return!1}}class it{static get isLittleEndian(){return h(this,"isLittleEndian",O())}static get isEvalSupported(){return h(this,"isEvalSupported",N())}static get isOffscreenCanvasSupported(){return h(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator>"u"?h(this,"platform",{isWin:!1,isMac:!1}):h(this,"platform",{isWin:navigator.platform.includes("Win"),isMac:navigator.platform.includes("Mac")})}}f.FeatureTest=it;const tt=[...Array(256).keys()].map(F=>F.toString(16).padStart(2,"0"));class rt{static makeHexColor(B,W,_t){return`#${tt[B]}${tt[W]}${tt[_t]}`}static scaleMinMax(B,W){let _t;B[0]?(B[0]<0&&(_t=W[0],W[0]=W[1],W[1]=_t),W[0]*=B[0],W[1]*=B[0],B[3]<0&&(_t=W[2],W[2]=W[3],W[3]=_t),W[2]*=B[3],W[3]*=B[3]):(_t=W[0],W[0]=W[2],W[2]=_t,_t=W[1],W[1]=W[3],W[3]=_t,B[1]<0&&(_t=W[2],W[2]=W[3],W[3]=_t),W[2]*=B[1],W[3]*=B[1],B[2]<0&&(_t=W[0],W[0]=W[1],W[1]=_t),W[0]*=B[2],W[1]*=B[2]),W[0]+=B[4],W[1]+=B[4],W[2]+=B[5],W[3]+=B[5]}static transform(B,W){return[B[0]*W[0]+B[2]*W[1],B[1]*W[0]+B[3]*W[1],B[0]*W[2]+B[2]*W[3],B[1]*W[2]+B[3]*W[3],B[0]*W[4]+B[2]*W[5]+B[4],B[1]*W[4]+B[3]*W[5]+B[5]]}static applyTransform(B,W){const _t=B[0]*W[0]+B[1]*W[2]+W[4],Ct=B[0]*W[1]+B[1]*W[3]+W[5];return[_t,Ct]}static applyInverseTransform(B,W){const _t=W[0]*W[3]-W[1]*W[2],Ct=(B[0]*W[3]-B[1]*W[2]+W[2]*W[5]-W[4]*W[3])/_t,J=(-B[0]*W[1]+B[1]*W[0]+W[4]*W[1]-W[5]*W[0])/_t;return[Ct,J]}static getAxialAlignedBoundingBox(B,W){const _t=rt.applyTransform(B,W),Ct=rt.applyTransform(B.slice(2,4),W),J=rt.applyTransform([B[0],B[3]],W),ht=rt.applyTransform([B[2],B[1]],W);return[Math.min(_t[0],Ct[0],J[0],ht[0]),Math.min(_t[1],Ct[1],J[1],ht[1]),Math.max(_t[0],Ct[0],J[0],ht[0]),Math.max(_t[1],Ct[1],J[1],ht[1])]}static inverseTransform(B){const W=B[0]*B[3]-B[1]*B[2];return[B[3]/W,-B[1]/W,-B[2]/W,B[0]/W,(B[2]*B[5]-B[4]*B[3])/W,(B[4]*B[1]-B[5]*B[0])/W]}static singularValueDecompose2dScale(B){const W=[B[0],B[2],B[1],B[3]],_t=B[0]*W[0]+B[1]*W[2],Ct=B[0]*W[1]+B[1]*W[3],J=B[2]*W[0]+B[3]*W[2],ht=B[2]*W[1]+B[3]*W[3],vt=(_t+ht)/2,St=Math.sqrt((_t+ht)**2-4*(_t*ht-J*Ct))/2,Ft=vt+St||1,kt=vt-St||1;return[Math.sqrt(Ft),Math.sqrt(kt)]}static normalizeRect(B){const W=B.slice(0);return B[0]>B[2]&&(W[0]=B[2],W[2]=B[0]),B[1]>B[3]&&(W[1]=B[3],W[3]=B[1]),W}static intersect(B,W){const _t=Math.max(Math.min(B[0],B[2]),Math.min(W[0],W[2])),Ct=Math.min(Math.max(B[0],B[2]),Math.max(W[0],W[2]));if(_t>Ct)return null;const J=Math.max(Math.min(B[1],B[3]),Math.min(W[1],W[3])),ht=Math.min(Math.max(B[1],B[3]),Math.max(W[1],W[3]));return J>ht?null:[_t,J,Ct,ht]}static bezierBoundingBox(B,W,_t,Ct,J,ht,vt,St){const Ft=[],kt=[[],[]];let wt,xt,Rt,Tt,Nt,Mt,Ot,Lt;for(let Ht=0;Ht<2;++Ht){if(Ht===0?(xt=6*B-12*_t+6*J,wt=-3*B+9*_t-9*J+3*vt,Rt=3*_t-3*B):(xt=6*W-12*Ct+6*ht,wt=-3*W+9*Ct-9*ht+3*St,Rt=3*Ct-3*W),Math.abs(wt)<1e-12){if(Math.abs(xt)<1e-12)continue;Tt=-Rt/xt,0<Tt&&Tt<1&&Ft.push(Tt);continue}Ot=xt*xt-4*Rt*wt,Lt=Math.sqrt(Ot),!(Ot<0)&&(Nt=(-xt+Lt)/(2*wt),0<Nt&&Nt<1&&Ft.push(Nt),Mt=(-xt-Lt)/(2*wt),0<Mt&&Mt<1&&Ft.push(Mt))}let jt=Ft.length,It;const Bt=jt;for(;jt--;)Tt=Ft[jt],It=1-Tt,kt[0][jt]=It*It*It*B+3*It*It*Tt*_t+3*It*Tt*Tt*J+Tt*Tt*Tt*vt,kt[1][jt]=It*It*It*W+3*It*It*Tt*Ct+3*It*Tt*Tt*ht+Tt*Tt*Tt*St;return kt[0][Bt]=B,kt[1][Bt]=W,kt[0][Bt+1]=vt,kt[1][Bt+1]=St,kt[0].length=kt[1].length=Bt+2,[Math.min(...kt[0]),Math.min(...kt[1]),Math.max(...kt[0]),Math.max(...kt[1])]}}f.Util=rt;const at=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,728,711,710,729,733,731,730,732,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,8226,8224,8225,8230,8212,8211,402,8260,8249,8250,8722,8240,8222,8220,8221,8216,8217,8218,8482,64257,64258,321,338,352,376,381,305,322,339,353,382,0,8364];function ut(F){if(F[0]>="ï"){let W;if(F[0]==="þ"&&F[1]==="ÿ"?W="utf-16be":F[0]==="ÿ"&&F[1]==="þ"?W="utf-16le":F[0]==="ï"&&F[1]==="»"&&F[2]==="¿"&&(W="utf-8"),W)try{const _t=new TextDecoder(W,{fatal:!0}),Ct=e(F);return _t.decode(Ct)}catch(_t){dt(`stringToPDFString: "${_t}".`)}}const B=[];for(let W=0,_t=F.length;W<_t;W++){const Ct=at[F.charCodeAt(W)];B.push(Ct?String.fromCharCode(Ct):F.charAt(W))}return B.join("")}function ct(F){return decodeURIComponent(escape(F))}function mt(F){return unescape(encodeURIComponent(F))}function gt(F){return typeof F=="object"&&F!==null&&F.byteLength!==void 0}function Et(F,B){if(F.length!==B.length)return!1;for(let W=0,_t=F.length;W<_t;W++)if(F[W]!==B[W])return!1;return!0}function At(F=new Date){return[F.getUTCFullYear().toString(),(F.getUTCMonth()+1).toString().padStart(2,"0"),F.getUTCDate().toString().padStart(2,"0"),F.getUTCHours().toString().padStart(2,"0"),F.getUTCMinutes().toString().padStart(2,"0"),F.getUTCSeconds().toString().padStart(2,"0")].join("")}function Pt(){const F=Object.create(null);let B=!1;return Object.defineProperty(F,"settled",{get(){return B}}),F.promise=new Promise(function(W,_t){F.resolve=function(Ct){B=!0,W(Ct)},F.reject=function(Ct){B=!0,_t(Ct)}}),F}},(__unused_webpack_module,exports,__w_pdfjs_require__)=>{var ot,z,p,T,$t,G,re,I,S,g,w,C,y,d,_,de,r,P,ue,A,t;Object.defineProperty(exports,"__esModule",{value:!0}),exports.build=exports.RenderTask=exports.PDFWorkerUtil=exports.PDFWorker=exports.PDFPageProxy=exports.PDFDocumentProxy=exports.PDFDocumentLoadingTask=exports.PDFDataRangeTransport=exports.LoopbackPort=exports.DefaultStandardFontDataFactory=exports.DefaultFilterFactory=exports.DefaultCanvasFactory=exports.DefaultCMapReaderFactory=void 0,exports.getDocument=getDocument,exports.version=void 0;var _util=__w_pdfjs_require__(1),_annotation_storage=__w_pdfjs_require__(3),_display_utils=__w_pdfjs_require__(6),_font_loader=__w_pdfjs_require__(9),_canvas=__w_pdfjs_require__(11),_worker_options=__w_pdfjs_require__(14),_is_node=__w_pdfjs_require__(10),_message_handler=__w_pdfjs_require__(15),_metadata=__w_pdfjs_require__(16),_optional_content_config=__w_pdfjs_require__(17),_transport_stream=__w_pdfjs_require__(18),_xfa_text=__w_pdfjs_require__(19);const DEFAULT_RANGE_CHUNK_SIZE=65536,RENDERING_CANCELLED_TIMEOUT=100,DELAYED_CLEANUP_TIMEOUT=5e3;let DefaultCanvasFactory=_display_utils.DOMCanvasFactory;exports.DefaultCanvasFactory=DefaultCanvasFactory;let DefaultCMapReaderFactory=_display_utils.DOMCMapReaderFactory;exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory;let DefaultFilterFactory=_display_utils.DOMFilterFactory;exports.DefaultFilterFactory=DefaultFilterFactory;let DefaultStandardFontDataFactory=_display_utils.DOMStandardFontDataFactory;if(exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory,_is_node.isNodeJS){const{NodeCanvasFactory:a,NodeCMapReaderFactory:n,NodeFilterFactory:u,NodeStandardFontDataFactory:E}=__w_pdfjs_require__(20);exports.DefaultCanvasFactory=DefaultCanvasFactory=a,exports.DefaultCMapReaderFactory=DefaultCMapReaderFactory=n,exports.DefaultFilterFactory=DefaultFilterFactory=u,exports.DefaultStandardFontDataFactory=DefaultStandardFontDataFactory=E}let createPDFNetworkStream;if(_is_node.isNodeJS){const{PDFNodeStream:a}=__w_pdfjs_require__(21);createPDFNetworkStream=n=>new a(n)}else{const{PDFNetworkStream:a}=__w_pdfjs_require__(24),{PDFFetchStream:n}=__w_pdfjs_require__(25);createPDFNetworkStream=u=>(0,_display_utils.isValidFetchUrl)(u.url)?new n(u):new a(u)}function getDocument(a){if(typeof a=="string"||a instanceof URL?a={url:a}:(0,_util.isArrayBuffer)(a)&&(a={data:a}),typeof a!="object")throw new Error("Invalid parameter in getDocument, need parameter object.");if(!a.url&&!a.data&&!a.range)throw new Error("Invalid parameter object: need either .data, .range or .url");const n=new PDFDocumentLoadingTask,{docId:u}=n,E=a.url?getUrlProp(a.url):null,i=a.data?getDataProp(a.data):null,M=a.httpHeaders||null,V=a.withCredentials===!0,Y=a.password??null,Q=a.range instanceof PDFDataRangeTransport?a.range:null,st=Number.isInteger(a.rangeChunkSize)&&a.rangeChunkSize>0?a.rangeChunkSize:DEFAULT_RANGE_CHUNK_SIZE;let ft=a.worker instanceof PDFWorker?a.worker:null;const nt=a.verbosity,dt=typeof a.docBaseUrl=="string"&&!(0,_display_utils.isDataScheme)(a.docBaseUrl)?a.docBaseUrl:null,bt=typeof a.cMapUrl=="string"?a.cMapUrl:null,yt=a.cMapPacked!==!1,U=a.CMapReaderFactory||DefaultCMapReaderFactory,c=typeof a.standardFontDataUrl=="string"?a.standardFontDataUrl:null,h=a.StandardFontDataFactory||DefaultStandardFontDataFactory,v=a.stopAtErrors!==!0,j=Number.isInteger(a.maxImageSize)&&a.maxImageSize>-1?a.maxImageSize:-1,D=a.isEvalSupported!==!1,q=typeof a.isOffscreenCanvasSupported=="boolean"?a.isOffscreenCanvasSupported:!_is_node.isNodeJS,H=Number.isInteger(a.canvasMaxAreaInBytes)?a.canvasMaxAreaInBytes:-1,K=typeof a.disableFontFace=="boolean"?a.disableFontFace:_is_node.isNodeJS,X=a.fontExtraProperties===!0,L=a.enableXfa===!0,k=a.ownerDocument||globalThis.document,e=a.disableRange===!0,o=a.disableStream===!0,b=a.disableAutoFetch===!0,x=a.pdfBug===!0,O=Q?Q.length:a.length??NaN,N=typeof a.useSystemFonts=="boolean"?a.useSystemFonts:!_is_node.isNodeJS&&!K,it=typeof a.useWorkerFetch=="boolean"?a.useWorkerFetch:U===_display_utils.DOMCMapReaderFactory&&h===_display_utils.DOMStandardFontDataFactory&&(0,_display_utils.isValidFetchUrl)(bt,document.baseURI)&&(0,_display_utils.isValidFetchUrl)(c,document.baseURI),tt=a.canvasFactory||new DefaultCanvasFactory({ownerDocument:k}),rt=a.filterFactory||new DefaultFilterFactory({docId:u,ownerDocument:k}),at=null;(0,_util.setVerbosityLevel)(nt);const ut={canvasFactory:tt,filterFactory:rt};if(it||(ut.cMapReaderFactory=new U({baseUrl:bt,isCompressed:yt}),ut.standardFontDataFactory=new h({baseUrl:c})),!ft){const gt={verbosity:nt,port:_worker_options.GlobalWorkerOptions.workerPort};ft=gt.port?PDFWorker.fromPort(gt):new PDFWorker(gt),n._worker=ft}const ct={docId:u,apiVersion:"3.5.141",data:i,password:Y,disableAutoFetch:b,rangeChunkSize:st,length:O,docBaseUrl:dt,enableXfa:L,evaluatorOptions:{maxImageSize:j,disableFontFace:K,ignoreErrors:v,isEvalSupported:D,isOffscreenCanvasSupported:q,canvasMaxAreaInBytes:H,fontExtraProperties:X,useSystemFonts:N,cMapUrl:it?bt:null,standardFontDataUrl:it?c:null}},mt={ignoreErrors:v,isEvalSupported:D,disableFontFace:K,fontExtraProperties:X,enableXfa:L,ownerDocument:k,disableAutoFetch:b,pdfBug:x,styleElement:at};return ft.promise.then(function(){if(n.destroyed)throw new Error("Loading aborted");const gt=_fetchDocument(ft,ct),Et=new Promise(function(At){let Pt;Q?Pt=new _transport_stream.PDFDataTransportStream({length:O,initialData:Q.initialData,progressiveDone:Q.progressiveDone,contentDispositionFilename:Q.contentDispositionFilename,disableRange:e,disableStream:o},Q):i||(Pt=createPDFNetworkStream({url:E,length:O,httpHeaders:M,withCredentials:V,rangeChunkSize:st,disableRange:e,disableStream:o})),At(Pt)});return Promise.all([gt,Et]).then(function([At,Pt]){if(n.destroyed)throw new Error("Loading aborted");const F=new _message_handler.MessageHandler(u,At,ft.port),B=new WorkerTransport(F,n,Pt,mt,ut);n._transport=B,F.send("Ready",null)})}).catch(n._capability.reject),n}async function _fetchDocument(a,n){if(a.destroyed)throw new Error("Worker was destroyed");const u=await a.messageHandler.sendWithPromise("GetDocRequest",n,n.data?[n.data.buffer]:null);if(a.destroyed)throw new Error("Worker was destroyed");return u}function getUrlProp(a){if(a instanceof URL)return a.href;try{return new URL(a,window.location).href}catch{if(_is_node.isNodeJS&&typeof a=="string")return a}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function getDataProp(a){if(_is_node.isNodeJS&&typeof Buffer<"u"&&a instanceof Buffer)return(0,_display_utils.deprecated)("Please provide binary data as `Uint8Array`, rather than `Buffer`."),new Uint8Array(a);if(a instanceof Uint8Array&&a.byteLength===a.buffer.byteLength)return a;if(typeof a=="string")return(0,_util.stringToBytes)(a);if(typeof a=="object"&&!isNaN(a==null?void 0:a.length)||(0,_util.isArrayBuffer)(a))return new Uint8Array(a);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}const f=class{constructor(){this._capability=(0,_util.createPromiseCapability)(),this._transport=null,this._worker=null,this.docId=`d${ie(f,ot)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var n;this.destroyed=!0,await((n=this._transport)==null?void 0:n.destroy()),this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}};let PDFDocumentLoadingTask=f;ot=new WeakMap,Z(PDFDocumentLoadingTask,ot,0),exports.PDFDocumentLoadingTask=PDFDocumentLoadingTask;class PDFDataRangeTransport{constructor(n,u,E=!1,i=null){this.length=n,this.initialData=u,this.progressiveDone=E,this.contentDispositionFilename=i,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=(0,_util.createPromiseCapability)()}addRangeListener(n){this._rangeListeners.push(n)}addProgressListener(n){this._progressListeners.push(n)}addProgressiveReadListener(n){this._progressiveReadListeners.push(n)}addProgressiveDoneListener(n){this._progressiveDoneListeners.push(n)}onDataRange(n,u){for(const E of this._rangeListeners)E(n,u)}onDataProgress(n,u){this._readyCapability.promise.then(()=>{for(const E of this._progressListeners)E(n,u)})}onDataProgressiveRead(n){this._readyCapability.promise.then(()=>{for(const u of this._progressiveReadListeners)u(n)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const n of this._progressiveDoneListeners)n()})}transportReady(){this._readyCapability.resolve()}requestDataRange(n,u){(0,_util.unreachable)("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}exports.PDFDataRangeTransport=PDFDataRangeTransport;class PDFDocumentProxy{constructor(n,u){this._pdfInfo=n,this._transport=u}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(n){return this._transport.getPage(n)}getPageIndex(n){return this._transport.getPageIndex(n)}getDestinations(){return this._transport.getDestinations()}getDestination(n){return this._transport.getDestination(n)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJavaScript(){return this._transport.getJavaScript()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig(){return this._transport.getOptionalContentConfig()}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(n=!1){return this._transport.startCleanup(n||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}exports.PDFDocumentProxy=PDFDocumentProxy;class PDFPageProxy{constructor(n,u,E,i=!1){Z(this,T);Z(this,G);Z(this,z,null);Z(this,p,!1);this._pageIndex=n,this._pageInfo=u,this._transport=E,this._stats=i?new _display_utils.StatTimer:null,this._pdfBug=i,this.commonObjs=E.commonObjs,this.objs=new PDFObjects,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:n,rotation:u=this.rotate,offsetX:E=0,offsetY:i=0,dontFlip:M=!1}={}){return new _display_utils.PageViewport({viewBox:this.view,scale:n,rotation:u,offsetX:E,offsetY:i,dontFlip:M})}getAnnotations({intent:n="display"}={}){const u=this._transport.getRenderingIntent(n);return this._transport.getAnnotations(this._pageIndex,u.renderingIntent)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get isPureXfa(){return(0,_util.shadow)(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var n;return((n=this._transport._htmlForXfa)==null?void 0:n.children[this._pageIndex])||null}render({canvasContext:n,viewport:u,intent:E="display",annotationMode:i=_util.AnnotationMode.ENABLE,transform:M=null,background:V=null,optionalContentConfigPromise:Y=null,annotationCanvasMap:Q=null,pageColors:st=null,printAnnotationStorage:ft=null}){var h,v,j;if((h=arguments[0])!=null&&h.canvasFactory)throw new Error("render no longer accepts the `canvasFactory`-option, please pass it to the `getDocument`-function instead.");(v=this._stats)==null||v.time("Overall");const nt=this._transport.getRenderingIntent(E,i,ft);pt(this,p,!1),lt(this,G,re).call(this),Y||(Y=this._transport.getOptionalContentConfig());let dt=this._intentStates.get(nt.cacheKey);dt||(dt=Object.create(null),this._intentStates.set(nt.cacheKey,dt)),dt.streamReaderCancelTimeout&&(clearTimeout(dt.streamReaderCancelTimeout),dt.streamReaderCancelTimeout=null);const bt=!!(nt.renderingIntent&_util.RenderingIntentFlag.PRINT);dt.displayReadyCapability||(dt.displayReadyCapability=(0,_util.createPromiseCapability)(),dt.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(j=this._stats)==null||j.time("Page Request"),this._pumpOperatorList(nt));const yt=D=>{var q,H;dt.renderTasks.delete(U),(this._maybeCleanupAfterRender||bt)&&pt(this,p,!0),lt(this,T,$t).call(this,!bt),D?(U.capability.reject(D),this._abortOperatorList({intentState:dt,reason:D instanceof Error?D:new Error(D)})):U.capability.resolve(),(q=this._stats)==null||q.timeEnd("Rendering"),(H=this._stats)==null||H.timeEnd("Overall")},U=new InternalRenderTask({callback:yt,params:{canvasContext:n,viewport:u,transform:M,background:V},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:Q,operatorList:dt.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!bt,pdfBug:this._pdfBug,pageColors:st});(dt.renderTasks||(dt.renderTasks=new Set)).add(U);const c=U.task;return Promise.all([dt.displayReadyCapability.promise,Y]).then(([D,q])=>{var H;if(m(this,p)){yt();return}(H=this._stats)==null||H.time("Rendering"),U.initializeGraphics({transparency:D,optionalContentConfig:q}),U.operatorListChanged()}).catch(yt),c}getOperatorList({intent:n="display",annotationMode:u=_util.AnnotationMode.ENABLE,printAnnotationStorage:E=null}={}){var Q;function i(){V.operatorList.lastChunk&&(V.opListReadCapability.resolve(V.operatorList),V.renderTasks.delete(Y))}const M=this._transport.getRenderingIntent(n,u,E,!0);let V=this._intentStates.get(M.cacheKey);V||(V=Object.create(null),this._intentStates.set(M.cacheKey,V));let Y;return V.opListReadCapability||(Y=Object.create(null),Y.operatorListChanged=i,V.opListReadCapability=(0,_util.createPromiseCapability)(),(V.renderTasks||(V.renderTasks=new Set)).add(Y),V.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(Q=this._stats)==null||Q.time("Page Request"),this._pumpOperatorList(M)),V.opListReadCapability.promise}streamTextContent({includeMarkedContent:n=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:n===!0},{highWaterMark:100,size(E){return E.items.length}})}getTextContent(n={}){if(this._transport._htmlForXfa)return this.getXfa().then(E=>_xfa_text.XfaText.textContent(E));const u=this.streamTextContent(n);return new Promise(function(E,i){function M(){V.read().then(function({value:Q,done:st}){if(st){E(Y);return}Object.assign(Y.styles,Q.styles),Y.items.push(...Q.items),M()},i)}const V=u.getReader(),Y={items:[],styles:Object.create(null)};M()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const n=[];for(const u of this._intentStates.values())if(this._abortOperatorList({intentState:u,reason:new Error("Page was destroyed."),force:!0}),!u.opListReadCapability)for(const E of u.renderTasks)n.push(E.completed),E.cancel();return this.objs.clear(),pt(this,p,!1),lt(this,G,re).call(this),Promise.all(n)}cleanup(n=!1){pt(this,p,!0);const u=lt(this,T,$t).call(this,!1);return n&&u&&this._stats&&(this._stats=new _display_utils.StatTimer),u}_startRenderPage(n,u){var i,M;const E=this._intentStates.get(u);E&&((i=this._stats)==null||i.timeEnd("Page Request"),(M=E.displayReadyCapability)==null||M.resolve(n))}_renderPageChunk(n,u){for(let E=0,i=n.length;E<i;E++)u.operatorList.fnArray.push(n.fnArray[E]),u.operatorList.argsArray.push(n.argsArray[E]);u.operatorList.lastChunk=n.lastChunk,u.operatorList.separateAnnots=n.separateAnnots;for(const E of u.renderTasks)E.operatorListChanged();n.lastChunk&&lt(this,T,$t).call(this,!0)}_pumpOperatorList({renderingIntent:n,cacheKey:u,annotationStorageMap:E}){const M=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:n,cacheKey:u,annotationStorage:E}).getReader(),V=this._intentStates.get(u);V.streamReader=M;const Y=()=>{M.read().then(({value:Q,done:st})=>{if(st){V.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(Q,V),Y())},Q=>{if(V.streamReader=null,!this._transport.destroyed){if(V.operatorList){V.operatorList.lastChunk=!0;for(const st of V.renderTasks)st.operatorListChanged();lt(this,T,$t).call(this,!0)}if(V.displayReadyCapability)V.displayReadyCapability.reject(Q);else if(V.opListReadCapability)V.opListReadCapability.reject(Q);else throw Q}})};Y()}_abortOperatorList({intentState:n,reason:u,force:E=!1}){if(n.streamReader){if(n.streamReaderCancelTimeout&&(clearTimeout(n.streamReaderCancelTimeout),n.streamReaderCancelTimeout=null),!E){if(n.renderTasks.size>0)return;if(u instanceof _display_utils.RenderingCancelledException){let i=RENDERING_CANCELLED_TIMEOUT;u.extraDelay>0&&u.extraDelay<1e3&&(i+=u.extraDelay),n.streamReaderCancelTimeout=setTimeout(()=>{n.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:n,reason:u,force:!0})},i);return}}if(n.streamReader.cancel(new _util.AbortException(u.message)).catch(()=>{}),n.streamReader=null,!this._transport.destroyed){for(const[i,M]of this._intentStates)if(M===n){this._intentStates.delete(i);break}this.cleanup()}}}get stats(){return this._stats}}z=new WeakMap,p=new WeakMap,T=new WeakSet,$t=function(n=!1){if(lt(this,G,re).call(this),!m(this,p))return!1;if(n)return pt(this,z,setTimeout(()=>{pt(this,z,null),lt(this,T,$t).call(this,!1)},DELAYED_CLEANUP_TIMEOUT)),!1;for(const{renderTasks:u,operatorList:E}of this._intentStates.values())if(u.size>0||!E.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),pt(this,p,!1),!0},G=new WeakSet,re=function(){m(this,z)&&(clearTimeout(m(this,z)),pt(this,z,null))},exports.PDFPageProxy=PDFPageProxy;class LoopbackPort{constructor(){Z(this,I,new Set);Z(this,S,Promise.resolve())}postMessage(n,u){const E={data:structuredClone(n,u?{transfer:u}:null)};m(this,S).then(()=>{for(const i of m(this,I))i.call(this,E)})}addEventListener(n,u){m(this,I).add(u)}removeEventListener(n,u){m(this,I).delete(u)}terminate(){m(this,I).clear()}}I=new WeakMap,S=new WeakMap,exports.LoopbackPort=LoopbackPort;const PDFWorkerUtil={isWorkerDisabled:!1,fallbackWorkerSrc:null,fakeWorkerId:0};exports.PDFWorkerUtil=PDFWorkerUtil;{if(_is_node.isNodeJS&&typeof commonjsRequire=="function")PDFWorkerUtil.isWorkerDisabled=!0,PDFWorkerUtil.fallbackWorkerSrc="./pdf.worker.js";else if(typeof document=="object"){const a=(g=document==null?void 0:document.currentScript)==null?void 0:g.src;a&&(PDFWorkerUtil.fallbackWorkerSrc=a.replace(/(\.(?:min\.)?js)(\?.*)?$/i,".worker$1$2"))}PDFWorkerUtil.isSameOrigin=function(a,n){let u;try{if(u=new URL(a),!u.origin||u.origin==="null")return!1}catch{return!1}const E=new URL(n,u);return u.origin===E.origin},PDFWorkerUtil.createCDNWrapper=function(a){const n=`importScripts("${a}");`;return URL.createObjectURL(new Blob([n]))}}const _PDFWorker=class{constructor({name:a=null,port:n=null,verbosity:u=(0,_util.getVerbosityLevel)()}={}){if(n&&m(_PDFWorker,w).has(n))throw new Error("Cannot use more than one PDFWorker per port.");if(this.name=a,this.destroyed=!1,this.verbosity=u,this._readyCapability=(0,_util.createPromiseCapability)(),this._port=null,this._webWorker=null,this._messageHandler=null,n){m(_PDFWorker,w).set(n,this),this._initializeFromPort(n);return}this._initialize()}get promise(){return this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(a){this._port=a,this._messageHandler=new _message_handler.MessageHandler("main","worker",a),this._messageHandler.on("ready",function(){}),this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})}_initialize(){if(!PDFWorkerUtil.isWorkerDisabled&&!_PDFWorker._mainThreadWorkerMessageHandler){let{workerSrc:a}=_PDFWorker;try{PDFWorkerUtil.isSameOrigin(window.location.href,a)||(a=PDFWorkerUtil.createCDNWrapper(new URL(a,window.location).href));const n=new Worker(a),u=new _message_handler.MessageHandler("main","worker",n),E=()=>{n.removeEventListener("error",i),u.destroy(),n.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},i=()=>{this._webWorker||E()};n.addEventListener("error",i),u.on("test",V=>{if(n.removeEventListener("error",i),this.destroyed){E();return}V?(this._messageHandler=u,this._port=n,this._webWorker=n,this._readyCapability.resolve(),u.send("configure",{verbosity:this.verbosity})):(this._setupFakeWorker(),u.destroy(),n.terminate())}),u.on("ready",V=>{if(n.removeEventListener("error",i),this.destroyed){E();return}try{M()}catch{this._setupFakeWorker()}});const M=()=>{const V=new Uint8Array;u.send("test",V,[V.buffer])};M();return}catch{(0,_util.info)("The worker has been disabled.")}}this._setupFakeWorker()}_setupFakeWorker(){PDFWorkerUtil.isWorkerDisabled||((0,_util.warn)("Setting up fake worker."),PDFWorkerUtil.isWorkerDisabled=!0),_PDFWorker._setupFakeWorkerGlobal.then(a=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const n=new LoopbackPort;this._port=n;const u=`fake${PDFWorkerUtil.fakeWorkerId++}`,E=new _message_handler.MessageHandler(u+"_worker",u,n);a.setup(E,n);const i=new _message_handler.MessageHandler(u,u+"_worker",n);this._messageHandler=i,this._readyCapability.resolve(),i.send("configure",{verbosity:this.verbosity})}).catch(a=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${a.message}".`))})}destroy(){this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),m(_PDFWorker,w).delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(a){if(!(a!=null&&a.port))throw new Error("PDFWorker.fromPort - invalid method signature.");return m(this,w).has(a.port)?m(this,w).get(a.port):new _PDFWorker(a)}static get workerSrc(){if(_worker_options.GlobalWorkerOptions.workerSrc)return _worker_options.GlobalWorkerOptions.workerSrc;if(PDFWorkerUtil.fallbackWorkerSrc!==null)return _is_node.isNodeJS||(0,_display_utils.deprecated)('No "GlobalWorkerOptions.workerSrc" specified.'),PDFWorkerUtil.fallbackWorkerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _mainThreadWorkerMessageHandler(){var a;try{return((a=globalThis.pdfjsWorker)==null?void 0:a.WorkerMessageHandler)||null}catch{return null}}static get _setupFakeWorkerGlobal(){const loader=async()=>{const mainWorkerMessageHandler=this._mainThreadWorkerMessageHandler;if(mainWorkerMessageHandler)return mainWorkerMessageHandler;if(_is_node.isNodeJS&&typeof commonjsRequire=="function"){const worker=eval("require")(this.workerSrc);return worker.WorkerMessageHandler}return await(0,_display_utils.loadScript)(this.workerSrc),window.pdfjsWorker.WorkerMessageHandler};return(0,_util.shadow)(this,"_setupFakeWorkerGlobal",loader())}};let PDFWorker=_PDFWorker;w=new WeakMap,Z(PDFWorker,w,new WeakMap),exports.PDFWorker=PDFWorker;class WorkerTransport{constructor(n,u,E,i,M){Z(this,_);Z(this,C,new Map);Z(this,y,new Map);Z(this,d,new Map);this.messageHandler=n,this.loadingTask=u,this.commonObjs=new PDFObjects,this.fontLoader=new _font_loader.FontLoader({ownerDocument:i.ownerDocument,styleElement:i.styleElement}),this._params=i,this.canvasFactory=M.canvasFactory,this.filterFactory=M.filterFactory,this.cMapReaderFactory=M.cMapReaderFactory,this.standardFontDataFactory=M.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._passwordCapability=null,this._networkStream=E,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=(0,_util.createPromiseCapability)(),this.setupMessageHandler()}get annotationStorage(){return(0,_util.shadow)(this,"annotationStorage",new _annotation_storage.AnnotationStorage)}getRenderingIntent(n,u=_util.AnnotationMode.ENABLE,E=null,i=!1){let M=_util.RenderingIntentFlag.DISPLAY,V=null;switch(n){case"any":M=_util.RenderingIntentFlag.ANY;break;case"display":break;case"print":M=_util.RenderingIntentFlag.PRINT;break;default:(0,_util.warn)(`getRenderingIntent - invalid intent: ${n}`)}switch(u){case _util.AnnotationMode.DISABLE:M+=_util.RenderingIntentFlag.ANNOTATIONS_DISABLE;break;case _util.AnnotationMode.ENABLE:break;case _util.AnnotationMode.ENABLE_FORMS:M+=_util.RenderingIntentFlag.ANNOTATIONS_FORMS;break;case _util.AnnotationMode.ENABLE_STORAGE:M+=_util.RenderingIntentFlag.ANNOTATIONS_STORAGE,V=(M&_util.RenderingIntentFlag.PRINT&&E instanceof _annotation_storage.PrintAnnotationStorage?E:this.annotationStorage).serializable;break;default:(0,_util.warn)(`getRenderingIntent - invalid annotationMode: ${u}`)}return i&&(M+=_util.RenderingIntentFlag.OPLIST),{renderingIntent:M,cacheKey:`${M}_${_annotation_storage.AnnotationStorage.getHash(V)}`,annotationStorageMap:V}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=(0,_util.createPromiseCapability)(),this._passwordCapability&&this._passwordCapability.reject(new Error("Worker was destroyed during onPassword callback"));const n=[];for(const E of m(this,y).values())n.push(E._destroy());m(this,y).clear(),m(this,d).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const u=this.messageHandler.sendWithPromise("Terminate",null);return n.push(u),Promise.all(n).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),m(this,C).clear(),this.filterFactory.destroy(),this._networkStream&&this._networkStream.cancelAllRequests(new _util.AbortException("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:n,loadingTask:u}=this;n.on("GetReader",(E,i)=>{(0,_util.assert)(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=M=>{this._lastProgress={loaded:M.loaded,total:M.total}},i.onPull=()=>{this._fullReader.read().then(function({value:M,done:V}){if(V){i.close();return}(0,_util.assert)(M instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(M),1,[M])}).catch(M=>{i.error(M)})},i.onCancel=M=>{this._fullReader.cancel(M),i.ready.catch(V=>{if(!this.destroyed)throw V})}}),n.on("ReaderHeadersReady",E=>{const i=(0,_util.createPromiseCapability)(),M=this._fullReader;return M.headersReady.then(()=>{var V;(!M.isStreamingSupported||!M.isRangeSupported)&&(this._lastProgress&&((V=u.onProgress)==null||V.call(u,this._lastProgress)),M.onProgress=Y=>{var Q;(Q=u.onProgress)==null||Q.call(u,{loaded:Y.loaded,total:Y.total})}),i.resolve({isStreamingSupported:M.isStreamingSupported,isRangeSupported:M.isRangeSupported,contentLength:M.contentLength})},i.reject),i.promise}),n.on("GetRangeReader",(E,i)=>{(0,_util.assert)(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const M=this._networkStream.getRangeReader(E.begin,E.end);if(!M){i.close();return}i.onPull=()=>{M.read().then(function({value:V,done:Y}){if(Y){i.close();return}(0,_util.assert)(V instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(V),1,[V])}).catch(V=>{i.error(V)})},i.onCancel=V=>{M.cancel(V),i.ready.catch(Y=>{if(!this.destroyed)throw Y})}}),n.on("GetDoc",({pdfInfo:E})=>{this._numPages=E.numPages,this._htmlForXfa=E.htmlForXfa,delete E.htmlForXfa,u._capability.resolve(new PDFDocumentProxy(E,this))}),n.on("DocException",function(E){let i;switch(E.name){case"PasswordException":i=new _util.PasswordException(E.message,E.code);break;case"InvalidPDFException":i=new _util.InvalidPDFException(E.message);break;case"MissingPDFException":i=new _util.MissingPDFException(E.message);break;case"UnexpectedResponseException":i=new _util.UnexpectedResponseException(E.message,E.status);break;case"UnknownErrorException":i=new _util.UnknownErrorException(E.message,E.details);break;default:(0,_util.unreachable)("DocException - expected a valid Error.")}u._capability.reject(i)}),n.on("PasswordRequest",E=>{if(this._passwordCapability=(0,_util.createPromiseCapability)(),u.onPassword){const i=M=>{M instanceof Error?this._passwordCapability.reject(M):this._passwordCapability.resolve({password:M})};try{u.onPassword(i,E.code)}catch(M){this._passwordCapability.reject(M)}}else this._passwordCapability.reject(new _util.PasswordException(E.message,E.code));return this._passwordCapability.promise}),n.on("DataLoaded",E=>{var i;(i=u.onProgress)==null||i.call(u,{loaded:E.length,total:E.length}),this.downloadInfoCapability.resolve(E)}),n.on("StartRenderPage",E=>{if(this.destroyed)return;m(this,y).get(E.pageIndex)._startRenderPage(E.transparency,E.cacheKey)}),n.on("commonobj",([E,i,M])=>{var V;if(!this.destroyed&&!this.commonObjs.has(E))switch(i){case"Font":const Y=this._params;if("error"in M){const ft=M.error;(0,_util.warn)(`Error during font loading: ${ft}`),this.commonObjs.resolve(E,ft);break}const Q=Y.pdfBug&&((V=globalThis.FontInspector)!=null&&V.enabled)?(ft,nt)=>globalThis.FontInspector.fontAdded(ft,nt):null,st=new _font_loader.FontFaceObject(M,{isEvalSupported:Y.isEvalSupported,disableFontFace:Y.disableFontFace,ignoreErrors:Y.ignoreErrors,inspectFont:Q});this.fontLoader.bind(st).catch(ft=>n.sendWithPromise("FontFallback",{id:E})).finally(()=>{!Y.fontExtraProperties&&st.data&&(st.data=null),this.commonObjs.resolve(E,st)});break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(E,M);break;default:throw new Error(`Got unknown common object type ${i}`)}}),n.on("obj",([E,i,M,V])=>{var Q;if(this.destroyed)return;const Y=m(this,y).get(i);if(!Y.objs.has(E))switch(M){case"Image":if(Y.objs.resolve(E,V),V){let st;if(V.bitmap){const{width:ft,height:nt}=V;st=ft*nt*4}else st=((Q=V.data)==null?void 0:Q.length)||0;st>_util.MAX_IMAGE_SIZE_TO_CACHE&&(Y._maybeCleanupAfterRender=!0)}break;case"Pattern":Y.objs.resolve(E,V);break;default:throw new Error(`Got unknown object type ${M}`)}}),n.on("DocProgress",E=>{var i;this.destroyed||(i=u.onProgress)==null||i.call(u,{loaded:E.loaded,total:E.total})}),n.on("FetchBuiltInCMap",E=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(E):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),n.on("FetchStandardFontData",E=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(E):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var n;return this.annotationStorage.size<=0&&(0,_util.warn)("saveDocument called while `annotationStorage` is empty, please use the getData-method instead."),this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:this.annotationStorage.serializable,filename:((n=this._fullReader)==null?void 0:n.filename)??null}).finally(()=>{this.annotationStorage.resetModified()})}getPage(n){if(!Number.isInteger(n)||n<=0||n>this._numPages)return Promise.reject(new Error("Invalid page request."));const u=n-1,E=m(this,d).get(u);if(E)return E;const i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:u}).then(M=>{if(this.destroyed)throw new Error("Transport destroyed");const V=new PDFPageProxy(u,M,this,this._params.pdfBug);return m(this,y).set(u,V),V});return m(this,d).set(u,i),i}getPageIndex(n){return typeof n!="object"||n===null||!Number.isInteger(n.num)||n.num<0||!Number.isInteger(n.gen)||n.gen<0?Promise.reject(new Error("Invalid pageIndex request.")):this.messageHandler.sendWithPromise("GetPageIndex",{num:n.num,gen:n.gen})}getAnnotations(n,u){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:n,intent:u})}getFieldObjects(){return lt(this,_,de).call(this,"GetFieldObjects")}hasJSActions(){return lt(this,_,de).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(n){return typeof n!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:n})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getJavaScript(){return this.messageHandler.sendWithPromise("GetJavaScript",null)}getDocJSActions(){return this.messageHandler.sendWithPromise("GetDocJSActions",null)}getPageJSActions(n){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:n})}getStructTree(n){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:n})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(){return this.messageHandler.sendWithPromise("GetOptionalContentConfig",null).then(n=>new _optional_content_config.OptionalContentConfig(n))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const n="GetMetadata",u=m(this,C).get(n);if(u)return u;const E=this.messageHandler.sendWithPromise(n,null).then(i=>{var M,V;return{info:i[0],metadata:i[1]?new _metadata.Metadata(i[1]):null,contentDispositionFilename:((M=this._fullReader)==null?void 0:M.filename)??null,contentLength:((V=this._fullReader)==null?void 0:V.contentLength)??null}});return m(this,C).set(n,E),E}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(n=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const u of m(this,y).values())if(!u.cleanup())throw new Error(`startCleanup: Page ${u.pageNumber} is currently rendering.`);this.commonObjs.clear(),n||this.fontLoader.clear(),m(this,C).clear(),this.filterFactory.destroy(!0)}}get loadingParams(){const{disableAutoFetch:n,enableXfa:u}=this._params;return(0,_util.shadow)(this,"loadingParams",{disableAutoFetch:n,enableXfa:u})}}C=new WeakMap,y=new WeakMap,d=new WeakMap,_=new WeakSet,de=function(n,u=null){const E=m(this,C).get(n);if(E)return E;const i=this.messageHandler.sendWithPromise(n,u);return m(this,C).set(n,i),i};class PDFObjects{constructor(){Z(this,P);Z(this,r,Object.create(null))}get(n,u=null){if(u){const i=lt(this,P,ue).call(this,n);return i.capability.promise.then(()=>u(i.data)),null}const E=m(this,r)[n];if(!(E!=null&&E.capability.settled))throw new Error(`Requesting object that isn't resolved yet ${n}.`);return E.data}has(n){const u=m(this,r)[n];return(u==null?void 0:u.capability.settled)||!1}resolve(n,u=null){const E=lt(this,P,ue).call(this,n);E.data=u,E.capability.resolve()}clear(){var n;for(const u in m(this,r)){const{data:E}=m(this,r)[u];(n=E==null?void 0:E.bitmap)==null||n.close()}pt(this,r,Object.create(null))}}r=new WeakMap,P=new WeakSet,ue=function(n){const u=m(this,r)[n];return u||(m(this,r)[n]={capability:(0,_util.createPromiseCapability)(),data:null})};class RenderTask{constructor(n){Z(this,A,null);pt(this,A,n),this.onContinue=null}get promise(){return m(this,A).capability.promise}cancel(n=0){m(this,A).cancel(null,n)}get separateAnnots(){const{separateAnnots:n}=m(this,A).operatorList;if(!n)return!1;const{annotationCanvasMap:u}=m(this,A);return n.form||n.canvas&&(u==null?void 0:u.size)>0}}A=new WeakMap,exports.RenderTask=RenderTask;const l=class{constructor({callback:n,params:u,objs:E,commonObjs:i,annotationCanvasMap:M,operatorList:V,pageIndex:Y,canvasFactory:Q,filterFactory:st,useRequestAnimationFrame:ft=!1,pdfBug:nt=!1,pageColors:dt=null}){this.callback=n,this.params=u,this.objs=E,this.commonObjs=i,this.annotationCanvasMap=M,this.operatorListIdx=null,this.operatorList=V,this._pageIndex=Y,this.canvasFactory=Q,this.filterFactory=st,this._pdfBug=nt,this.pageColors=dt,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=ft===!0&&typeof window<"u",this.cancelled=!1,this.capability=(0,_util.createPromiseCapability)(),this.task=new RenderTask(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=u.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:n=!1,optionalContentConfig:u}){var Y,Q;if(this.cancelled)return;if(this._canvas){if(m(l,t).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");m(l,t).add(this._canvas)}this._pdfBug&&((Y=globalThis.StepperManager)!=null&&Y.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:E,viewport:i,transform:M,background:V}=this.params;this.gfx=new _canvas.CanvasGraphics(E,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:u},this.annotationCanvasMap),this.gfx.beginDrawing({transform:M,viewport:i,transparency:n,background:V}),this.operatorListIdx=0,this.graphicsReady=!0,(Q=this.graphicsReadyCallback)==null||Q.call(this)}cancel(n=null,u=0){var E;this.running=!1,this.cancelled=!0,(E=this.gfx)==null||E.endDrawing(this.pageColors),this._canvas&&m(l,t).delete(this._canvas),this.callback(n||new _display_utils.RenderingCancelledException(`Rendering cancelled, page ${this._pageIndex+1}`,"canvas",u))}operatorListChanged(){var n;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(n=this.stepper)==null||n.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?window.requestAnimationFrame(()=>{this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(this.pageColors),this._canvas&&m(l,t).delete(this._canvas),this.callback())))}};let InternalRenderTask=l;t=new WeakMap,Z(InternalRenderTask,t,new WeakSet);const version="3.5.141";exports.version=version;const build="be0f6ee08";exports.build=build},(ot,f,z)=>{var I,S,g,Me,C;Object.defineProperty(f,"__esModule",{value:!0}),f.PrintAnnotationStorage=f.AnnotationStorage=void 0;var p=z(1),T=z(4),$=z(8);class G{constructor(){Z(this,g);Z(this,I,!1);Z(this,S,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(d,_){const s=m(this,S).get(d);return s===void 0?_:Object.assign(_,s)}getRawValue(d){return m(this,S).get(d)}remove(d){if(m(this,S).delete(d),m(this,S).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const _ of m(this,S).values())if(_ instanceof T.AnnotationEditor)return;this.onAnnotationEditor(null)}}setValue(d,_){const s=m(this,S).get(d);let r=!1;if(s!==void 0)for(const[P,R]of Object.entries(_))s[P]!==R&&(r=!0,s[P]=R);else r=!0,m(this,S).set(d,_);r&&lt(this,g,Me).call(this),_ instanceof T.AnnotationEditor&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(_.constructor._type)}has(d){return m(this,S).has(d)}getAll(){return m(this,S).size>0?(0,p.objectFromMap)(m(this,S)):null}setAll(d){for(const[_,s]of Object.entries(d))this.setValue(_,s)}get size(){return m(this,S).size}resetModified(){m(this,I)&&(pt(this,I,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new et(this)}get serializable(){if(m(this,S).size===0)return null;const d=new Map;for(const[_,s]of m(this,S)){const r=s instanceof T.AnnotationEditor?s.serialize():s;r&&d.set(_,r)}return d}static getHash(d){if(!d)return"";const _=new $.MurmurHash3_64;for(const[s,r]of d)_.update(`${s}:${JSON.stringify(r)}`);return _.hexdigest()}}I=new WeakMap,S=new WeakMap,g=new WeakSet,Me=function(){m(this,I)||(pt(this,I,!0),typeof this.onSetModified=="function"&&this.onSetModified())},f.AnnotationStorage=G;class et extends G{constructor(_){super();Z(this,C,null);pt(this,C,structuredClone(_.serializable))}get print(){(0,p.unreachable)("Should not call PrintAnnotationStorage.print")}get serializable(){return m(this,C)}}C=new WeakMap,f.PrintAnnotationStorage=et},(ot,f,z)=>{var G,et,I,S,g,w;Object.defineProperty(f,"__esModule",{value:!0}),f.AnnotationEditor=void 0;var p=z(5),T=z(1);const C=class{constructor(d){Z(this,G,this.focusin.bind(this));Z(this,et,this.focusout.bind(this));Z(this,I,!1);Z(this,S,!1);Z(this,g,!1);Dt(this,"_uiManager",null);Z(this,w,C._zIndex++);this.constructor===C&&(0,T.unreachable)("Cannot initialize AnnotationEditor."),this.parent=d.parent,this.id=d.id,this.width=this.height=null,this.pageIndex=d.parent.pageIndex,this.name=d.name,this.div=null,this._uiManager=d.uiManager;const{rotation:_,rawDims:{pageWidth:s,pageHeight:r,pageX:P,pageY:R}}=this.parent.viewport;this.rotation=_,this.pageDimensions=[s,r],this.pageTranslation=[P,R];const[A,t]=this.parentDimensions;this.x=d.x/A,this.y=d.y/t,this.isAttachedToDOM=!1}static get _defaultLineColor(){return(0,T.shadow)(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}addCommands(d){this._uiManager.addCommands(d)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=m(this,w)}setParent(d){d!==null&&(this.pageIndex=d.pageIndex,this.pageDimensions=d.pageDimensions),this.parent=d}focusin(d){m(this,I)?pt(this,I,!1):this.parent.setSelected(this)}focusout(d){var s;if(!this.isAttachedToDOM)return;const _=d.relatedTarget;_!=null&&_.closest(`#${this.id}`)||(d.preventDefault(),(s=this.parent)!=null&&s.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}dragstart(d){const _=this.parent.div.getBoundingClientRect();this.startX=d.clientX-_.x,this.startY=d.clientY-_.y,d.dataTransfer.setData("text/plain",this.id),d.dataTransfer.effectAllowed="move"}setAt(d,_,s,r){const[P,R]=this.parentDimensions;[s,r]=this.screenToPageTranslation(s,r),this.x=(d+s)/P,this.y=(_+r)/R,this.div.style.left=`${100*this.x}%`,this.div.style.top=`${100*this.y}%`}translate(d,_){const[s,r]=this.parentDimensions;[d,_]=this.screenToPageTranslation(d,_),this.x+=d/s,this.y+=_/r,this.div.style.left=`${100*this.x}%`,this.div.style.top=`${100*this.y}%`}screenToPageTranslation(d,_){switch(this.parentRotation){case 90:return[_,-d];case 180:return[-d,-_];case 270:return[-_,d];default:return[d,_]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return this._uiManager.viewParameters.rotation}get parentDimensions(){const{realScale:d}=this._uiManager.viewParameters,[_,s]=this.pageDimensions;return[_*d,s*d]}setDims(d,_){const[s,r]=this.parentDimensions;this.div.style.width=`${100*d/s}%`,this.div.style.height=`${100*_/r}%`}fixDims(){const{style:d}=this.div,{height:_,width:s}=d,r=s.endsWith("%"),P=_.endsWith("%");if(r&&P)return;const[R,A]=this.parentDimensions;r||(d.width=`${100*parseFloat(s)/R}%`),P||(d.height=`${100*parseFloat(_)/A}%`)}getInitialTranslation(){return[0,0]}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.setAttribute("tabIndex",0),this.setInForeground(),this.div.addEventListener("focusin",m(this,G)),this.div.addEventListener("focusout",m(this,et));const[d,_]=this.getInitialTranslation();return this.translate(d,_),(0,p.bindEvents)(this,this.div,["dragstart","pointerdown"]),this.div}pointerdown(d){const{isMac:_}=T.FeatureTest.platform;if(d.button!==0||d.ctrlKey&&_){d.preventDefault();return}d.ctrlKey&&!_||d.shiftKey||d.metaKey&&_?this.parent.toggleSelected(this):this.parent.setSelected(this),pt(this,I,!0)}getRect(d,_){const s=this.parentScale,[r,P]=this.pageDimensions,[R,A]=this.pageTranslation,t=d/s,l=_/s,a=this.x*r,n=this.y*P,u=this.width*r,E=this.height*P;switch(this.rotation){case 0:return[a+t+R,P-n-l-E+A,a+t+u+R,P-n-l+A];case 90:return[a+l+R,P-n+t+A,a+l+E+R,P-n+t+u+A];case 180:return[a-t-u+R,P-n+l+A,a-t+R,P-n+l+E+A];case 270:return[a-l-E+R,P-n-t-u+A,a-l+R,P-n-t+A];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(d,_){const[s,r,P,R]=d,A=P-s,t=R-r;switch(this.rotation){case 0:return[s,_-R,A,t];case 90:return[s,_-r,t,A];case 180:return[P,_-r,A,t];case 270:return[P,_-R,t,A];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){pt(this,g,!0)}disableEditMode(){pt(this,g,!1)}isInEditMode(){return m(this,g)}shouldGetKeyboardEvents(){return!1}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){var d;(d=this.div)==null||d.addEventListener("focusin",m(this,G))}serialize(){(0,T.unreachable)("An editor must be serializable")}static deserialize(d,_,s){const r=new this.prototype.constructor({parent:_,id:_.getNextId(),uiManager:s});r.rotation=d.rotation;const[P,R]=r.pageDimensions,[A,t,l,a]=r.getRectInCurrentCoords(d.rect,R);return r.x=A/P,r.y=t/R,r.width=l/P,r.height=a/R,r}remove(){this.div.removeEventListener("focusin",m(this,G)),this.div.removeEventListener("focusout",m(this,et)),this.isEmpty()||this.commit(),this.parent.remove(this)}select(){var d;(d=this.div)==null||d.classList.add("selectedEditor")}unselect(){var d;(d=this.div)==null||d.classList.remove("selectedEditor")}updateParams(d,_){}disableEditing(){}enableEditing(){}get propertiesToUpdate(){return{}}get contentDiv(){return this.div}get isEditing(){return m(this,S)}set isEditing(d){pt(this,S,d),d?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null)}};let $=C;G=new WeakMap,et=new WeakMap,I=new WeakMap,S=new WeakMap,g=new WeakMap,w=new WeakMap,Dt($,"_colorManager",new p.ColorManager),Dt($,"_zIndex",1),f.AnnotationEditor=$},(ot,f,z)=>{var C,y,d,_,s,r,De,A,t,l,a,n,u,E,i,M,V,Y,Q,st,ft,nt,dt,bt,yt,U,c,h,v,j,D,Oe,H,fe,X,Ie,k,Le,o,Wt,x,Jt,N,Ne,tt,je,at,pe,ct,Qt,gt,ge;Object.defineProperty(f,"__esModule",{value:!0}),f.KeyboardManager=f.CommandManager=f.ColorManager=f.AnnotationEditorUIManager=void 0,f.bindEvents=$,f.opacityToHex=G;var p=z(1),T=z(6);function $(Pt,F,B){for(const W of B)F.addEventListener(W,Pt[W].bind(Pt))}function G(Pt){return Math.round(Math.min(255,Math.max(1,255*Pt))).toString(16).padStart(2,"0")}class et{constructor(){Z(this,C,0)}getId(){return`${p.AnnotationEditorPrefix}${ie(this,C)._++}`}}C=new WeakMap;class I{constructor(F=128){Z(this,y,[]);Z(this,d,!1);Z(this,_,void 0);Z(this,s,-1);pt(this,_,F)}add({cmd:F,undo:B,mustExec:W,type:_t=NaN,overwriteIfSameType:Ct=!1,keepUndo:J=!1}){if(W&&F(),m(this,d))return;const ht={cmd:F,undo:B,type:_t};if(m(this,s)===-1){m(this,y).length>0&&(m(this,y).length=0),pt(this,s,0),m(this,y).push(ht);return}if(Ct&&m(this,y)[m(this,s)].type===_t){J&&(ht.undo=m(this,y)[m(this,s)].undo),m(this,y)[m(this,s)]=ht;return}const vt=m(this,s)+1;vt===m(this,_)?m(this,y).splice(0,1):(pt(this,s,vt),vt<m(this,y).length&&m(this,y).splice(vt)),m(this,y).push(ht)}undo(){m(this,s)!==-1&&(pt(this,d,!0),m(this,y)[m(this,s)].undo(),pt(this,d,!1),pt(this,s,m(this,s)-1))}redo(){m(this,s)<m(this,y).length-1&&(pt(this,s,m(this,s)+1),pt(this,d,!0),m(this,y)[m(this,s)].cmd(),pt(this,d,!1))}hasSomethingToUndo(){return m(this,s)!==-1}hasSomethingToRedo(){return m(this,s)<m(this,y).length-1}destroy(){pt(this,y,null)}}y=new WeakMap,d=new WeakMap,_=new WeakMap,s=new WeakMap,f.CommandManager=I;class S{constructor(F){Z(this,r);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:B}=p.FeatureTest.platform;for(const[W,_t]of F)for(const Ct of W){const J=Ct.startsWith("mac+");B&&J?(this.callbacks.set(Ct.slice(4),_t),this.allKeys.add(Ct.split("+").at(-1))):!B&&!J&&(this.callbacks.set(Ct,_t),this.allKeys.add(Ct.split("+").at(-1)))}}exec(F,B){if(!this.allKeys.has(B.key))return;const W=this.callbacks.get(lt(this,r,De).call(this,B));W&&(W.bind(F)(),B.stopPropagation(),B.preventDefault())}}r=new WeakSet,De=function(F){F.altKey&&this.buffer.push("alt"),F.ctrlKey&&this.buffer.push("ctrl"),F.metaKey&&this.buffer.push("meta"),F.shiftKey&&this.buffer.push("shift"),this.buffer.push(F.key);const B=this.buffer.join("+");return this.buffer.length=0,B},f.KeyboardManager=S;const R=class{get _colors(){const F=new Map([["CanvasText",null],["Canvas",null]]);return(0,T.getColorValues)(F),(0,p.shadow)(this,"_colors",F)}convert(F){const B=(0,T.getRGB)(F);if(!window.matchMedia("(forced-colors: active)").matches)return B;for(const[W,_t]of this._colors)if(_t.every((Ct,J)=>Ct===B[J]))return R._colorsMapping.get(W);return B}getHexCode(F){const B=this._colors.get(F);return B?p.Util.makeHexColor(...B):F}};let g=R;Dt(g,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]])),f.ColorManager=g;const At=class{constructor(F,B,W){Z(this,D);Z(this,H);Z(this,X);Z(this,k);Z(this,o);Z(this,x);Z(this,N);Z(this,tt);Z(this,at);Z(this,ct);Z(this,gt);Z(this,A,null);Z(this,t,new Map);Z(this,l,new Map);Z(this,a,null);Z(this,n,new I);Z(this,u,0);Z(this,E,null);Z(this,i,new Set);Z(this,M,null);Z(this,V,new et);Z(this,Y,!1);Z(this,Q,p.AnnotationEditorType.NONE);Z(this,st,new Set);Z(this,ft,this.copy.bind(this));Z(this,nt,this.cut.bind(this));Z(this,dt,this.paste.bind(this));Z(this,bt,this.keydown.bind(this));Z(this,yt,this.onEditingAction.bind(this));Z(this,U,this.onPageChanging.bind(this));Z(this,c,this.onScaleChanging.bind(this));Z(this,h,this.onRotationChanging.bind(this));Z(this,v,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1});Z(this,j,null);pt(this,j,F),pt(this,M,B),m(this,M)._on("editingaction",m(this,yt)),m(this,M)._on("pagechanging",m(this,U)),m(this,M)._on("scalechanging",m(this,c)),m(this,M)._on("rotationchanging",m(this,h)),pt(this,a,W),this.viewParameters={realScale:T.PixelsPerInch.PDF_TO_CSS_UNITS,rotation:0}}destroy(){lt(this,H,fe).call(this),m(this,M)._off("editingaction",m(this,yt)),m(this,M)._off("pagechanging",m(this,U)),m(this,M)._off("scalechanging",m(this,c)),m(this,M)._off("rotationchanging",m(this,h));for(const F of m(this,l).values())F.destroy();m(this,l).clear(),m(this,t).clear(),m(this,i).clear(),pt(this,A,null),m(this,st).clear(),m(this,n).destroy()}onPageChanging({pageNumber:F}){pt(this,u,F-1)}focusMainContainer(){m(this,j).focus()}addShouldRescale(F){m(this,i).add(F)}removeShouldRescale(F){m(this,i).delete(F)}onScaleChanging({scale:F}){this.commitOrRemove(),this.viewParameters.realScale=F*T.PixelsPerInch.PDF_TO_CSS_UNITS;for(const B of m(this,i))B.onScaleChanging()}onRotationChanging({pagesRotation:F}){this.commitOrRemove(),this.viewParameters.rotation=F}addToAnnotationStorage(F){!F.isEmpty()&&m(this,a)&&!m(this,a).has(F.id)&&m(this,a).setValue(F.id,F)}copy(F){if(F.preventDefault(),m(this,A)&&m(this,A).commitOrRemove(),!this.hasSelection)return;const B=[];for(const W of m(this,st))W.isEmpty()||B.push(W.serialize());B.length!==0&&F.clipboardData.setData("application/pdfjs",JSON.stringify(B))}cut(F){this.copy(F),this.delete()}paste(F){F.preventDefault();let B=F.clipboardData.getData("application/pdfjs");if(!B)return;try{B=JSON.parse(B)}catch(_t){(0,p.warn)(`paste: "${_t.message}".`);return}if(!Array.isArray(B))return;this.unselectAll();const W=m(this,l).get(m(this,u));try{const _t=[];for(const ht of B){const vt=W.deserialize(ht);if(!vt)return;_t.push(vt)}const Ct=()=>{for(const ht of _t)lt(this,at,pe).call(this,ht);lt(this,gt,ge).call(this,_t)},J=()=>{for(const ht of _t)ht.remove()};this.addCommands({cmd:Ct,undo:J,mustExec:!0})}catch(_t){(0,p.warn)(`paste: "${_t.message}".`)}}keydown(F){var B;(B=this.getActive())!=null&&B.shouldGetKeyboardEvents()||At._keyboardManager.exec(this,F)}onEditingAction(F){["undo","redo","delete","selectAll"].includes(F.name)&&this[F.name]()}setEditingState(F){F?(lt(this,D,Oe).call(this),lt(this,X,Ie).call(this),lt(this,o,Wt).call(this,{isEditing:m(this,Q)!==p.AnnotationEditorType.NONE,isEmpty:lt(this,ct,Qt).call(this),hasSomethingToUndo:m(this,n).hasSomethingToUndo(),hasSomethingToRedo:m(this,n).hasSomethingToRedo(),hasSelectedEditor:!1})):(lt(this,H,fe).call(this),lt(this,k,Le).call(this),lt(this,o,Wt).call(this,{isEditing:!1}))}registerEditorTypes(F){if(!m(this,E)){pt(this,E,F);for(const B of m(this,E))lt(this,x,Jt).call(this,B.defaultPropertiesToUpdate)}}getId(){return m(this,V).getId()}get currentLayer(){return m(this,l).get(m(this,u))}get currentPageIndex(){return m(this,u)}addLayer(F){m(this,l).set(F.pageIndex,F),m(this,Y)?F.enable():F.disable()}removeLayer(F){m(this,l).delete(F.pageIndex)}updateMode(F){if(pt(this,Q,F),F===p.AnnotationEditorType.NONE)this.setEditingState(!1),lt(this,tt,je).call(this);else{this.setEditingState(!0),lt(this,N,Ne).call(this);for(const B of m(this,l).values())B.updateMode(F)}}updateToolbar(F){F!==m(this,Q)&&m(this,M).dispatch("switchannotationeditormode",{source:this,mode:F})}updateParams(F,B){if(m(this,E)){for(const W of m(this,st))W.updateParams(F,B);for(const W of m(this,E))W.updateDefaultParams(F,B)}}getEditors(F){const B=[];for(const W of m(this,t).values())W.pageIndex===F&&B.push(W);return B}getEditor(F){return m(this,t).get(F)}addEditor(F){m(this,t).set(F.id,F)}removeEditor(F){var B;m(this,t).delete(F.id),this.unselect(F),(B=m(this,a))==null||B.remove(F.id)}setActiveEditor(F){m(this,A)!==F&&(pt(this,A,F),F&&lt(this,x,Jt).call(this,F.propertiesToUpdate))}toggleSelected(F){if(m(this,st).has(F)){m(this,st).delete(F),F.unselect(),lt(this,o,Wt).call(this,{hasSelectedEditor:this.hasSelection});return}m(this,st).add(F),F.select(),lt(this,x,Jt).call(this,F.propertiesToUpdate),lt(this,o,Wt).call(this,{hasSelectedEditor:!0})}setSelected(F){for(const B of m(this,st))B!==F&&B.unselect();m(this,st).clear(),m(this,st).add(F),F.select(),lt(this,x,Jt).call(this,F.propertiesToUpdate),lt(this,o,Wt).call(this,{hasSelectedEditor:!0})}isSelected(F){return m(this,st).has(F)}unselect(F){F.unselect(),m(this,st).delete(F),lt(this,o,Wt).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return m(this,st).size!==0}undo(){m(this,n).undo(),lt(this,o,Wt).call(this,{hasSomethingToUndo:m(this,n).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:lt(this,ct,Qt).call(this)})}redo(){m(this,n).redo(),lt(this,o,Wt).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:m(this,n).hasSomethingToRedo(),isEmpty:lt(this,ct,Qt).call(this)})}addCommands(F){m(this,n).add(F),lt(this,o,Wt).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:lt(this,ct,Qt).call(this)})}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const F=[...m(this,st)],B=()=>{for(const _t of F)_t.remove()},W=()=>{for(const _t of F)lt(this,at,pe).call(this,_t)};this.addCommands({cmd:B,undo:W,mustExec:!0})}commitOrRemove(){var F;(F=m(this,A))==null||F.commitOrRemove()}selectAll(){for(const F of m(this,st))F.commit();lt(this,gt,ge).call(this,m(this,t).values())}unselectAll(){if(m(this,A)){m(this,A).commitOrRemove();return}if(m(this,st).size!==0){for(const F of m(this,st))F.unselect();m(this,st).clear(),lt(this,o,Wt).call(this,{hasSelectedEditor:!1})}}isActive(F){return m(this,A)===F}getActive(){return m(this,A)}getMode(){return m(this,Q)}};let w=At;A=new WeakMap,t=new WeakMap,l=new WeakMap,a=new WeakMap,n=new WeakMap,u=new WeakMap,E=new WeakMap,i=new WeakMap,M=new WeakMap,V=new WeakMap,Y=new WeakMap,Q=new WeakMap,st=new WeakMap,ft=new WeakMap,nt=new WeakMap,dt=new WeakMap,bt=new WeakMap,yt=new WeakMap,U=new WeakMap,c=new WeakMap,h=new WeakMap,v=new WeakMap,j=new WeakMap,D=new WeakSet,Oe=function(){m(this,j).addEventListener("keydown",m(this,bt))},H=new WeakSet,fe=function(){m(this,j).removeEventListener("keydown",m(this,bt))},X=new WeakSet,Ie=function(){document.addEventListener("copy",m(this,ft)),document.addEventListener("cut",m(this,nt)),document.addEventListener("paste",m(this,dt))},k=new WeakSet,Le=function(){document.removeEventListener("copy",m(this,ft)),document.removeEventListener("cut",m(this,nt)),document.removeEventListener("paste",m(this,dt))},o=new WeakSet,Wt=function(F){Object.entries(F).some(([W,_t])=>m(this,v)[W]!==_t)&&m(this,M).dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(m(this,v),F)})},x=new WeakSet,Jt=function(F){m(this,M).dispatch("annotationeditorparamschanged",{source:this,details:F})},N=new WeakSet,Ne=function(){if(!m(this,Y)){pt(this,Y,!0);for(const F of m(this,l).values())F.enable()}},tt=new WeakSet,je=function(){if(this.unselectAll(),m(this,Y)){pt(this,Y,!1);for(const F of m(this,l).values())F.disable()}},at=new WeakSet,pe=function(F){const B=m(this,l).get(F.pageIndex);B?B.addOrRebuild(F):this.addEditor(F)},ct=new WeakSet,Qt=function(){if(m(this,t).size===0)return!0;if(m(this,t).size===1)for(const F of m(this,t).values())return F.isEmpty();return!1},gt=new WeakSet,ge=function(F){m(this,st).clear();for(const B of F)B.isEmpty()||(m(this,st).add(B),B.select());lt(this,o,Wt).call(this,{hasSelectedEditor:!0})},Dt(w,"_keyboardManager",new S([[["ctrl+a","mac+meta+a"],At.prototype.selectAll],[["ctrl+z","mac+meta+z"],At.prototype.undo],[["ctrl+y","ctrl+shift+Z","mac+meta+shift+Z"],At.prototype.redo],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete"],At.prototype.delete],[["Escape","mac+Escape"],At.prototype.unselectAll]])),f.AnnotationEditorUIManager=w},(ot,f,z)=>{var ft,nt,dt,bt,yt,U,c,h,v,zt,D,Vt,H,qt;Object.defineProperty(f,"__esModule",{value:!0}),f.StatTimer=f.RenderingCancelledException=f.PixelsPerInch=f.PageViewport=f.PDFDateString=f.DOMStandardFontDataFactory=f.DOMSVGFactory=f.DOMFilterFactory=f.DOMCanvasFactory=f.DOMCMapReaderFactory=f.AnnotationPrefix=void 0,f.deprecated=a,f.getColorValues=M,f.getCurrentTransform=V,f.getCurrentTransformInverse=Y,f.getFilenameFromUrl=P,f.getPdfFilenameFromUrl=R,f.getRGB=i,f.getXfaPageViewport=E,f.isDataScheme=s,f.isPdfFile=r,f.isValidFetchUrl=t,f.loadScript=l,f.setLayerDimensions=Q;var p=z(7),T=z(1);const $="http://www.w3.org/2000/svg",G="pdfjs_internal_id_";f.AnnotationPrefix=G;const st=class{};let et=st;Dt(et,"CSS",96),Dt(et,"PDF",72),Dt(et,"PDF_TO_CSS_UNITS",st.CSS/st.PDF),f.PixelsPerInch=et;class I extends p.BaseFilterFactory{constructor({docId:k,ownerDocument:e=globalThis.document}={}){super();Z(this,v);Z(this,D);Z(this,H);Z(this,ft,void 0);Z(this,nt,void 0);Z(this,dt,void 0);Z(this,bt,void 0);Z(this,yt,void 0);Z(this,U,void 0);Z(this,c,void 0);Z(this,h,0);pt(this,dt,k),pt(this,bt,e)}addFilter(k){if(!k)return"none";let e=m(this,v,zt).get(k);if(e)return e;let o,b,x,O;if(k.length===1){const at=k[0],ut=new Array(256);for(let ct=0;ct<256;ct++)ut[ct]=at[ct]/255;O=o=b=x=ut.join(",")}else{const[at,ut,ct]=k,mt=new Array(256),gt=new Array(256),Et=new Array(256);for(let At=0;At<256;At++)mt[At]=at[At]/255,gt[At]=ut[At]/255,Et[At]=ct[At]/255;o=mt.join(","),b=gt.join(","),x=Et.join(","),O=`${o}${b}${x}`}if(e=m(this,v,zt).get(O),e)return m(this,v,zt).set(k,e),e;const N=`g_${m(this,dt)}_transfer_map_${ie(this,h)._++}`,it=`url(#${N})`;m(this,v,zt).set(k,it),m(this,v,zt).set(O,it);const tt=m(this,bt).createElementNS($,"filter",$);tt.setAttribute("id",N),tt.setAttribute("color-interpolation-filters","sRGB");const rt=m(this,bt).createElementNS($,"feComponentTransfer");return tt.append(rt),lt(this,H,qt).call(this,rt,"feFuncR",o),lt(this,H,qt).call(this,rt,"feFuncG",b),lt(this,H,qt).call(this,rt,"feFuncB",x),m(this,D,Vt).append(tt),it}addHCMFilter(k,e){var ct;const o=`${k}-${e}`;if(m(this,U)===o)return m(this,c);if(pt(this,U,o),pt(this,c,"none"),(ct=m(this,yt))==null||ct.remove(),!k||!e)return m(this,c);m(this,D,Vt).style.color=k,k=getComputedStyle(m(this,D,Vt)).getPropertyValue("color");const b=i(k);k=T.Util.makeHexColor(...b),m(this,D,Vt).style.color=e,e=getComputedStyle(m(this,D,Vt)).getPropertyValue("color");const x=i(e);if(e=T.Util.makeHexColor(...x),m(this,D,Vt).style.color="",k==="#000000"&&e==="#ffffff"||k===e)return m(this,c);const O=new Array(256);for(let mt=0;mt<=255;mt++){const gt=mt/255;O[mt]=gt<=.03928?gt/12.92:((gt+.055)/1.055)**2.4}const N=O.join(","),it=`g_${m(this,dt)}_hcm_filter`,tt=pt(this,yt,m(this,bt).createElementNS($,"filter",$));tt.setAttribute("id",it),tt.setAttribute("color-interpolation-filters","sRGB");let rt=m(this,bt).createElementNS($,"feComponentTransfer");tt.append(rt),lt(this,H,qt).call(this,rt,"feFuncR",N),lt(this,H,qt).call(this,rt,"feFuncG",N),lt(this,H,qt).call(this,rt,"feFuncB",N);const at=m(this,bt).createElementNS($,"feColorMatrix");at.setAttribute("type","matrix"),at.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),tt.append(at),rt=m(this,bt).createElementNS($,"feComponentTransfer"),tt.append(rt);const ut=(mt,gt)=>{const Et=b[mt]/255,At=x[mt]/255,Pt=new Array(gt+1);for(let F=0;F<=gt;F++)Pt[F]=Et+F/gt*(At-Et);return Pt.join(",")};return lt(this,H,qt).call(this,rt,"feFuncR",ut(0,5)),lt(this,H,qt).call(this,rt,"feFuncG",ut(1,5)),lt(this,H,qt).call(this,rt,"feFuncB",ut(2,5)),m(this,D,Vt).append(tt),pt(this,c,`url(#${it})`),m(this,c)}destroy(k=!1){k&&m(this,c)||(m(this,nt)&&(m(this,nt).parentNode.parentNode.remove(),pt(this,nt,null)),m(this,ft)&&(m(this,ft).clear(),pt(this,ft,null)),pt(this,h,0))}}ft=new WeakMap,nt=new WeakMap,dt=new WeakMap,bt=new WeakMap,yt=new WeakMap,U=new WeakMap,c=new WeakMap,h=new WeakMap,v=new WeakSet,zt=function(){return m(this,ft)||pt(this,ft,new Map)},D=new WeakSet,Vt=function(){if(!m(this,nt)){const k=m(this,bt).createElement("div"),{style:e}=k;e.visibility="hidden",e.contain="strict",e.width=e.height=0,e.position="absolute",e.top=e.left=0,e.zIndex=-1;const o=m(this,bt).createElementNS($,"svg");o.setAttribute("width",0),o.setAttribute("height",0),pt(this,nt,m(this,bt).createElementNS($,"defs")),k.append(o),o.append(m(this,nt)),m(this,bt).body.append(k)}return m(this,nt)},H=new WeakSet,qt=function(k,e,o){const b=m(this,bt).createElementNS($,e);b.setAttribute("type","discrete"),b.setAttribute("tableValues",o),k.append(b)},f.DOMFilterFactory=I;class S extends p.BaseCanvasFactory{constructor({ownerDocument:L=globalThis.document}={}){super(),this._document=L}_createCanvas(L,k){const e=this._document.createElement("canvas");return e.width=L,e.height=k,e}}f.DOMCanvasFactory=S;async function g(X,L=!1){if(t(X,document.baseURI)){const k=await fetch(X);if(!k.ok)throw new Error(k.statusText);return L?new Uint8Array(await k.arrayBuffer()):(0,T.stringToBytes)(await k.text())}return new Promise((k,e)=>{const o=new XMLHttpRequest;o.open("GET",X,!0),L&&(o.responseType="arraybuffer"),o.onreadystatechange=()=>{if(o.readyState===XMLHttpRequest.DONE){if(o.status===200||o.status===0){let b;if(L&&o.response?b=new Uint8Array(o.response):!L&&o.responseText&&(b=(0,T.stringToBytes)(o.responseText)),b){k(b);return}}e(new Error(o.statusText))}},o.send(null)})}class w extends p.BaseCMapReaderFactory{_fetchData(L,k){return g(L,this.isCompressed).then(e=>({cMapData:e,compressionType:k}))}}f.DOMCMapReaderFactory=w;class C extends p.BaseStandardFontDataFactory{_fetchData(L){return g(L,!0)}}f.DOMStandardFontDataFactory=C;class y extends p.BaseSVGFactory{_createSVG(L){return document.createElementNS($,L)}}f.DOMSVGFactory=y;class d{constructor({viewBox:L,scale:k,rotation:e,offsetX:o=0,offsetY:b=0,dontFlip:x=!1}){this.viewBox=L,this.scale=k,this.rotation=e,this.offsetX=o,this.offsetY=b;const O=(L[2]+L[0])/2,N=(L[3]+L[1])/2;let it,tt,rt,at;switch(e%=360,e<0&&(e+=360),e){case 180:it=-1,tt=0,rt=0,at=1;break;case 90:it=0,tt=1,rt=1,at=0;break;case 270:it=0,tt=-1,rt=-1,at=0;break;case 0:it=1,tt=0,rt=0,at=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}x&&(rt=-rt,at=-at);let ut,ct,mt,gt;it===0?(ut=Math.abs(N-L[1])*k+o,ct=Math.abs(O-L[0])*k+b,mt=(L[3]-L[1])*k,gt=(L[2]-L[0])*k):(ut=Math.abs(O-L[0])*k+o,ct=Math.abs(N-L[1])*k+b,mt=(L[2]-L[0])*k,gt=(L[3]-L[1])*k),this.transform=[it*k,tt*k,rt*k,at*k,ut-it*k*O-rt*k*N,ct-tt*k*O-at*k*N],this.width=mt,this.height=gt}get rawDims(){const{viewBox:L}=this;return(0,T.shadow)(this,"rawDims",{pageWidth:L[2]-L[0],pageHeight:L[3]-L[1],pageX:L[0],pageY:L[1]})}clone({scale:L=this.scale,rotation:k=this.rotation,offsetX:e=this.offsetX,offsetY:o=this.offsetY,dontFlip:b=!1}={}){return new d({viewBox:this.viewBox.slice(),scale:L,rotation:k,offsetX:e,offsetY:o,dontFlip:b})}convertToViewportPoint(L,k){return T.Util.applyTransform([L,k],this.transform)}convertToViewportRectangle(L){const k=T.Util.applyTransform([L[0],L[1]],this.transform),e=T.Util.applyTransform([L[2],L[3]],this.transform);return[k[0],k[1],e[0],e[1]]}convertToPdfPoint(L,k){return T.Util.applyInverseTransform([L,k],this.transform)}}f.PageViewport=d;class _ extends T.BaseException{constructor(L,k,e=0){super(L,"RenderingCancelledException"),this.type=k,this.extraDelay=e}}f.RenderingCancelledException=_;function s(X){const L=X.length;let k=0;for(;k<L&&X[k].trim()==="";)k++;return X.substring(k,k+5).toLowerCase()==="data:"}function r(X){return typeof X=="string"&&/\.pdf$/i.test(X)}function P(X,L=!1){return L||([X]=X.split(/[#?]/,1)),X.substring(X.lastIndexOf("/")+1)}function R(X,L="document.pdf"){if(typeof X!="string")return L;if(s(X))return(0,T.warn)('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),L;const k=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,e=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,o=k.exec(X);let b=e.exec(o[1])||e.exec(o[2])||e.exec(o[3]);if(b&&(b=b[0],b.includes("%")))try{b=e.exec(decodeURIComponent(b))[0]}catch{}return b||L}class A{constructor(){Dt(this,"started",Object.create(null));Dt(this,"times",[])}time(L){L in this.started&&(0,T.warn)(`Timer is already running for ${L}`),this.started[L]=Date.now()}timeEnd(L){L in this.started||(0,T.warn)(`Timer has not been started for ${L}`),this.times.push({name:L,start:this.started[L],end:Date.now()}),delete this.started[L]}toString(){const L=[];let k=0;for(const{name:e}of this.times)k=Math.max(e.length,k);for(const{name:e,start:o,end:b}of this.times)L.push(`${e.padEnd(k)} ${b-o}ms
`);return L.join("")}}f.StatTimer=A;function t(X,L){try{const{protocol:k}=L?new URL(X,L):new URL(X);return k==="http:"||k==="https:"}catch{return!1}}function l(X,L=!1){return new Promise((k,e)=>{const o=document.createElement("script");o.src=X,o.onload=function(b){L&&o.remove(),k(b)},o.onerror=function(){e(new Error(`Cannot load script at: ${o.src}`))},(document.head||document.documentElement).append(o)})}function a(X){console.log("Deprecated API usage: "+X)}let n;class u{static toDateObject(L){if(!L||typeof L!="string")return null;n||(n=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const k=n.exec(L);if(!k)return null;const e=parseInt(k[1],10);let o=parseInt(k[2],10);o=o>=1&&o<=12?o-1:0;let b=parseInt(k[3],10);b=b>=1&&b<=31?b:1;let x=parseInt(k[4],10);x=x>=0&&x<=23?x:0;let O=parseInt(k[5],10);O=O>=0&&O<=59?O:0;let N=parseInt(k[6],10);N=N>=0&&N<=59?N:0;const it=k[7]||"Z";let tt=parseInt(k[8],10);tt=tt>=0&&tt<=23?tt:0;let rt=parseInt(k[9],10)||0;return rt=rt>=0&&rt<=59?rt:0,it==="-"?(x+=tt,O+=rt):it==="+"&&(x-=tt,O-=rt),new Date(Date.UTC(e,o,b,x,O,N))}}f.PDFDateString=u;function E(X,{scale:L=1,rotation:k=0}){const{width:e,height:o}=X.attributes.style,b=[0,0,parseInt(e),parseInt(o)];return new d({viewBox:b,scale:L,rotation:k})}function i(X){if(X.startsWith("#")){const L=parseInt(X.slice(1),16);return[(L&16711680)>>16,(L&65280)>>8,L&255]}return X.startsWith("rgb(")?X.slice(4,-1).split(",").map(L=>parseInt(L)):X.startsWith("rgba(")?X.slice(5,-1).split(",").map(L=>parseInt(L)).slice(0,3):((0,T.warn)(`Not a valid color format: "${X}"`),[0,0,0])}function M(X){const L=document.createElement("span");L.style.visibility="hidden",document.body.append(L);for(const k of X.keys()){L.style.color=k;const e=window.getComputedStyle(L).color;X.set(k,i(e))}L.remove()}function V(X){const{a:L,b:k,c:e,d:o,e:b,f:x}=X.getTransform();return[L,k,e,o,b,x]}function Y(X){const{a:L,b:k,c:e,d:o,e:b,f:x}=X.getTransform().invertSelf();return[L,k,e,o,b,x]}function Q(X,L,k=!1,e=!0){if(L instanceof d){const{pageWidth:o,pageHeight:b}=L.rawDims,{style:x}=X,O=`calc(var(--scale-factor) * ${o}px)`,N=`calc(var(--scale-factor) * ${b}px)`;!k||L.rotation%180===0?(x.width=O,x.height=N):(x.width=N,x.height=O)}e&&X.setAttribute("data-main-rotation",L.rotation)}},(ot,f,z)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.BaseStandardFontDataFactory=f.BaseSVGFactory=f.BaseFilterFactory=f.BaseCanvasFactory=f.BaseCMapReaderFactory=void 0;var p=z(1);class T{constructor(){this.constructor===T&&(0,p.unreachable)("Cannot initialize BaseFilterFactory.")}addFilter(g){return"none"}addHCMFilter(g,w){return"none"}destroy(g=!1){}}f.BaseFilterFactory=T;class ${constructor(){this.constructor===$&&(0,p.unreachable)("Cannot initialize BaseCanvasFactory.")}create(g,w){if(g<=0||w<=0)throw new Error("Invalid canvas size");const C=this._createCanvas(g,w);return{canvas:C,context:C.getContext("2d")}}reset(g,w,C){if(!g.canvas)throw new Error("Canvas is not specified");if(w<=0||C<=0)throw new Error("Invalid canvas size");g.canvas.width=w,g.canvas.height=C}destroy(g){if(!g.canvas)throw new Error("Canvas is not specified");g.canvas.width=0,g.canvas.height=0,g.canvas=null,g.context=null}_createCanvas(g,w){(0,p.unreachable)("Abstract method `_createCanvas` called.")}}f.BaseCanvasFactory=$;class G{constructor({baseUrl:g=null,isCompressed:w=!0}){this.constructor===G&&(0,p.unreachable)("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=g,this.isCompressed=w}async fetch({name:g}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!g)throw new Error("CMap name must be specified.");const w=this.baseUrl+g+(this.isCompressed?".bcmap":""),C=this.isCompressed?p.CMapCompressionType.BINARY:p.CMapCompressionType.NONE;return this._fetchData(w,C).catch(y=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${w}`)})}_fetchData(g,w){(0,p.unreachable)("Abstract method `_fetchData` called.")}}f.BaseCMapReaderFactory=G;class et{constructor({baseUrl:g=null}){this.constructor===et&&(0,p.unreachable)("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=g}async fetch({filename:g}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!g)throw new Error("Font filename must be specified.");const w=`${this.baseUrl}${g}`;return this._fetchData(w).catch(C=>{throw new Error(`Unable to load font data at: ${w}`)})}_fetchData(g){(0,p.unreachable)("Abstract method `_fetchData` called.")}}f.BaseStandardFontDataFactory=et;class I{constructor(){this.constructor===I&&(0,p.unreachable)("Cannot initialize BaseSVGFactory.")}create(g,w,C=!1){if(g<=0||w<=0)throw new Error("Invalid SVG dimensions");const y=this._createSVG("svg:svg");return y.setAttribute("version","1.1"),C||(y.setAttribute("width",`${g}px`),y.setAttribute("height",`${w}px`)),y.setAttribute("preserveAspectRatio","none"),y.setAttribute("viewBox",`0 0 ${g} ${w}`),y}createElement(g){if(typeof g!="string")throw new Error("Invalid SVG element type");return this._createSVG(g)}_createSVG(g){(0,p.unreachable)("Abstract method `_createSVG` called.")}}f.BaseSVGFactory=I},(ot,f,z)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.MurmurHash3_64=void 0;var p=z(1);const T=3285377520,$=4294901760,G=65535;class et{constructor(S){this.h1=S?S&4294967295:T,this.h2=S?S&4294967295:T}update(S){let g,w;if(typeof S=="string"){g=new Uint8Array(S.length*2),w=0;for(let a=0,n=S.length;a<n;a++){const u=S.charCodeAt(a);u<=255?g[w++]=u:(g[w++]=u>>>8,g[w++]=u&255)}}else if((0,p.isArrayBuffer)(S))g=S.slice(),w=g.byteLength;else throw new Error("Wrong data format in MurmurHash3_64_update. Input must be a string or array.");const C=w>>2,y=w-C*4,d=new Uint32Array(g.buffer,0,C);let _=0,s=0,r=this.h1,P=this.h2;const R=3432918353,A=461845907,t=R&G,l=A&G;for(let a=0;a<C;a++)a&1?(_=d[a],_=_*R&$|_*t&G,_=_<<15|_>>>17,_=_*A&$|_*l&G,r^=_,r=r<<13|r>>>19,r=r*5+3864292196):(s=d[a],s=s*R&$|s*t&G,s=s<<15|s>>>17,s=s*A&$|s*l&G,P^=s,P=P<<13|P>>>19,P=P*5+3864292196);switch(_=0,y){case 3:_^=g[C*4+2]<<16;case 2:_^=g[C*4+1]<<8;case 1:_^=g[C*4],_=_*R&$|_*t&G,_=_<<15|_>>>17,_=_*A&$|_*l&G,C&1?r^=_:P^=_}this.h1=r,this.h2=P}hexdigest(){let S=this.h1,g=this.h2;return S^=g>>>1,S=S*3981806797&$|S*36045&G,g=g*4283543511&$|((g<<16|S>>>16)*2950163797&$)>>>16,S^=g>>>1,S=S*444984403&$|S*60499&G,g=g*3301882366&$|((g<<16|S>>>16)*3120437893&$)>>>16,S^=g>>>1,(S>>>0).toString(16).padStart(8,"0")+(g>>>0).toString(16).padStart(8,"0")}}f.MurmurHash3_64=et},(ot,f,z)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.FontLoader=f.FontFaceObject=void 0;var p=z(1),T=z(10);class ${constructor({ownerDocument:I=globalThis.document,styleElement:S=null}){this._document=I,this.nativeFontFaces=[],this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(I){this.nativeFontFaces.push(I),this._document.fonts.add(I)}insertRule(I){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const S=this.styleElement.sheet;S.insertRule(I,S.cssRules.length)}clear(){for(const I of this.nativeFontFaces)this._document.fonts.delete(I);this.nativeFontFaces.length=0,this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async bind(I){if(I.attached||I.missingFile)return;if(I.attached=!0,this.isFontLoadingAPISupported){const g=I.createNativeFontFace();if(g){this.addNativeFontFace(g);try{await g.loaded}catch(w){throw(0,p.warn)(`Failed to load font '${g.family}': '${w}'.`),I.disableFontFace=!0,w}}return}const S=I.createFontFaceRule();if(S){if(this.insertRule(S),this.isSyncFontLoadingSupported)return;await new Promise(g=>{const w=this._queueLoadingCallback(g);this._prepareFontLoadEvent(I,w)})}}get isFontLoadingAPISupported(){var S;const I=!!((S=this._document)!=null&&S.fonts);return(0,p.shadow)(this,"isFontLoadingAPISupported",I)}get isSyncFontLoadingSupported(){let I=!1;return(T.isNodeJS||typeof navigator<"u"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(I=!0),(0,p.shadow)(this,"isSyncFontLoadingSupported",I)}_queueLoadingCallback(I){function S(){for((0,p.assert)(!w.done,"completeRequest() cannot be called twice."),w.done=!0;g.length>0&&g[0].done;){const C=g.shift();setTimeout(C.callback,0)}}const{loadingRequests:g}=this,w={done:!1,complete:S,callback:I};return g.push(w),w}get _loadTestFont(){const I=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return(0,p.shadow)(this,"_loadTestFont",I)}_prepareFontLoadEvent(I,S){function g(i,M){return i.charCodeAt(M)<<24|i.charCodeAt(M+1)<<16|i.charCodeAt(M+2)<<8|i.charCodeAt(M+3)&255}function w(i,M,V,Y){const Q=i.substring(0,M),st=i.substring(M+V);return Q+Y+st}let C,y;const d=this._document.createElement("canvas");d.width=1,d.height=1;const _=d.getContext("2d");let s=0;function r(i,M){if(++s>30){(0,p.warn)("Load test font never loaded."),M();return}if(_.font="30px "+i,_.fillText(".",0,20),_.getImageData(0,0,1,1).data[3]>0){M();return}setTimeout(r.bind(null,i,M))}const P=`lt${Date.now()}${this.loadTestFontId++}`;let R=this._loadTestFont;R=w(R,976,P.length,P);const t=16,l=1482184792;let a=g(R,t);for(C=0,y=P.length-3;C<y;C+=4)a=a-l+g(P,C)|0;C<P.length&&(a=a-l+g(P+"XXX",C)|0),R=w(R,t,4,(0,p.string32)(a));const n=`url(data:font/opentype;base64,${btoa(R)});`,u=`@font-face {font-family:"${P}";src:${n}}`;this.insertRule(u);const E=this._document.createElement("div");E.style.visibility="hidden",E.style.width=E.style.height="10px",E.style.position="absolute",E.style.top=E.style.left="0px";for(const i of[I.loadedName,P]){const M=this._document.createElement("span");M.textContent="Hi",M.style.fontFamily=i,E.append(M)}this._document.body.append(E),r(P,()=>{E.remove(),S.complete()})}}f.FontLoader=$;class G{constructor(I,{isEvalSupported:S=!0,disableFontFace:g=!1,ignoreErrors:w=!1,inspectFont:C=null}){this.compiledGlyphs=Object.create(null);for(const y in I)this[y]=I[y];this.isEvalSupported=S!==!1,this.disableFontFace=g===!0,this.ignoreErrors=w===!0,this._inspectFont=C}createNativeFontFace(){var S;if(!this.data||this.disableFontFace)return null;let I;if(!this.cssFontInfo)I=new FontFace(this.loadedName,this.data,{});else{const g={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(g.style=`oblique ${this.cssFontInfo.italicAngle}deg`),I=new FontFace(this.cssFontInfo.fontFamily,this.data,g)}return(S=this._inspectFont)==null||S.call(this,this),I}createFontFaceRule(){var w;if(!this.data||this.disableFontFace)return null;const I=(0,p.bytesToString)(this.data),S=`url(data:${this.mimetype};base64,${btoa(I)});`;let g;if(!this.cssFontInfo)g=`@font-face {font-family:"${this.loadedName}";src:${S}}`;else{let C=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(C+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),g=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${C}src:${S}}`}return(w=this._inspectFont)==null||w.call(this,this,S),g}getPathGenerator(I,S){if(this.compiledGlyphs[S]!==void 0)return this.compiledGlyphs[S];let g;try{g=I.get(this.loadedName+"_path_"+S)}catch(w){if(!this.ignoreErrors)throw w;return(0,p.warn)(`getPathGenerator - ignoring character: "${w}".`),this.compiledGlyphs[S]=function(C,y){}}if(this.isEvalSupported&&p.FeatureTest.isEvalSupported){const w=[];for(const C of g){const y=C.args!==void 0?C.args.join(","):"";w.push("c.",C.cmd,"(",y,`);
`)}return this.compiledGlyphs[S]=new Function("c","size",w.join(""))}return this.compiledGlyphs[S]=function(w,C){for(const y of g)y.cmd==="scale"&&(y.args=[C,-C]),w[y.cmd].apply(w,y.args)}}}f.FontFaceObject=G},(ot,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.isNodeJS=void 0;const z=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser");f.isNodeJS=z},(ot,f,z)=>{var dt,me;Object.defineProperty(f,"__esModule",{value:!0}),f.CanvasGraphics=void 0;var p=z(1),T=z(6),$=z(12),G=z(13),et=z(10);const I=16,S=100,g=4096,w=15,C=10,y=1e3,d=16;function _(U,c){if(U._removeMirroring)throw new Error("Context is already forwarding operations.");U.__originalSave=U.save,U.__originalRestore=U.restore,U.__originalRotate=U.rotate,U.__originalScale=U.scale,U.__originalTranslate=U.translate,U.__originalTransform=U.transform,U.__originalSetTransform=U.setTransform,U.__originalResetTransform=U.resetTransform,U.__originalClip=U.clip,U.__originalMoveTo=U.moveTo,U.__originalLineTo=U.lineTo,U.__originalBezierCurveTo=U.bezierCurveTo,U.__originalRect=U.rect,U.__originalClosePath=U.closePath,U.__originalBeginPath=U.beginPath,U._removeMirroring=()=>{U.save=U.__originalSave,U.restore=U.__originalRestore,U.rotate=U.__originalRotate,U.scale=U.__originalScale,U.translate=U.__originalTranslate,U.transform=U.__originalTransform,U.setTransform=U.__originalSetTransform,U.resetTransform=U.__originalResetTransform,U.clip=U.__originalClip,U.moveTo=U.__originalMoveTo,U.lineTo=U.__originalLineTo,U.bezierCurveTo=U.__originalBezierCurveTo,U.rect=U.__originalRect,U.closePath=U.__originalClosePath,U.beginPath=U.__originalBeginPath,delete U._removeMirroring},U.save=function(){c.save(),this.__originalSave()},U.restore=function(){c.restore(),this.__originalRestore()},U.translate=function(v,j){c.translate(v,j),this.__originalTranslate(v,j)},U.scale=function(v,j){c.scale(v,j),this.__originalScale(v,j)},U.transform=function(v,j,D,q,H,K){c.transform(v,j,D,q,H,K),this.__originalTransform(v,j,D,q,H,K)},U.setTransform=function(v,j,D,q,H,K){c.setTransform(v,j,D,q,H,K),this.__originalSetTransform(v,j,D,q,H,K)},U.resetTransform=function(){c.resetTransform(),this.__originalResetTransform()},U.rotate=function(v){c.rotate(v),this.__originalRotate(v)},U.clip=function(v){c.clip(v),this.__originalClip(v)},U.moveTo=function(h,v){c.moveTo(h,v),this.__originalMoveTo(h,v)},U.lineTo=function(h,v){c.lineTo(h,v),this.__originalLineTo(h,v)},U.bezierCurveTo=function(h,v,j,D,q,H){c.bezierCurveTo(h,v,j,D,q,H),this.__originalBezierCurveTo(h,v,j,D,q,H)},U.rect=function(h,v,j,D){c.rect(h,v,j,D),this.__originalRect(h,v,j,D)},U.closePath=function(){c.closePath(),this.__originalClosePath()},U.beginPath=function(){c.beginPath(),this.__originalBeginPath()}}class s{constructor(c){this.canvasFactory=c,this.cache=Object.create(null)}getCanvas(c,h,v){let j;return this.cache[c]!==void 0?(j=this.cache[c],this.canvasFactory.reset(j,h,v)):(j=this.canvasFactory.create(h,v),this.cache[c]=j),j}delete(c){delete this.cache[c]}clear(){for(const c in this.cache){const h=this.cache[c];this.canvasFactory.destroy(h),delete this.cache[c]}}}function r(U,c,h,v,j,D,q,H,K,X){const[L,k,e,o,b,x]=(0,T.getCurrentTransform)(U);if(k===0&&e===0){const it=q*L+b,tt=Math.round(it),rt=H*o+x,at=Math.round(rt),ut=(q+K)*L+b,ct=Math.abs(Math.round(ut)-tt)||1,mt=(H+X)*o+x,gt=Math.abs(Math.round(mt)-at)||1;return U.setTransform(Math.sign(L),0,0,Math.sign(o),tt,at),U.drawImage(c,h,v,j,D,0,0,ct,gt),U.setTransform(L,k,e,o,b,x),[ct,gt]}if(L===0&&o===0){const it=H*e+b,tt=Math.round(it),rt=q*k+x,at=Math.round(rt),ut=(H+X)*e+b,ct=Math.abs(Math.round(ut)-tt)||1,mt=(q+K)*k+x,gt=Math.abs(Math.round(mt)-at)||1;return U.setTransform(0,Math.sign(k),Math.sign(e),0,tt,at),U.drawImage(c,h,v,j,D,0,0,gt,ct),U.setTransform(L,k,e,o,b,x),[gt,ct]}U.drawImage(c,h,v,j,D,q,H,K,X);const O=Math.hypot(L,k),N=Math.hypot(e,o);return[O*K,N*X]}function P(U){const{width:c,height:h}=U;if(c>y||h>y)return null;const v=1e3,j=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),D=c+1;let q=new Uint8Array(D*(h+1)),H,K,X;const L=c+7&-8;let k=new Uint8Array(L*h),e=0;for(const N of U.data){let it=128;for(;it>0;)k[e++]=N&it?0:255,it>>=1}let o=0;for(e=0,k[e]!==0&&(q[0]=1,++o),K=1;K<c;K++)k[e]!==k[e+1]&&(q[K]=k[e]?2:1,++o),e++;for(k[e]!==0&&(q[K]=2,++o),H=1;H<h;H++){e=H*L,X=H*D,k[e-L]!==k[e]&&(q[X]=k[e]?1:8,++o);let N=(k[e]?4:0)+(k[e-L]?8:0);for(K=1;K<c;K++)N=(N>>2)+(k[e+1]?4:0)+(k[e-L+1]?8:0),j[N]&&(q[X+K]=j[N],++o),e++;if(k[e-L]!==k[e]&&(q[X+K]=k[e]?2:4,++o),o>v)return null}for(e=L*(h-1),X=H*D,k[e]!==0&&(q[X]=8,++o),K=1;K<c;K++)k[e]!==k[e+1]&&(q[X+K]=k[e]?4:8,++o),e++;if(k[e]!==0&&(q[X+K]=4,++o),o>v)return null;const b=new Int32Array([0,D,-1,0,-D,0,0,0,1]),x=new Path2D;for(H=0;o&&H<=h;H++){let N=H*D;const it=N+c;for(;N<it&&!q[N];)N++;if(N===it)continue;x.moveTo(N%D,H);const tt=N;let rt=q[N];do{const at=b[rt];do N+=at;while(!q[N]);const ut=q[N];ut!==5&&ut!==10?(rt=ut,q[N]=0):(rt=ut&51*rt>>4,q[N]&=rt>>2|rt<<2),x.lineTo(N%D,N/D|0),q[N]||--o}while(tt!==N);--H}return k=null,q=null,function(N){N.save(),N.scale(1/c,-1/h),N.translate(0,-h),N.fill(x),N.beginPath(),N.restore()}}class R{constructor(c,h){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=p.IDENTITY_MATRIX,this.textMatrixScale=1,this.fontMatrix=p.FONT_IDENTITY_MATRIX,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=p.TextRenderingMode.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,c,h])}clone(){const c=Object.create(this);return c.clipBox=this.clipBox.slice(),c}setCurrentPoint(c,h){this.x=c,this.y=h}updatePathMinMax(c,h,v){[h,v]=p.Util.applyTransform([h,v],c),this.minX=Math.min(this.minX,h),this.minY=Math.min(this.minY,v),this.maxX=Math.max(this.maxX,h),this.maxY=Math.max(this.maxY,v)}updateRectMinMax(c,h){const v=p.Util.applyTransform(h,c),j=p.Util.applyTransform(h.slice(2),c);this.minX=Math.min(this.minX,v[0],j[0]),this.minY=Math.min(this.minY,v[1],j[1]),this.maxX=Math.max(this.maxX,v[0],j[0]),this.maxY=Math.max(this.maxY,v[1],j[1])}updateScalingPathMinMax(c,h){p.Util.scaleMinMax(c,h),this.minX=Math.min(this.minX,h[0]),this.maxX=Math.max(this.maxX,h[1]),this.minY=Math.min(this.minY,h[2]),this.maxY=Math.max(this.maxY,h[3])}updateCurvePathMinMax(c,h,v,j,D,q,H,K,X,L){const k=p.Util.bezierBoundingBox(h,v,j,D,q,H,K,X);if(L){L[0]=Math.min(L[0],k[0],k[2]),L[1]=Math.max(L[1],k[0],k[2]),L[2]=Math.min(L[2],k[1],k[3]),L[3]=Math.max(L[3],k[1],k[3]);return}this.updateRectMinMax(c,k)}getPathBoundingBox(c=$.PathType.FILL,h=null){const v=[this.minX,this.minY,this.maxX,this.maxY];if(c===$.PathType.STROKE){h||(0,p.unreachable)("Stroke bounding box must include transform.");const j=p.Util.singularValueDecompose2dScale(h),D=j[0]*this.lineWidth/2,q=j[1]*this.lineWidth/2;v[0]-=D,v[1]-=q,v[2]+=D,v[3]+=q}return v}updateClipFromPath(){const c=p.Util.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(c||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(c){this.clipBox=c,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(c=$.PathType.FILL,h=null){return p.Util.intersect(this.clipBox,this.getPathBoundingBox(c,h))}}function A(U,c){if(typeof ImageData<"u"&&c instanceof ImageData){U.putImageData(c,0,0);return}const h=c.height,v=c.width,j=h%d,D=(h-j)/d,q=j===0?D:D+1,H=U.createImageData(v,d);let K=0,X;const L=c.data,k=H.data;let e,o,b,x;if(c.kind===p.ImageKind.GRAYSCALE_1BPP){const O=L.byteLength,N=new Uint32Array(k.buffer,0,k.byteLength>>2),it=N.length,tt=v+7>>3,rt=4294967295,at=p.FeatureTest.isLittleEndian?4278190080:255;for(e=0;e<q;e++){for(b=e<D?d:j,X=0,o=0;o<b;o++){const ut=O-K;let ct=0;const mt=ut>tt?v:ut*8-7,gt=mt&-8;let Et=0,At=0;for(;ct<gt;ct+=8)At=L[K++],N[X++]=At&128?rt:at,N[X++]=At&64?rt:at,N[X++]=At&32?rt:at,N[X++]=At&16?rt:at,N[X++]=At&8?rt:at,N[X++]=At&4?rt:at,N[X++]=At&2?rt:at,N[X++]=At&1?rt:at;for(;ct<mt;ct++)Et===0&&(At=L[K++],Et=128),N[X++]=At&Et?rt:at,Et>>=1}for(;X<it;)N[X++]=0;U.putImageData(H,0,e*d)}}else if(c.kind===p.ImageKind.RGBA_32BPP){for(o=0,x=v*d*4,e=0;e<D;e++)k.set(L.subarray(K,K+x)),K+=x,U.putImageData(H,0,o),o+=d;e<q&&(x=v*j*4,k.set(L.subarray(K,K+x)),U.putImageData(H,0,o))}else if(c.kind===p.ImageKind.RGB_24BPP)for(b=d,x=v*b,e=0;e<q;e++){for(e>=D&&(b=j,x=v*b),X=0,o=x;o--;)k[X++]=L[K++],k[X++]=L[K++],k[X++]=L[K++],k[X++]=255;U.putImageData(H,0,e*d)}else throw new Error(`bad image kind: ${c.kind}`)}function t(U,c){if(c.bitmap){U.drawImage(c.bitmap,0,0);return}const h=c.height,v=c.width,j=h%d,D=(h-j)/d,q=j===0?D:D+1,H=U.createImageData(v,d);let K=0;const X=c.data,L=H.data;for(let k=0;k<q;k++){const e=k<D?d:j;({srcPos:K}=(0,G.convertBlackAndWhiteToRGBA)({src:X,srcPos:K,dest:L,width:v,height:e,nonBlackColor:0})),U.putImageData(H,0,k*d)}}function l(U,c){const h=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const v of h)U[v]!==void 0&&(c[v]=U[v]);U.setLineDash!==void 0&&(c.setLineDash(U.getLineDash()),c.lineDashOffset=U.lineDashOffset)}function a(U){U.strokeStyle=U.fillStyle="#000000",U.fillRule="nonzero",U.globalAlpha=1,U.lineWidth=1,U.lineCap="butt",U.lineJoin="miter",U.miterLimit=10,U.globalCompositeOperation="source-over",U.font="10px sans-serif",U.setLineDash!==void 0&&(U.setLineDash([]),U.lineDashOffset=0),et.isNodeJS||(U.filter="none")}function n(U,c,h,v){const j=U.length;for(let D=3;D<j;D+=4){const q=U[D];if(q===0)U[D-3]=c,U[D-2]=h,U[D-1]=v;else if(q<255){const H=255-q;U[D-3]=U[D-3]*q+c*H>>8,U[D-2]=U[D-2]*q+h*H>>8,U[D-1]=U[D-1]*q+v*H>>8}}}function u(U,c,h){const v=U.length,j=1/255;for(let D=3;D<v;D+=4){const q=h?h[U[D]]:U[D];c[D]=c[D]*q*j|0}}function E(U,c,h){const v=U.length;for(let j=3;j<v;j+=4){const D=U[j-3]*77+U[j-2]*152+U[j-1]*28;c[j]=h?c[j]*h[D>>8]>>8:c[j]*D>>16}}function i(U,c,h,v,j,D,q,H,K,X,L){const k=!!D,e=k?D[0]:0,o=k?D[1]:0,b=k?D[2]:0;let x;j==="Luminosity"?x=E:x=u;const N=Math.min(v,Math.ceil(1048576/h));for(let it=0;it<v;it+=N){const tt=Math.min(N,v-it),rt=U.getImageData(H-X,it+(K-L),h,tt),at=c.getImageData(H,it+K,h,tt);k&&n(rt.data,e,o,b),x(rt.data,at.data,q),c.putImageData(at,H,it+K)}}function M(U,c,h,v){const j=v[0],D=v[1],q=v[2]-j,H=v[3]-D;q===0||H===0||(i(c.context,h,q,H,c.subtype,c.backdrop,c.transferMap,j,D,c.offsetX,c.offsetY),U.save(),U.globalAlpha=1,U.globalCompositeOperation="source-over",U.setTransform(1,0,0,1,0,0),U.drawImage(h.canvas,0,0),U.restore())}function V(U,c){const h=p.Util.singularValueDecompose2dScale(U);h[0]=Math.fround(h[0]),h[1]=Math.fround(h[1]);const v=Math.fround((globalThis.devicePixelRatio||1)*T.PixelsPerInch.PDF_TO_CSS_UNITS);return c!==void 0?c:h[0]<=v||h[1]<=v}const Y=["butt","round","square"],Q=["miter","round","bevel"],st={},ft={},yt=class{constructor(c,h,v,j,D,{optionalContentConfig:q,markedContentStack:H=null},K){Z(this,dt);this.ctx=c,this.current=new R(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=h,this.objs=v,this.canvasFactory=j,this.filterFactory=D,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=H||[],this.optionalContentConfig=q,this.cachedCanvases=new s(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=K,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(c,h=null){return typeof c=="string"?c.startsWith("g_")?this.commonObjs.get(c):this.objs.get(c):h}beginDrawing({transform:c,viewport:h,transparency:v=!1,background:j=null}){const D=this.ctx.canvas.width,q=this.ctx.canvas.height,H=this.ctx.fillStyle;if(this.ctx.fillStyle=j||"#ffffff",this.ctx.fillRect(0,0,D,q),this.ctx.fillStyle=H,v){const K=this.cachedCanvases.getCanvas("transparent",D,q);this.compositeCtx=this.ctx,this.transparentCanvas=K.canvas,this.ctx=K.context,this.ctx.save(),this.ctx.transform(...(0,T.getCurrentTransform)(this.compositeCtx))}this.ctx.save(),a(this.ctx),c&&(this.ctx.transform(...c),this.outputScaleX=c[0],this.outputScaleY=c[0]),this.ctx.transform(...h.transform),this.viewportScale=h.scale,this.baseTransform=(0,T.getCurrentTransform)(this.ctx)}executeOperatorList(c,h,v,j){const D=c.argsArray,q=c.fnArray;let H=h||0;const K=D.length;if(K===H)return H;const X=K-H>C&&typeof v=="function",L=X?Date.now()+w:0;let k=0;const e=this.commonObjs,o=this.objs;let b;for(;;){if(j!==void 0&&H===j.nextBreakPoint)return j.breakIt(H,v),H;if(b=q[H],b!==p.OPS.dependency)this[b].apply(this,D[H]);else for(const x of D[H]){const O=x.startsWith("g_")?e:o;if(!O.has(x))return O.get(x,v),H}if(H++,H===K)return H;if(X&&++k>C){if(Date.now()>L)return v(),H;k=0}}}endDrawing(c=null){lt(this,dt,me).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const h of this._cachedBitmapsMap.values()){for(const v of h.values())typeof HTMLCanvasElement<"u"&&v instanceof HTMLCanvasElement&&(v.width=v.height=0);h.clear()}if(this._cachedBitmapsMap.clear(),c){const h=this.filterFactory.addHCMFilter(c.foreground,c.background);if(h!=="none"){const v=this.ctx.filter;this.ctx.filter=h,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=v}}}_scaleImage(c,h){const v=c.width,j=c.height;let D=Math.max(Math.hypot(h[0],h[1]),1),q=Math.max(Math.hypot(h[2],h[3]),1),H=v,K=j,X="prescale1",L,k;for(;D>2&&H>1||q>2&&K>1;){let e=H,o=K;D>2&&H>1&&(e=H>=16384?Math.floor(H/2)-1||1:Math.ceil(H/2),D/=H/e),q>2&&K>1&&(o=K>=16384?Math.floor(K/2)-1||1:Math.ceil(K)/2,q/=K/o),L=this.cachedCanvases.getCanvas(X,e,o),k=L.context,k.clearRect(0,0,e,o),k.drawImage(c,0,0,H,K,0,0,e,o),c=L.canvas,H=e,K=o,X=X==="prescale1"?"prescale2":"prescale1"}return{img:c,paintWidth:H,paintHeight:K}}_createMaskCanvas(c){const h=this.ctx,{width:v,height:j}=c,D=this.current.fillColor,q=this.current.patternFill,H=(0,T.getCurrentTransform)(h);let K,X,L,k;if((c.bitmap||c.data)&&c.count>1){const ct=c.bitmap||c.data.buffer;X=JSON.stringify(q?H:[H.slice(0,4),D]),K=this._cachedBitmapsMap.get(ct),K||(K=new Map,this._cachedBitmapsMap.set(ct,K));const mt=K.get(X);if(mt&&!q){const gt=Math.round(Math.min(H[0],H[2])+H[4]),Et=Math.round(Math.min(H[1],H[3])+H[5]);return{canvas:mt,offsetX:gt,offsetY:Et}}L=mt}L||(k=this.cachedCanvases.getCanvas("maskCanvas",v,j),t(k.context,c));let e=p.Util.transform(H,[1/v,0,0,-1/j,0,0]);e=p.Util.transform(e,[1,0,0,1,0,-j]);const o=p.Util.applyTransform([0,0],e),b=p.Util.applyTransform([v,j],e),x=p.Util.normalizeRect([o[0],o[1],b[0],b[1]]),O=Math.round(x[2]-x[0])||1,N=Math.round(x[3]-x[1])||1,it=this.cachedCanvases.getCanvas("fillCanvas",O,N),tt=it.context,rt=Math.min(o[0],b[0]),at=Math.min(o[1],b[1]);tt.translate(-rt,-at),tt.transform(...e),L||(L=this._scaleImage(k.canvas,(0,T.getCurrentTransformInverse)(tt)),L=L.img,K&&q&&K.set(X,L)),tt.imageSmoothingEnabled=V((0,T.getCurrentTransform)(tt),c.interpolate),r(tt,L,0,0,L.width,L.height,0,0,v,j),tt.globalCompositeOperation="source-in";const ut=p.Util.transform((0,T.getCurrentTransformInverse)(tt),[1,0,0,1,-rt,-at]);return tt.fillStyle=q?D.getPattern(h,this,ut,$.PathType.FILL):D,tt.fillRect(0,0,v,j),K&&!q&&(this.cachedCanvases.delete("fillCanvas"),K.set(X,it.canvas)),{canvas:it.canvas,offsetX:Math.round(rt),offsetY:Math.round(at)}}setLineWidth(c){c!==this.current.lineWidth&&(this._cachedScaleForStroking=null),this.current.lineWidth=c,this.ctx.lineWidth=c}setLineCap(c){this.ctx.lineCap=Y[c]}setLineJoin(c){this.ctx.lineJoin=Q[c]}setMiterLimit(c){this.ctx.miterLimit=c}setDash(c,h){const v=this.ctx;v.setLineDash!==void 0&&(v.setLineDash(c),v.lineDashOffset=h)}setRenderingIntent(c){}setFlatness(c){}setGState(c){for(const[h,v]of c)switch(h){case"LW":this.setLineWidth(v);break;case"LC":this.setLineCap(v);break;case"LJ":this.setLineJoin(v);break;case"ML":this.setMiterLimit(v);break;case"D":this.setDash(v[0],v[1]);break;case"RI":this.setRenderingIntent(v);break;case"FL":this.setFlatness(v);break;case"Font":this.setFont(v[0],v[1]);break;case"CA":this.current.strokeAlpha=v;break;case"ca":this.current.fillAlpha=v,this.ctx.globalAlpha=v;break;case"BM":this.ctx.globalCompositeOperation=v;break;case"SMask":this.current.activeSMask=v?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(v);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const c=this.inSMaskMode;this.current.activeSMask&&!c?this.beginSMaskMode():!this.current.activeSMask&&c&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const c=this.ctx.canvas.width,h=this.ctx.canvas.height,v="smaskGroupAt"+this.groupLevel,j=this.cachedCanvases.getCanvas(v,c,h);this.suspendedCtx=this.ctx,this.ctx=j.context;const D=this.ctx;D.setTransform(...(0,T.getCurrentTransform)(this.suspendedCtx)),l(this.suspendedCtx,D),_(D,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),l(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(c){if(!this.current.activeSMask)return;c?(c[0]=Math.floor(c[0]),c[1]=Math.floor(c[1]),c[2]=Math.ceil(c[2]),c[3]=Math.ceil(c[3])):c=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const h=this.current.activeSMask,v=this.suspendedCtx;M(v,h,this.ctx,c),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}save(){this.inSMaskMode?(l(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const c=this.current;this.stateStack.push(c),this.current=c.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),l(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null)}transform(c,h,v,j,D,q){this.ctx.transform(c,h,v,j,D,q),this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null}constructPath(c,h,v){const j=this.ctx,D=this.current;let q=D.x,H=D.y,K,X;const L=(0,T.getCurrentTransform)(j),k=L[0]===0&&L[3]===0||L[1]===0&&L[2]===0,e=k?v.slice(0):null;for(let o=0,b=0,x=c.length;o<x;o++)switch(c[o]|0){case p.OPS.rectangle:q=h[b++],H=h[b++];const O=h[b++],N=h[b++],it=q+O,tt=H+N;j.moveTo(q,H),O===0||N===0?j.lineTo(it,tt):(j.lineTo(it,H),j.lineTo(it,tt),j.lineTo(q,tt)),k||D.updateRectMinMax(L,[q,H,it,tt]),j.closePath();break;case p.OPS.moveTo:q=h[b++],H=h[b++],j.moveTo(q,H),k||D.updatePathMinMax(L,q,H);break;case p.OPS.lineTo:q=h[b++],H=h[b++],j.lineTo(q,H),k||D.updatePathMinMax(L,q,H);break;case p.OPS.curveTo:K=q,X=H,q=h[b+4],H=h[b+5],j.bezierCurveTo(h[b],h[b+1],h[b+2],h[b+3],q,H),D.updateCurvePathMinMax(L,K,X,h[b],h[b+1],h[b+2],h[b+3],q,H,e),b+=6;break;case p.OPS.curveTo2:K=q,X=H,j.bezierCurveTo(q,H,h[b],h[b+1],h[b+2],h[b+3]),D.updateCurvePathMinMax(L,K,X,q,H,h[b],h[b+1],h[b+2],h[b+3],e),q=h[b+2],H=h[b+3],b+=4;break;case p.OPS.curveTo3:K=q,X=H,q=h[b+2],H=h[b+3],j.bezierCurveTo(h[b],h[b+1],q,H,q,H),D.updateCurvePathMinMax(L,K,X,h[b],h[b+1],q,H,q,H,e),b+=4;break;case p.OPS.closePath:j.closePath();break}k&&D.updateScalingPathMinMax(L,e),D.setCurrentPoint(q,H)}closePath(){this.ctx.closePath()}stroke(c=!0){const h=this.ctx,v=this.current.strokeColor;h.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof v=="object"&&(v!=null&&v.getPattern)?(h.save(),h.strokeStyle=v.getPattern(h,this,(0,T.getCurrentTransformInverse)(h),$.PathType.STROKE),this.rescaleAndStroke(!1),h.restore()):this.rescaleAndStroke(!0)),c&&this.consumePath(this.current.getClippedPathBoundingBox()),h.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(c=!0){const h=this.ctx,v=this.current.fillColor,j=this.current.patternFill;let D=!1;j&&(h.save(),h.fillStyle=v.getPattern(h,this,(0,T.getCurrentTransformInverse)(h),$.PathType.FILL),D=!0);const q=this.current.getClippedPathBoundingBox();this.contentVisible&&q!==null&&(this.pendingEOFill?(h.fill("evenodd"),this.pendingEOFill=!1):h.fill()),D&&h.restore(),c&&this.consumePath(q)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=st}eoClip(){this.pendingClip=ft}beginText(){this.current.textMatrix=p.IDENTITY_MATRIX,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const c=this.pendingTextPaths,h=this.ctx;if(c===void 0){h.beginPath();return}h.save(),h.beginPath();for(const v of c)h.setTransform(...v.transform),h.translate(v.x,v.y),v.addToPath(h,v.fontSize);h.restore(),h.clip(),h.beginPath(),delete this.pendingTextPaths}setCharSpacing(c){this.current.charSpacing=c}setWordSpacing(c){this.current.wordSpacing=c}setHScale(c){this.current.textHScale=c/100}setLeading(c){this.current.leading=-c}setFont(c,h){const v=this.commonObjs.get(c),j=this.current;if(!v)throw new Error(`Can't find font for ${c}`);if(j.fontMatrix=v.fontMatrix||p.FONT_IDENTITY_MATRIX,(j.fontMatrix[0]===0||j.fontMatrix[3]===0)&&(0,p.warn)("Invalid font matrix for font "+c),h<0?(h=-h,j.fontDirection=-1):j.fontDirection=1,this.current.font=v,this.current.fontSize=h,v.isType3Font)return;const D=v.loadedName||"sans-serif";let q="normal";v.black?q="900":v.bold&&(q="bold");const H=v.italic?"italic":"normal",K=`"${D}", ${v.fallbackName}`;let X=h;h<I?X=I:h>S&&(X=S),this.current.fontSizeScale=h/X,this.ctx.font=`${H} ${q} ${X}px ${K}`}setTextRenderingMode(c){this.current.textRenderingMode=c}setTextRise(c){this.current.textRise=c}moveText(c,h){this.current.x=this.current.lineX+=c,this.current.y=this.current.lineY+=h}setLeadingMoveText(c,h){this.setLeading(-h),this.moveText(c,h)}setTextMatrix(c,h,v,j,D,q){this.current.textMatrix=[c,h,v,j,D,q],this.current.textMatrixScale=Math.hypot(c,h),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(c,h,v,j){const D=this.ctx,q=this.current,H=q.font,K=q.textRenderingMode,X=q.fontSize/q.fontSizeScale,L=K&p.TextRenderingMode.FILL_STROKE_MASK,k=!!(K&p.TextRenderingMode.ADD_TO_PATH_FLAG),e=q.patternFill&&!H.missingFile;let o;(H.disableFontFace||k||e)&&(o=H.getPathGenerator(this.commonObjs,c)),H.disableFontFace||e?(D.save(),D.translate(h,v),D.beginPath(),o(D,X),j&&D.setTransform(...j),(L===p.TextRenderingMode.FILL||L===p.TextRenderingMode.FILL_STROKE)&&D.fill(),(L===p.TextRenderingMode.STROKE||L===p.TextRenderingMode.FILL_STROKE)&&D.stroke(),D.restore()):((L===p.TextRenderingMode.FILL||L===p.TextRenderingMode.FILL_STROKE)&&D.fillText(c,h,v),(L===p.TextRenderingMode.STROKE||L===p.TextRenderingMode.FILL_STROKE)&&D.strokeText(c,h,v)),k&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:(0,T.getCurrentTransform)(D),x:h,y:v,fontSize:X,addToPath:o})}get isFontSubpixelAAEnabled(){const{context:c}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);c.scale(1.5,1),c.fillText("I",0,10);const h=c.getImageData(0,0,10,10).data;let v=!1;for(let j=3;j<h.length;j+=4)if(h[j]>0&&h[j]<255){v=!0;break}return(0,p.shadow)(this,"isFontSubpixelAAEnabled",v)}showText(c){const h=this.current,v=h.font;if(v.isType3Font)return this.showType3Text(c);const j=h.fontSize;if(j===0)return;const D=this.ctx,q=h.fontSizeScale,H=h.charSpacing,K=h.wordSpacing,X=h.fontDirection,L=h.textHScale*X,k=c.length,e=v.vertical,o=e?1:-1,b=v.defaultVMetrics,x=j*h.fontMatrix[0],O=h.textRenderingMode===p.TextRenderingMode.FILL&&!v.disableFontFace&&!h.patternFill;D.save(),D.transform(...h.textMatrix),D.translate(h.x,h.y+h.textRise),X>0?D.scale(L,-1):D.scale(L,1);let N;if(h.patternFill){D.save();const ut=h.fillColor.getPattern(D,this,(0,T.getCurrentTransformInverse)(D),$.PathType.FILL);N=(0,T.getCurrentTransform)(D),D.restore(),D.fillStyle=ut}let it=h.lineWidth;const tt=h.textMatrixScale;if(tt===0||it===0){const ut=h.textRenderingMode&p.TextRenderingMode.FILL_STROKE_MASK;(ut===p.TextRenderingMode.STROKE||ut===p.TextRenderingMode.FILL_STROKE)&&(it=this.getSinglePixelWidth())}else it/=tt;if(q!==1&&(D.scale(q,q),it/=q),D.lineWidth=it,v.isInvalidPDFjsFont){const ut=[];let ct=0;for(const mt of c)ut.push(mt.unicode),ct+=mt.width;D.fillText(ut.join(""),0,0),h.x+=ct*x*L,D.restore(),this.compose();return}let rt=0,at;for(at=0;at<k;++at){const ut=c[at];if(typeof ut=="number"){rt+=o*ut*j/1e3;continue}let ct=!1;const mt=(ut.isSpace?K:0)+H,gt=ut.fontChar,Et=ut.accent;let At,Pt,F=ut.width;if(e){const W=ut.vmetric||b,_t=-(ut.vmetric?W[1]:F*.5)*x,Ct=W[2]*x;F=W?-W[0]:F,At=_t/q,Pt=(rt+Ct)/q}else At=rt/q,Pt=0;if(v.remeasure&&F>0){const W=D.measureText(gt).width*1e3/j*q;if(F<W&&this.isFontSubpixelAAEnabled){const _t=F/W;ct=!0,D.save(),D.scale(_t,1),At/=_t}else F!==W&&(At+=(F-W)/2e3*j/q)}if(this.contentVisible&&(ut.isInFont||v.missingFile)){if(O&&!Et)D.fillText(gt,At,Pt);else if(this.paintChar(gt,At,Pt,N),Et){const W=At+j*Et.offset.x/q,_t=Pt-j*Et.offset.y/q;this.paintChar(Et.fontChar,W,_t,N)}}let B;e?B=F*x-mt*X:B=F*x+mt*X,rt+=B,ct&&D.restore()}e?h.y-=rt:h.x+=rt*L,D.restore(),this.compose()}showType3Text(c){const h=this.ctx,v=this.current,j=v.font,D=v.fontSize,q=v.fontDirection,H=j.vertical?1:-1,K=v.charSpacing,X=v.wordSpacing,L=v.textHScale*q,k=v.fontMatrix||p.FONT_IDENTITY_MATRIX,e=c.length,o=v.textRenderingMode===p.TextRenderingMode.INVISIBLE;let b,x,O,N;if(!(o||D===0)){for(this._cachedScaleForStroking=null,this._cachedGetSinglePixelWidth=null,h.save(),h.transform(...v.textMatrix),h.translate(v.x,v.y),h.scale(L,q),b=0;b<e;++b){if(x=c[b],typeof x=="number"){N=H*x*D/1e3,this.ctx.translate(N,0),v.x+=N*L;continue}const it=(x.isSpace?X:0)+K,tt=j.charProcOperatorList[x.operatorListId];if(!tt){(0,p.warn)(`Type3 character "${x.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=x,this.save(),h.scale(D,D),h.transform(...k),this.executeOperatorList(tt),this.restore()),O=p.Util.applyTransform([x.width,0],k)[0]*D+it,h.translate(O,0),v.x+=O*L}h.restore(),this.processingType3=null}}setCharWidth(c,h){}setCharWidthAndBounds(c,h,v,j,D,q){this.ctx.rect(v,j,D-v,q-j),this.ctx.clip(),this.endPath()}getColorN_Pattern(c){let h;if(c[0]==="TilingPattern"){const v=c[1],j=this.baseTransform||(0,T.getCurrentTransform)(this.ctx),D={createCanvasGraphics:q=>new yt(q,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};h=new $.TilingPattern(c,v,this.ctx,D,j)}else h=this._getPattern(c[1],c[2]);return h}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(c,h,v){const j=p.Util.makeHexColor(c,h,v);this.ctx.strokeStyle=j,this.current.strokeColor=j}setFillRGBColor(c,h,v){const j=p.Util.makeHexColor(c,h,v);this.ctx.fillStyle=j,this.current.fillColor=j,this.current.patternFill=!1}_getPattern(c,h=null){let v;return this.cachedPatterns.has(c)?v=this.cachedPatterns.get(c):(v=(0,$.getShadingPattern)(this.getObject(c)),this.cachedPatterns.set(c,v)),h&&(v.matrix=h),v}shadingFill(c){if(!this.contentVisible)return;const h=this.ctx;this.save();const v=this._getPattern(c);h.fillStyle=v.getPattern(h,this,(0,T.getCurrentTransformInverse)(h),$.PathType.SHADING);const j=(0,T.getCurrentTransformInverse)(h);if(j){const D=h.canvas,q=D.width,H=D.height,K=p.Util.applyTransform([0,0],j),X=p.Util.applyTransform([0,H],j),L=p.Util.applyTransform([q,0],j),k=p.Util.applyTransform([q,H],j),e=Math.min(K[0],X[0],L[0],k[0]),o=Math.min(K[1],X[1],L[1],k[1]),b=Math.max(K[0],X[0],L[0],k[0]),x=Math.max(K[1],X[1],L[1],k[1]);this.ctx.fillRect(e,o,b-e,x-o)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){(0,p.unreachable)("Should not call beginInlineImage")}beginImageData(){(0,p.unreachable)("Should not call beginImageData")}paintFormXObjectBegin(c,h){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),Array.isArray(c)&&c.length===6&&this.transform(...c),this.baseTransform=(0,T.getCurrentTransform)(this.ctx),h)){const v=h[2]-h[0],j=h[3]-h[1];this.ctx.rect(h[0],h[1],v,j),this.current.updateRectMinMax((0,T.getCurrentTransform)(this.ctx),h),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(c){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const h=this.ctx;c.isolated||(0,p.info)("TODO: Support non-isolated groups."),c.knockout&&(0,p.warn)("Knockout groups not supported.");const v=(0,T.getCurrentTransform)(h);if(c.matrix&&h.transform(...c.matrix),!c.bbox)throw new Error("Bounding box is required.");let j=p.Util.getAxialAlignedBoundingBox(c.bbox,(0,T.getCurrentTransform)(h));const D=[0,0,h.canvas.width,h.canvas.height];j=p.Util.intersect(j,D)||[0,0,0,0];const q=Math.floor(j[0]),H=Math.floor(j[1]);let K=Math.max(Math.ceil(j[2])-q,1),X=Math.max(Math.ceil(j[3])-H,1),L=1,k=1;K>g&&(L=K/g,K=g),X>g&&(k=X/g,X=g),this.current.startNewPathAndClipBox([0,0,K,X]);let e="groupAt"+this.groupLevel;c.smask&&(e+="_smask_"+this.smaskCounter++%2);const o=this.cachedCanvases.getCanvas(e,K,X),b=o.context;b.scale(1/L,1/k),b.translate(-q,-H),b.transform(...v),c.smask?this.smaskStack.push({canvas:o.canvas,context:b,offsetX:q,offsetY:H,scaleX:L,scaleY:k,subtype:c.smask.subtype,backdrop:c.smask.backdrop,transferMap:c.smask.transferMap||null,startTransformInverse:null}):(h.setTransform(1,0,0,1,0,0),h.translate(q,H),h.scale(L,k),h.save()),l(h,b),this.ctx=b,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(h),this.groupLevel++}endGroup(c){if(!this.contentVisible)return;this.groupLevel--;const h=this.ctx,v=this.groupStack.pop();if(this.ctx=v,this.ctx.imageSmoothingEnabled=!1,c.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const j=(0,T.getCurrentTransform)(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...j);const D=p.Util.getAxialAlignedBoundingBox([0,0,h.canvas.width,h.canvas.height],j);this.ctx.drawImage(h.canvas,0,0),this.ctx.restore(),this.compose(D)}}beginAnnotation(c,h,v,j,D){if(lt(this,dt,me).call(this),a(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),Array.isArray(h)&&h.length===4){const q=h[2]-h[0],H=h[3]-h[1];if(D&&this.annotationCanvasMap){v=v.slice(),v[4]-=h[0],v[5]-=h[1],h=h.slice(),h[0]=h[1]=0,h[2]=q,h[3]=H;const[K,X]=p.Util.singularValueDecompose2dScale((0,T.getCurrentTransform)(this.ctx)),{viewportScale:L}=this,k=Math.ceil(q*this.outputScaleX*L),e=Math.ceil(H*this.outputScaleY*L);this.annotationCanvas=this.canvasFactory.create(k,e);const{canvas:o,context:b}=this.annotationCanvas;this.annotationCanvasMap.set(c,o),this.annotationCanvas.savedCtx=this.ctx,this.ctx=b,this.ctx.setTransform(K,0,0,-X,0,H*X),a(this.ctx)}else a(this.ctx),this.ctx.rect(h[0],h[1],q,H),this.ctx.clip(),this.endPath()}this.current=new R(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...v),this.transform(...j)}endAnnotation(){this.annotationCanvas&&(this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(c){if(!this.contentVisible)return;const h=c.count;c=this.getObject(c.data,c),c.count=h;const v=this.ctx,j=this.processingType3;if(j&&(j.compiled===void 0&&(j.compiled=P(c)),j.compiled)){j.compiled(v);return}const D=this._createMaskCanvas(c),q=D.canvas;v.save(),v.setTransform(1,0,0,1,0,0),v.drawImage(q,D.offsetX,D.offsetY),v.restore(),this.compose()}paintImageMaskXObjectRepeat(c,h,v=0,j=0,D,q){if(!this.contentVisible)return;c=this.getObject(c.data,c);const H=this.ctx;H.save();const K=(0,T.getCurrentTransform)(H);H.transform(h,v,j,D,0,0);const X=this._createMaskCanvas(c);H.setTransform(1,0,0,1,X.offsetX-K[4],X.offsetY-K[5]);for(let L=0,k=q.length;L<k;L+=2){const e=p.Util.transform(K,[h,v,j,D,q[L],q[L+1]]),[o,b]=p.Util.applyTransform([0,0],e);H.drawImage(X.canvas,o,b)}H.restore(),this.compose()}paintImageMaskXObjectGroup(c){if(!this.contentVisible)return;const h=this.ctx,v=this.current.fillColor,j=this.current.patternFill;for(const D of c){const{data:q,width:H,height:K,transform:X}=D,L=this.cachedCanvases.getCanvas("maskCanvas",H,K),k=L.context;k.save();const e=this.getObject(q,D);t(k,e),k.globalCompositeOperation="source-in",k.fillStyle=j?v.getPattern(k,this,(0,T.getCurrentTransformInverse)(h),$.PathType.FILL):v,k.fillRect(0,0,H,K),k.restore(),h.save(),h.transform(...X),h.scale(1,-1),r(h,L.canvas,0,0,H,K,0,-1,1,1),h.restore()}this.compose()}paintImageXObject(c){if(!this.contentVisible)return;const h=this.getObject(c);if(!h){(0,p.warn)("Dependent image isn't ready yet");return}this.paintInlineImageXObject(h)}paintImageXObjectRepeat(c,h,v,j){if(!this.contentVisible)return;const D=this.getObject(c);if(!D){(0,p.warn)("Dependent image isn't ready yet");return}const q=D.width,H=D.height,K=[];for(let X=0,L=j.length;X<L;X+=2)K.push({transform:[h,0,0,v,j[X],j[X+1]],x:0,y:0,w:q,h:H});this.paintInlineImageXObjectGroup(D,K)}applyTransferMapsToCanvas(c){return this.current.transferMaps!=="none"&&(c.filter=this.current.transferMaps,c.drawImage(c.canvas,0,0),c.filter="none"),c.canvas}applyTransferMapsToBitmap(c){if(this.current.transferMaps==="none")return c.bitmap;const{bitmap:h,width:v,height:j}=c,D=this.cachedCanvases.getCanvas("inlineImage",v,j),q=D.context;return q.filter=this.current.transferMaps,q.drawImage(h,0,0),q.filter="none",D.canvas}paintInlineImageXObject(c){if(!this.contentVisible)return;const h=c.width,v=c.height,j=this.ctx;this.save(),et.isNodeJS||(j.filter="none"),j.scale(1/h,-1/v);let D;if(c.bitmap)D=this.applyTransferMapsToBitmap(c);else if(typeof HTMLElement=="function"&&c instanceof HTMLElement||!c.data)D=c;else{const K=this.cachedCanvases.getCanvas("inlineImage",h,v).context;A(K,c),D=this.applyTransferMapsToCanvas(K)}const q=this._scaleImage(D,(0,T.getCurrentTransformInverse)(j));j.imageSmoothingEnabled=V((0,T.getCurrentTransform)(j),c.interpolate),r(j,q.img,0,0,q.paintWidth,q.paintHeight,0,-v,h,v),this.compose(),this.restore()}paintInlineImageXObjectGroup(c,h){if(!this.contentVisible)return;const v=this.ctx;let j;if(c.bitmap)j=c.bitmap;else{const D=c.width,q=c.height,K=this.cachedCanvases.getCanvas("inlineImage",D,q).context;A(K,c),j=this.applyTransferMapsToCanvas(K)}for(const D of h)v.save(),v.transform(...D.transform),v.scale(1,-1),r(v,j,D.x,D.y,D.w,D.h,0,-1,1,1),v.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(c){}markPointProps(c,h){}beginMarkedContent(c){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(c,h){c==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(h)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(c){const h=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(c);const v=this.ctx;this.pendingClip&&(h||(this.pendingClip===ft?v.clip("evenodd"):v.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),v.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const c=(0,T.getCurrentTransform)(this.ctx);if(c[1]===0&&c[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(c[0]),Math.abs(c[3]));else{const h=Math.abs(c[0]*c[3]-c[2]*c[1]),v=Math.hypot(c[0],c[2]),j=Math.hypot(c[1],c[3]);this._cachedGetSinglePixelWidth=Math.max(v,j)/h}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(!this._cachedScaleForStroking){const{lineWidth:c}=this.current,h=(0,T.getCurrentTransform)(this.ctx);let v,j;if(h[1]===0&&h[2]===0){const D=Math.abs(h[0]),q=Math.abs(h[3]);if(c===0)v=1/D,j=1/q;else{const H=D*c,K=q*c;v=H<1?1/H:1,j=K<1?1/K:1}}else{const D=Math.abs(h[0]*h[3]-h[2]*h[1]),q=Math.hypot(h[0],h[1]),H=Math.hypot(h[2],h[3]);if(c===0)v=H/D,j=q/D;else{const K=c*D;v=H>K?H/K:1,j=q>K?q/K:1}}this._cachedScaleForStroking=[v,j]}return this._cachedScaleForStroking}rescaleAndStroke(c){const{ctx:h}=this,{lineWidth:v}=this.current,[j,D]=this.getScaleForStroking();if(h.lineWidth=v||1,j===1&&D===1){h.stroke();return}let q,H,K;c&&(q=(0,T.getCurrentTransform)(h),H=h.getLineDash().slice(),K=h.lineDashOffset),h.scale(j,D);const X=Math.max(j,D);h.setLineDash(h.getLineDash().map(L=>L/X)),h.lineDashOffset/=X,h.stroke(),c&&(h.setTransform(...q),h.setLineDash(H),h.lineDashOffset=K)}isContentVisible(){for(let c=this.markedContentStack.length-1;c>=0;c--)if(!this.markedContentStack[c].visible)return!1;return!0}};let nt=yt;dt=new WeakSet,me=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},f.CanvasGraphics=nt;for(const U in p.OPS)nt.prototype[U]!==void 0&&(nt.prototype[p.OPS[U]]=nt.prototype[U])},(ot,f,z)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.TilingPattern=f.PathType=void 0,f.getShadingPattern=y;var p=z(1),T=z(6);const $={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};f.PathType=$;function G(s,r){if(!r)return;const P=r[2]-r[0],R=r[3]-r[1],A=new Path2D;A.rect(r[0],r[1],P,R),s.clip(A)}class et{constructor(){this.constructor===et&&(0,p.unreachable)("Cannot initialize BaseShadingPattern.")}getPattern(){(0,p.unreachable)("Abstract method `getPattern` called.")}}class I extends et{constructor(r){super(),this._type=r[1],this._bbox=r[2],this._colorStops=r[3],this._p0=r[4],this._p1=r[5],this._r0=r[6],this._r1=r[7],this.matrix=null}_createGradient(r){let P;this._type==="axial"?P=r.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(P=r.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const R of this._colorStops)P.addColorStop(R[0],R[1]);return P}getPattern(r,P,R,A){let t;if(A===$.STROKE||A===$.FILL){const l=P.current.getClippedPathBoundingBox(A,(0,T.getCurrentTransform)(r))||[0,0,0,0],a=Math.ceil(l[2]-l[0])||1,n=Math.ceil(l[3]-l[1])||1,u=P.cachedCanvases.getCanvas("pattern",a,n,!0),E=u.context;E.clearRect(0,0,E.canvas.width,E.canvas.height),E.beginPath(),E.rect(0,0,E.canvas.width,E.canvas.height),E.translate(-l[0],-l[1]),R=p.Util.transform(R,[1,0,0,1,l[0],l[1]]),E.transform(...P.baseTransform),this.matrix&&E.transform(...this.matrix),G(E,this._bbox),E.fillStyle=this._createGradient(E),E.fill(),t=r.createPattern(u.canvas,"no-repeat");const i=new DOMMatrix(R);t.setTransform(i)}else G(r,this._bbox),t=this._createGradient(r);return t}}function S(s,r,P,R,A,t,l,a){const n=r.coords,u=r.colors,E=s.data,i=s.width*4;let M;n[P+1]>n[R+1]&&(M=P,P=R,R=M,M=t,t=l,l=M),n[R+1]>n[A+1]&&(M=R,R=A,A=M,M=l,l=a,a=M),n[P+1]>n[R+1]&&(M=P,P=R,R=M,M=t,t=l,l=M);const V=(n[P]+r.offsetX)*r.scaleX,Y=(n[P+1]+r.offsetY)*r.scaleY,Q=(n[R]+r.offsetX)*r.scaleX,st=(n[R+1]+r.offsetY)*r.scaleY,ft=(n[A]+r.offsetX)*r.scaleX,nt=(n[A+1]+r.offsetY)*r.scaleY;if(Y>=nt)return;const dt=u[t],bt=u[t+1],yt=u[t+2],U=u[l],c=u[l+1],h=u[l+2],v=u[a],j=u[a+1],D=u[a+2],q=Math.round(Y),H=Math.round(nt);let K,X,L,k,e,o,b,x;for(let O=q;O<=H;O++){if(O<st){let at;O<Y?at=0:at=(Y-O)/(Y-st),K=V-(V-Q)*at,X=dt-(dt-U)*at,L=bt-(bt-c)*at,k=yt-(yt-h)*at}else{let at;O>nt?at=1:st===nt?at=0:at=(st-O)/(st-nt),K=Q-(Q-ft)*at,X=U-(U-v)*at,L=c-(c-j)*at,k=h-(h-D)*at}let N;O<Y?N=0:O>nt?N=1:N=(Y-O)/(Y-nt),e=V-(V-ft)*N,o=dt-(dt-v)*N,b=bt-(bt-j)*N,x=yt-(yt-D)*N;const it=Math.round(Math.min(K,e)),tt=Math.round(Math.max(K,e));let rt=i*O+it*4;for(let at=it;at<=tt;at++)N=(K-at)/(K-e),N<0?N=0:N>1&&(N=1),E[rt++]=X-(X-o)*N|0,E[rt++]=L-(L-b)*N|0,E[rt++]=k-(k-x)*N|0,E[rt++]=255}}function g(s,r,P){const R=r.coords,A=r.colors;let t,l;switch(r.type){case"lattice":const a=r.verticesPerRow,n=Math.floor(R.length/a)-1,u=a-1;for(t=0;t<n;t++){let E=t*a;for(let i=0;i<u;i++,E++)S(s,P,R[E],R[E+1],R[E+a],A[E],A[E+1],A[E+a]),S(s,P,R[E+a+1],R[E+1],R[E+a],A[E+a+1],A[E+1],A[E+a])}break;case"triangles":for(t=0,l=R.length;t<l;t+=3)S(s,P,R[t],R[t+1],R[t+2],A[t],A[t+1],A[t+2]);break;default:throw new Error("illegal figure")}}class w extends et{constructor(r){super(),this._coords=r[2],this._colors=r[3],this._figures=r[4],this._bounds=r[5],this._bbox=r[7],this._background=r[8],this.matrix=null}_createMeshCanvas(r,P,R){const a=Math.floor(this._bounds[0]),n=Math.floor(this._bounds[1]),u=Math.ceil(this._bounds[2])-a,E=Math.ceil(this._bounds[3])-n,i=Math.min(Math.ceil(Math.abs(u*r[0]*1.1)),3e3),M=Math.min(Math.ceil(Math.abs(E*r[1]*1.1)),3e3),V=u/i,Y=E/M,Q={coords:this._coords,colors:this._colors,offsetX:-a,offsetY:-n,scaleX:1/V,scaleY:1/Y},st=i+2*2,ft=M+2*2,nt=R.getCanvas("mesh",st,ft,!1),dt=nt.context,bt=dt.createImageData(i,M);if(P){const U=bt.data;for(let c=0,h=U.length;c<h;c+=4)U[c]=P[0],U[c+1]=P[1],U[c+2]=P[2],U[c+3]=255}for(const U of this._figures)g(bt,U,Q);return dt.putImageData(bt,2,2),{canvas:nt.canvas,offsetX:a-2*V,offsetY:n-2*Y,scaleX:V,scaleY:Y}}getPattern(r,P,R,A){G(r,this._bbox);let t;if(A===$.SHADING)t=p.Util.singularValueDecompose2dScale((0,T.getCurrentTransform)(r));else if(t=p.Util.singularValueDecompose2dScale(P.baseTransform),this.matrix){const a=p.Util.singularValueDecompose2dScale(this.matrix);t=[t[0]*a[0],t[1]*a[1]]}const l=this._createMeshCanvas(t,A===$.SHADING?null:this._background,P.cachedCanvases);return A!==$.SHADING&&(r.setTransform(...P.baseTransform),this.matrix&&r.transform(...this.matrix)),r.translate(l.offsetX,l.offsetY),r.scale(l.scaleX,l.scaleY),r.createPattern(l.canvas,"no-repeat")}}class C extends et{getPattern(){return"hotpink"}}function y(s){switch(s[0]){case"RadialAxial":return new I(s);case"Mesh":return new w(s);case"Dummy":return new C}throw new Error(`Unknown IR type: ${s[0]}`)}const d={COLORED:1,UNCOLORED:2};class _{static get MAX_PATTERN_SIZE(){return(0,p.shadow)(this,"MAX_PATTERN_SIZE",3e3)}constructor(r,P,R,A,t){this.operatorList=r[2],this.matrix=r[3]||[1,0,0,1,0,0],this.bbox=r[4],this.xstep=r[5],this.ystep=r[6],this.paintType=r[7],this.tilingType=r[8],this.color=P,this.ctx=R,this.canvasGraphicsFactory=A,this.baseTransform=t}createPatternCanvas(r){const P=this.operatorList,R=this.bbox,A=this.xstep,t=this.ystep,l=this.paintType,a=this.tilingType,n=this.color,u=this.canvasGraphicsFactory;(0,p.info)("TilingType: "+a);const E=R[0],i=R[1],M=R[2],V=R[3],Y=p.Util.singularValueDecompose2dScale(this.matrix),Q=p.Util.singularValueDecompose2dScale(this.baseTransform),st=[Y[0]*Q[0],Y[1]*Q[1]],ft=this.getSizeAndScale(A,this.ctx.canvas.width,st[0]),nt=this.getSizeAndScale(t,this.ctx.canvas.height,st[1]),dt=r.cachedCanvases.getCanvas("pattern",ft.size,nt.size,!0),bt=dt.context,yt=u.createCanvasGraphics(bt);yt.groupLevel=r.groupLevel,this.setFillAndStrokeStyleToContext(yt,l,n);let U=E,c=i,h=M,v=V;return E<0&&(U=0,h+=Math.abs(E)),i<0&&(c=0,v+=Math.abs(i)),bt.translate(-(ft.scale*U),-(nt.scale*c)),yt.transform(ft.scale,0,0,nt.scale,0,0),bt.save(),this.clipBbox(yt,U,c,h,v),yt.baseTransform=(0,T.getCurrentTransform)(yt.ctx),yt.executeOperatorList(P),yt.endDrawing(),{canvas:dt.canvas,scaleX:ft.scale,scaleY:nt.scale,offsetX:U,offsetY:c}}getSizeAndScale(r,P,R){r=Math.abs(r);const A=Math.max(_.MAX_PATTERN_SIZE,P);let t=Math.ceil(r*R);return t>=A?t=A:R=t/r,{scale:R,size:t}}clipBbox(r,P,R,A,t){const l=A-P,a=t-R;r.ctx.rect(P,R,l,a),r.current.updateRectMinMax((0,T.getCurrentTransform)(r.ctx),[P,R,A,t]),r.clip(),r.endPath()}setFillAndStrokeStyleToContext(r,P,R){const A=r.ctx,t=r.current;switch(P){case d.COLORED:const l=this.ctx;A.fillStyle=l.fillStyle,A.strokeStyle=l.strokeStyle,t.fillColor=l.fillStyle,t.strokeColor=l.strokeStyle;break;case d.UNCOLORED:const a=p.Util.makeHexColor(R[0],R[1],R[2]);A.fillStyle=a,A.strokeStyle=a,t.fillColor=a,t.strokeColor=a;break;default:throw new p.FormatError(`Unsupported paint type: ${P}`)}}getPattern(r,P,R,A){let t=R;A!==$.SHADING&&(t=p.Util.transform(t,P.baseTransform),this.matrix&&(t=p.Util.transform(t,this.matrix)));const l=this.createPatternCanvas(P);let a=new DOMMatrix(t);a=a.translate(l.offsetX,l.offsetY),a=a.scale(1/l.scaleX,1/l.scaleY);const n=r.createPattern(l.canvas,"repeat");return n.setTransform(a),n}}f.TilingPattern=_},(ot,f,z)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.convertBlackAndWhiteToRGBA=$,f.convertToRGBA=T,f.grayToRGBA=et;var p=z(1);function T(I){switch(I.kind){case p.ImageKind.GRAYSCALE_1BPP:return $(I);case p.ImageKind.RGB_24BPP:return G(I)}return null}function $({src:I,srcPos:S=0,dest:g,width:w,height:C,nonBlackColor:y=4294967295,inverseDecode:d=!1}){const _=p.FeatureTest.isLittleEndian?4278190080:255,[s,r]=d?[y,_]:[_,y],P=w>>3,R=w&7,A=I.length;g=new Uint32Array(g.buffer);let t=0;for(let l=0;l<C;l++){for(const n=S+P;S<n;S++){const u=S<A?I[S]:255;g[t++]=u&128?r:s,g[t++]=u&64?r:s,g[t++]=u&32?r:s,g[t++]=u&16?r:s,g[t++]=u&8?r:s,g[t++]=u&4?r:s,g[t++]=u&2?r:s,g[t++]=u&1?r:s}if(R===0)continue;const a=S<A?I[S++]:255;for(let n=0;n<R;n++)g[t++]=a&1<<7-n?r:s}return{srcPos:S,destPos:t}}function G({src:I,srcPos:S=0,dest:g,destPos:w=0,width:C,height:y}){let d=0;const _=I.length>>2,s=new Uint32Array(I.buffer,S,_);if(p.FeatureTest.isLittleEndian){for(;d<_-2;d+=3,w+=4){const r=s[d],P=s[d+1],R=s[d+2];g[w]=r|4278190080,g[w+1]=r>>>24|P<<8|4278190080,g[w+2]=P>>>16|R<<16|4278190080,g[w+3]=R>>>8|4278190080}for(let r=d*4,P=I.length;r<P;r+=3)g[w++]=I[r]|I[r+1]<<8|I[r+2]<<16|4278190080}else{for(;d<_-2;d+=3,w+=4){const r=s[d],P=s[d+1],R=s[d+2];g[w]=r|255,g[w+1]=r<<24|P>>>8|255,g[w+2]=P<<16|R>>>16|255,g[w+3]=R<<8|255}for(let r=d*4,P=I.length;r<P;r+=3)g[w++]=I[r]<<24|I[r+1]<<16|I[r+2]<<8|255}return{srcPos:S,destPos:w}}function et(I,S){if(p.FeatureTest.isLittleEndian)for(let g=0,w=I.length;g<w;g++)S[g]=I[g]*65793|4278190080;else for(let g=0,w=I.length;g<w;g++)S[g]=I[g]*16843008|255}},(ot,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.GlobalWorkerOptions=void 0;const z=Object.create(null);f.GlobalWorkerOptions=z,z.workerPort=null,z.workerSrc=""},(ot,f,z)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.MessageHandler=void 0;var p=z(1);const T={UNKNOWN:0,DATA:1,ERROR:2},$={UNKNOWN:0,CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function G(I){switch(I instanceof Error||typeof I=="object"&&I!==null||(0,p.unreachable)('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),I.name){case"AbortException":return new p.AbortException(I.message);case"MissingPDFException":return new p.MissingPDFException(I.message);case"PasswordException":return new p.PasswordException(I.message,I.code);case"UnexpectedResponseException":return new p.UnexpectedResponseException(I.message,I.status);case"UnknownErrorException":return new p.UnknownErrorException(I.message,I.details);default:return new p.UnknownErrorException(I.message,I.toString())}}class et{constructor(S,g,w){this.sourceName=S,this.targetName=g,this.comObj=w,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=C=>{const y=C.data;if(y.targetName!==this.sourceName)return;if(y.stream){this._processStreamMessage(y);return}if(y.callback){const _=y.callbackId,s=this.callbackCapabilities[_];if(!s)throw new Error(`Cannot resolve callback ${_}`);if(delete this.callbackCapabilities[_],y.callback===T.DATA)s.resolve(y.data);else if(y.callback===T.ERROR)s.reject(G(y.reason));else throw new Error("Unexpected callback case");return}const d=this.actionHandler[y.action];if(!d)throw new Error(`Unknown action from worker: ${y.action}`);if(y.callbackId){const _=this.sourceName,s=y.sourceName;new Promise(function(r){r(d(y.data))}).then(function(r){w.postMessage({sourceName:_,targetName:s,callback:T.DATA,callbackId:y.callbackId,data:r})},function(r){w.postMessage({sourceName:_,targetName:s,callback:T.ERROR,callbackId:y.callbackId,reason:G(r)})});return}if(y.streamId){this._createStreamSink(y);return}d(y.data)},w.addEventListener("message",this._onComObjOnMessage)}on(S,g){const w=this.actionHandler;if(w[S])throw new Error(`There is already an actionName called "${S}"`);w[S]=g}send(S,g,w){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:S,data:g},w)}sendWithPromise(S,g,w){const C=this.callbackId++,y=(0,p.createPromiseCapability)();this.callbackCapabilities[C]=y;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:S,callbackId:C,data:g},w)}catch(d){y.reject(d)}return y.promise}sendWithStream(S,g,w,C){const y=this.streamId++,d=this.sourceName,_=this.targetName,s=this.comObj;return new ReadableStream({start:r=>{const P=(0,p.createPromiseCapability)();return this.streamControllers[y]={controller:r,startCall:P,pullCall:null,cancelCall:null,isClosed:!1},s.postMessage({sourceName:d,targetName:_,action:S,streamId:y,data:g,desiredSize:r.desiredSize},C),P.promise},pull:r=>{const P=(0,p.createPromiseCapability)();return this.streamControllers[y].pullCall=P,s.postMessage({sourceName:d,targetName:_,stream:$.PULL,streamId:y,desiredSize:r.desiredSize}),P.promise},cancel:r=>{(0,p.assert)(r instanceof Error,"cancel must have a valid reason");const P=(0,p.createPromiseCapability)();return this.streamControllers[y].cancelCall=P,this.streamControllers[y].isClosed=!0,s.postMessage({sourceName:d,targetName:_,stream:$.CANCEL,streamId:y,reason:G(r)}),P.promise}},w)}_createStreamSink(S){const g=S.streamId,w=this.sourceName,C=S.sourceName,y=this.comObj,d=this,_=this.actionHandler[S.action],s={enqueue(r,P=1,R){if(this.isCancelled)return;const A=this.desiredSize;this.desiredSize-=P,A>0&&this.desiredSize<=0&&(this.sinkCapability=(0,p.createPromiseCapability)(),this.ready=this.sinkCapability.promise),y.postMessage({sourceName:w,targetName:C,stream:$.ENQUEUE,streamId:g,chunk:r},R)},close(){this.isCancelled||(this.isCancelled=!0,y.postMessage({sourceName:w,targetName:C,stream:$.CLOSE,streamId:g}),delete d.streamSinks[g])},error(r){(0,p.assert)(r instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,y.postMessage({sourceName:w,targetName:C,stream:$.ERROR,streamId:g,reason:G(r)}))},sinkCapability:(0,p.createPromiseCapability)(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:S.desiredSize,ready:null};s.sinkCapability.resolve(),s.ready=s.sinkCapability.promise,this.streamSinks[g]=s,new Promise(function(r){r(_(S.data,s))}).then(function(){y.postMessage({sourceName:w,targetName:C,stream:$.START_COMPLETE,streamId:g,success:!0})},function(r){y.postMessage({sourceName:w,targetName:C,stream:$.START_COMPLETE,streamId:g,reason:G(r)})})}_processStreamMessage(S){const g=S.streamId,w=this.sourceName,C=S.sourceName,y=this.comObj,d=this.streamControllers[g],_=this.streamSinks[g];switch(S.stream){case $.START_COMPLETE:S.success?d.startCall.resolve():d.startCall.reject(G(S.reason));break;case $.PULL_COMPLETE:S.success?d.pullCall.resolve():d.pullCall.reject(G(S.reason));break;case $.PULL:if(!_){y.postMessage({sourceName:w,targetName:C,stream:$.PULL_COMPLETE,streamId:g,success:!0});break}_.desiredSize<=0&&S.desiredSize>0&&_.sinkCapability.resolve(),_.desiredSize=S.desiredSize,new Promise(function(s){s(_.onPull&&_.onPull())}).then(function(){y.postMessage({sourceName:w,targetName:C,stream:$.PULL_COMPLETE,streamId:g,success:!0})},function(s){y.postMessage({sourceName:w,targetName:C,stream:$.PULL_COMPLETE,streamId:g,reason:G(s)})});break;case $.ENQUEUE:if((0,p.assert)(d,"enqueue should have stream controller"),d.isClosed)break;d.controller.enqueue(S.chunk);break;case $.CLOSE:if((0,p.assert)(d,"close should have stream controller"),d.isClosed)break;d.isClosed=!0,d.controller.close(),this._deleteStreamController(d,g);break;case $.ERROR:(0,p.assert)(d,"error should have stream controller"),d.controller.error(G(S.reason)),this._deleteStreamController(d,g);break;case $.CANCEL_COMPLETE:S.success?d.cancelCall.resolve():d.cancelCall.reject(G(S.reason)),this._deleteStreamController(d,g);break;case $.CANCEL:if(!_)break;new Promise(function(s){s(_.onCancel&&_.onCancel(G(S.reason)))}).then(function(){y.postMessage({sourceName:w,targetName:C,stream:$.CANCEL_COMPLETE,streamId:g,success:!0})},function(s){y.postMessage({sourceName:w,targetName:C,stream:$.CANCEL_COMPLETE,streamId:g,reason:G(s)})}),_.sinkCapability.reject(G(S.reason)),_.isCancelled=!0,delete this.streamSinks[g];break;default:throw new Error("Unexpected stream case")}}async _deleteStreamController(S,g){await Promise.allSettled([S.startCall&&S.startCall.promise,S.pullCall&&S.pullCall.promise,S.cancelCall&&S.cancelCall.promise]),delete this.streamControllers[g]}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}f.MessageHandler=et},(ot,f,z)=>{var $,G;Object.defineProperty(f,"__esModule",{value:!0}),f.Metadata=void 0;var p=z(1);class T{constructor({parsedData:I,rawData:S}){Z(this,$,void 0);Z(this,G,void 0);pt(this,$,I),pt(this,G,S)}getRaw(){return m(this,G)}get(I){return m(this,$).get(I)??null}getAll(){return(0,p.objectFromMap)(m(this,$))}has(I){return m(this,$).has(I)}}$=new WeakMap,G=new WeakMap,f.Metadata=T},(ot,f,z)=>{var I,S,g,w,C,y,_e;Object.defineProperty(f,"__esModule",{value:!0}),f.OptionalContentConfig=void 0;var p=z(1),T=z(8);const $=Symbol("INTERNAL");class G{constructor(s,r){Z(this,I,!0);this.name=s,this.intent=r}get visible(){return m(this,I)}_setVisible(s,r){s!==$&&(0,p.unreachable)("Internal method `_setVisible` called."),pt(this,I,r)}}I=new WeakMap;class et{constructor(s){Z(this,y);Z(this,S,null);Z(this,g,new Map);Z(this,w,null);Z(this,C,null);if(this.name=null,this.creator=null,s!==null){this.name=s.name,this.creator=s.creator,pt(this,C,s.order);for(const r of s.groups)m(this,g).set(r.id,new G(r.name,r.intent));if(s.baseState==="OFF")for(const r of m(this,g).values())r._setVisible($,!1);for(const r of s.on)m(this,g).get(r)._setVisible($,!0);for(const r of s.off)m(this,g).get(r)._setVisible($,!1);pt(this,w,this.getHash())}}isVisible(s){if(m(this,g).size===0)return!0;if(!s)return(0,p.warn)("Optional content group not defined."),!0;if(s.type==="OCG")return m(this,g).has(s.id)?m(this,g).get(s.id).visible:((0,p.warn)(`Optional content group not found: ${s.id}`),!0);if(s.type==="OCMD"){if(s.expression)return lt(this,y,_e).call(this,s.expression);if(!s.policy||s.policy==="AnyOn"){for(const r of s.ids){if(!m(this,g).has(r))return(0,p.warn)(`Optional content group not found: ${r}`),!0;if(m(this,g).get(r).visible)return!0}return!1}else if(s.policy==="AllOn"){for(const r of s.ids){if(!m(this,g).has(r))return(0,p.warn)(`Optional content group not found: ${r}`),!0;if(!m(this,g).get(r).visible)return!1}return!0}else if(s.policy==="AnyOff"){for(const r of s.ids){if(!m(this,g).has(r))return(0,p.warn)(`Optional content group not found: ${r}`),!0;if(!m(this,g).get(r).visible)return!0}return!1}else if(s.policy==="AllOff"){for(const r of s.ids){if(!m(this,g).has(r))return(0,p.warn)(`Optional content group not found: ${r}`),!0;if(m(this,g).get(r).visible)return!1}return!0}return(0,p.warn)(`Unknown optional content policy ${s.policy}.`),!0}return(0,p.warn)(`Unknown group type ${s.type}.`),!0}setVisibility(s,r=!0){if(!m(this,g).has(s)){(0,p.warn)(`Optional content group not found: ${s}`);return}m(this,g).get(s)._setVisible($,!!r),pt(this,S,null)}get hasInitialVisibility(){return this.getHash()===m(this,w)}getOrder(){return m(this,g).size?m(this,C)?m(this,C).slice():[...m(this,g).keys()]:null}getGroups(){return m(this,g).size>0?(0,p.objectFromMap)(m(this,g)):null}getGroup(s){return m(this,g).get(s)||null}getHash(){if(m(this,S)!==null)return m(this,S);const s=new T.MurmurHash3_64;for(const[r,P]of m(this,g))s.update(`${r}:${P.visible}`);return pt(this,S,s.hexdigest())}}S=new WeakMap,g=new WeakMap,w=new WeakMap,C=new WeakMap,y=new WeakSet,_e=function(s){const r=s.length;if(r<2)return!0;const P=s[0];for(let R=1;R<r;R++){const A=s[R];let t;if(Array.isArray(A))t=lt(this,y,_e).call(this,A);else if(m(this,g).has(A))t=m(this,g).get(A).visible;else return(0,p.warn)(`Optional content group not found: ${A}`),!0;switch(P){case"And":if(!t)return!1;break;case"Or":if(t)return!0;break;case"Not":return!t;default:return!0}}return P==="And"},f.OptionalContentConfig=et},(ot,f,z)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.PDFDataTransportStream=void 0;var p=z(1),T=z(6);class ${constructor({length:S,initialData:g,progressiveDone:w=!1,contentDispositionFilename:C=null,disableRange:y=!1,disableStream:d=!1},_){if((0,p.assert)(_,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.'),this._queuedChunks=[],this._progressiveDone=w,this._contentDispositionFilename=C,(g==null?void 0:g.length)>0){const s=g instanceof Uint8Array&&g.byteLength===g.buffer.byteLength?g.buffer:new Uint8Array(g).buffer;this._queuedChunks.push(s)}this._pdfDataRangeTransport=_,this._isStreamingSupported=!d,this._isRangeSupported=!y,this._contentLength=S,this._fullRequestReader=null,this._rangeReaders=[],this._pdfDataRangeTransport.addRangeListener((s,r)=>{this._onReceiveData({begin:s,chunk:r})}),this._pdfDataRangeTransport.addProgressListener((s,r)=>{this._onProgress({loaded:s,total:r})}),this._pdfDataRangeTransport.addProgressiveReadListener(s=>{this._onReceiveData({chunk:s})}),this._pdfDataRangeTransport.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),this._pdfDataRangeTransport.transportReady()}_onReceiveData({begin:S,chunk:g}){const w=g instanceof Uint8Array&&g.byteLength===g.buffer.byteLength?g.buffer:new Uint8Array(g).buffer;if(S===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(w):this._queuedChunks.push(w);else{const C=this._rangeReaders.some(function(y){return y._begin!==S?!1:(y._enqueue(w),!0)});(0,p.assert)(C,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var S;return((S=this._fullRequestReader)==null?void 0:S._loaded)??0}_onProgress(S){var g,w,C,y;S.total===void 0?(w=(g=this._rangeReaders[0])==null?void 0:g.onProgress)==null||w.call(g,{loaded:S.loaded}):(y=(C=this._fullRequestReader)==null?void 0:C.onProgress)==null||y.call(C,{loaded:S.loaded,total:S.total})}_onProgressiveDone(){var S;(S=this._fullRequestReader)==null||S.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(S){const g=this._rangeReaders.indexOf(S);g>=0&&this._rangeReaders.splice(g,1)}getFullReader(){(0,p.assert)(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const S=this._queuedChunks;return this._queuedChunks=null,new G(this,S,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(S,g){if(g<=this._progressiveDataLength)return null;const w=new et(this,S,g);return this._pdfDataRangeTransport.requestDataRange(S,g),this._rangeReaders.push(w),w}cancelAllRequests(S){var g;(g=this._fullRequestReader)==null||g.cancel(S);for(const w of this._rangeReaders.slice(0))w.cancel(S);this._pdfDataRangeTransport.abort()}}f.PDFDataTransportStream=$;class G{constructor(S,g,w=!1,C=null){this._stream=S,this._done=w||!1,this._filename=(0,T.isPdfFile)(C)?C:null,this._queuedChunks=g||[],this._loaded=0;for(const y of this._queuedChunks)this._loaded+=y.byteLength;this._requests=[],this._headersReady=Promise.resolve(),S._fullRequestReader=this,this.onProgress=null}_enqueue(S){this._done||(this._requests.length>0?this._requests.shift().resolve({value:S,done:!1}):this._queuedChunks.push(S),this._loaded+=S.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const S=(0,p.createPromiseCapability)();return this._requests.push(S),S.promise}cancel(S){this._done=!0;for(const g of this._requests)g.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class et{constructor(S,g,w){this._stream=S,this._begin=g,this._end=w,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(S){if(!this._done){if(this._requests.length===0)this._queuedChunk=S;else{this._requests.shift().resolve({value:S,done:!1});for(const w of this._requests)w.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const g=this._queuedChunk;return this._queuedChunk=null,{value:g,done:!1}}if(this._done)return{value:void 0,done:!0};const S=(0,p.createPromiseCapability)();return this._requests.push(S),S.promise}cancel(S){this._done=!0;for(const g of this._requests)g.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}},(ot,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.XfaText=void 0;class z{static textContent(T){const $=[],G={items:$,styles:Object.create(null)};function et(I){var w;if(!I)return;let S=null;const g=I.name;if(g==="#text")S=I.value;else if(z.shouldBuildText(g))(w=I==null?void 0:I.attributes)!=null&&w.textContent?S=I.attributes.textContent:I.value&&(S=I.value);else return;if(S!==null&&$.push({str:S}),!!I.children)for(const C of I.children)et(C)}return et(T),G}static shouldBuildText(T){return!(T==="textarea"||T==="input"||T==="option"||T==="select")}}f.XfaText=z},(ot,f,z)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.NodeStandardFontDataFactory=f.NodeFilterFactory=f.NodeCanvasFactory=f.NodeCMapReaderFactory=void 0;var p=z(7);const T=function(S){return new Promise((g,w)=>{require$$5.readFile(S,(y,d)=>{if(y||!d){w(new Error(y));return}g(new Uint8Array(d))})})};class $ extends p.BaseFilterFactory{}f.NodeFilterFactory=$;class G extends p.BaseCanvasFactory{_createCanvas(g,w){return require$$5.createCanvas(g,w)}}f.NodeCanvasFactory=G;class et extends p.BaseCMapReaderFactory{_fetchData(g,w){return T(g).then(C=>({cMapData:C,compressionType:w}))}}f.NodeCMapReaderFactory=et;class I extends p.BaseStandardFontDataFactory{_fetchData(g){return T(g)}}f.NodeStandardFontDataFactory=I},(ot,f,z)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.PDFNodeStream=void 0;var p=z(1),T=z(22);const $=require$$5,G=require$$5,et=require$$5,I=require$$5,S=/^file:\/\/\/[a-zA-Z]:\//;function g(R){const A=I.parse(R);return A.protocol==="file:"||A.host?A:/^[a-z]:[/\\]/i.test(R)?I.parse(`file:///${R}`):(A.host||(A.protocol="file:"),A)}class w{constructor(A){this.source=A,this.url=g(A.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&A.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var A;return((A=this._fullRequestReader)==null?void 0:A._loaded)??0}getFullReader(){return(0,p.assert)(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new r(this):new _(this),this._fullRequestReader}getRangeReader(A,t){if(t<=this._progressiveDataLength)return null;const l=this.isFsUrl?new P(this,A,t):new s(this,A,t);return this._rangeRequestReaders.push(l),l}cancelAllRequests(A){var t;(t=this._fullRequestReader)==null||t.cancel(A);for(const l of this._rangeRequestReaders.slice(0))l.cancel(A)}}f.PDFNodeStream=w;class C{constructor(A){this._url=A.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=A.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=(0,p.createPromiseCapability)(),this._headersCapability=(0,p.createPromiseCapability)()}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var l;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const A=this._readableStream.read();return A===null?(this._readCapability=(0,p.createPromiseCapability)(),this.read()):(this._loaded+=A.length,(l=this.onProgress)==null||l.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(A).buffer,done:!1})}cancel(A){if(!this._readableStream){this._error(A);return}this._readableStream.destroy(A)}_error(A){this._storedError=A,this._readCapability.resolve()}_setReadableStream(A){this._readableStream=A,A.on("readable",()=>{this._readCapability.resolve()}),A.on("end",()=>{A.destroy(),this._done=!0,this._readCapability.resolve()}),A.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new p.AbortException("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class y{constructor(A){this._url=A.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=(0,p.createPromiseCapability)();const t=A.source;this._isStreamingSupported=!t.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){var l;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const A=this._readableStream.read();return A===null?(this._readCapability=(0,p.createPromiseCapability)(),this.read()):(this._loaded+=A.length,(l=this.onProgress)==null||l.call(this,{loaded:this._loaded}),{value:new Uint8Array(A).buffer,done:!1})}cancel(A){if(!this._readableStream){this._error(A);return}this._readableStream.destroy(A)}_error(A){this._storedError=A,this._readCapability.resolve()}_setReadableStream(A){this._readableStream=A,A.on("readable",()=>{this._readCapability.resolve()}),A.on("end",()=>{A.destroy(),this._done=!0,this._readCapability.resolve()}),A.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function d(R,A){return{protocol:R.protocol,auth:R.auth,host:R.hostname,port:R.port,path:R.path,method:"GET",headers:A}}class _ extends C{constructor(A){super(A);const t=l=>{if(l.statusCode===404){const E=new p.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=E,this._headersCapability.reject(E);return}this._headersCapability.resolve(),this._setReadableStream(l);const a=E=>this._readableStream.headers[E.toLowerCase()],{allowRangeRequests:n,suggestedLength:u}=(0,T.validateRangeRequestCapabilities)({getResponseHeader:a,isHttp:A.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=n,this._contentLength=u||this._contentLength,this._filename=(0,T.extractFilenameFromHeader)(a)};this._request=null,this._url.protocol==="http:"?this._request=G.request(d(this._url,A.httpHeaders),t):this._request=et.request(d(this._url,A.httpHeaders),t),this._request.on("error",l=>{this._storedError=l,this._headersCapability.reject(l)}),this._request.end()}}class s extends y{constructor(A,t,l){super(A),this._httpHeaders={};for(const n in A.httpHeaders){const u=A.httpHeaders[n];u!==void 0&&(this._httpHeaders[n]=u)}this._httpHeaders.Range=`bytes=${t}-${l-1}`;const a=n=>{if(n.statusCode===404){const u=new p.MissingPDFException(`Missing PDF "${this._url}".`);this._storedError=u;return}this._setReadableStream(n)};this._request=null,this._url.protocol==="http:"?this._request=G.request(d(this._url,this._httpHeaders),a):this._request=et.request(d(this._url,this._httpHeaders),a),this._request.on("error",n=>{this._storedError=n}),this._request.end()}}class r extends C{constructor(A){super(A);let t=decodeURIComponent(this._url.path);S.test(this._url.href)&&(t=t.replace(/^\//,"")),$.lstat(t,(l,a)=>{if(l){l.code==="ENOENT"&&(l=new p.MissingPDFException(`Missing PDF "${t}".`)),this._storedError=l,this._headersCapability.reject(l);return}this._contentLength=a.size,this._setReadableStream($.createReadStream(t)),this._headersCapability.resolve()})}}class P extends y{constructor(A,t,l){super(A);let a=decodeURIComponent(this._url.path);S.test(this._url.href)&&(a=a.replace(/^\//,"")),this._setReadableStream($.createReadStream(a,{start:t,end:l-1}))}}},(ot,f,z)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.createResponseStatusError=I,f.extractFilenameFromHeader=et,f.validateRangeRequestCapabilities=G,f.validateResponseStatus=S;var p=z(1),T=z(23),$=z(6);function G({getResponseHeader:g,isHttp:w,rangeChunkSize:C,disableRange:y}){const d={allowRangeRequests:!1,suggestedLength:void 0},_=parseInt(g("Content-Length"),10);return!Number.isInteger(_)||(d.suggestedLength=_,_<=2*C)||y||!w||g("Accept-Ranges")!=="bytes"||(g("Content-Encoding")||"identity")!=="identity"||(d.allowRangeRequests=!0),d}function et(g){const w=g("Content-Disposition");if(w){let C=(0,T.getFilenameFromContentDispositionHeader)(w);if(C.includes("%"))try{C=decodeURIComponent(C)}catch{}if((0,$.isPdfFile)(C))return C}return null}function I(g,w){return g===404||g===0&&w.startsWith("file:")?new p.MissingPDFException('Missing PDF "'+w+'".'):new p.UnexpectedResponseException(`Unexpected server response (${g}) while retrieving PDF "${w}".`,g)}function S(g){return g===200||g===206}},(ot,f,z)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.getFilenameFromContentDispositionHeader=T;var p=z(1);function T($){let G=!0,et=I("filename\\*","i").exec($);if(et){et=et[1];let _=C(et);return _=unescape(_),_=y(_),_=d(_),g(_)}if(et=w($),et){const _=d(et);return g(_)}if(et=I("filename","i").exec($),et){et=et[1];let _=C(et);return _=d(_),g(_)}function I(_,s){return new RegExp("(?:^|;)\\s*"+_+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',s)}function S(_,s){if(_){if(!/^[\x00-\xFF]+$/.test(s))return s;try{const r=new TextDecoder(_,{fatal:!0}),P=(0,p.stringToBytes)(s);s=r.decode(P),G=!1}catch{}}return s}function g(_){return G&&/[\x80-\xff]/.test(_)&&(_=S("utf-8",_),G&&(_=S("iso-8859-1",_))),_}function w(_){const s=[];let r;const P=I("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(r=P.exec(_))!==null;){let[,A,t,l]=r;if(A=parseInt(A,10),A in s){if(A===0)break;continue}s[A]=[t,l]}const R=[];for(let A=0;A<s.length&&A in s;++A){let[t,l]=s[A];l=C(l),t&&(l=unescape(l),A===0&&(l=y(l))),R.push(l)}return R.join("")}function C(_){if(_.startsWith('"')){const s=_.slice(1).split('\\"');for(let r=0;r<s.length;++r){const P=s[r].indexOf('"');P!==-1&&(s[r]=s[r].slice(0,P),s.length=r+1),s[r]=s[r].replaceAll(/\\(.)/g,"$1")}_=s.join('"')}return _}function y(_){const s=_.indexOf("'");if(s===-1)return _;const r=_.slice(0,s),R=_.slice(s+1).replace(/^[^']*'/,"");return S(r,R)}function d(_){return!_.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(_)?_:_.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(s,r,P,R){if(P==="q"||P==="Q")return R=R.replaceAll("_"," "),R=R.replaceAll(/=([0-9a-fA-F]{2})/g,function(A,t){return String.fromCharCode(parseInt(t,16))}),S(r,R);try{R=atob(R)}catch{}return S(r,R)})}return""}},(ot,f,z)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.PDFNetworkStream=void 0;var p=z(1),T=z(22);const $=200,G=206;function et(C){const y=C.response;return typeof y!="string"?y:(0,p.stringToBytes)(y).buffer}class I{constructor(y,d={}){this.url=y,this.isHttp=/^https?:/i.test(y),this.httpHeaders=this.isHttp&&d.httpHeaders||Object.create(null),this.withCredentials=d.withCredentials||!1,this.getXhr=d.getXhr||function(){return new XMLHttpRequest},this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(y,d,_){const s={begin:y,end:d};for(const r in _)s[r]=_[r];return this.request(s)}requestFull(y){return this.request(y)}request(y){const d=this.getXhr(),_=this.currXhrId++,s=this.pendingRequests[_]={xhr:d};d.open("GET",this.url),d.withCredentials=this.withCredentials;for(const r in this.httpHeaders){const P=this.httpHeaders[r];P!==void 0&&d.setRequestHeader(r,P)}return this.isHttp&&"begin"in y&&"end"in y?(d.setRequestHeader("Range",`bytes=${y.begin}-${y.end-1}`),s.expectedStatus=G):s.expectedStatus=$,d.responseType="arraybuffer",y.onError&&(d.onerror=function(r){y.onError(d.status)}),d.onreadystatechange=this.onStateChange.bind(this,_),d.onprogress=this.onProgress.bind(this,_),s.onHeadersReceived=y.onHeadersReceived,s.onDone=y.onDone,s.onError=y.onError,s.onProgress=y.onProgress,d.send(null),_}onProgress(y,d){var s;const _=this.pendingRequests[y];_&&((s=_.onProgress)==null||s.call(_,d))}onStateChange(y,d){var A,t,l;const _=this.pendingRequests[y];if(!_)return;const s=_.xhr;if(s.readyState>=2&&_.onHeadersReceived&&(_.onHeadersReceived(),delete _.onHeadersReceived),s.readyState!==4||!(y in this.pendingRequests))return;if(delete this.pendingRequests[y],s.status===0&&this.isHttp){(A=_.onError)==null||A.call(_,s.status);return}const r=s.status||$;if(!(r===$&&_.expectedStatus===G)&&r!==_.expectedStatus){(t=_.onError)==null||t.call(_,s.status);return}const R=et(s);if(r===G){const a=s.getResponseHeader("Content-Range"),n=/bytes (\d+)-(\d+)\/(\d+)/.exec(a);_.onDone({begin:parseInt(n[1],10),chunk:R})}else R?_.onDone({begin:0,chunk:R}):(l=_.onError)==null||l.call(_,s.status)}getRequestXhr(y){return this.pendingRequests[y].xhr}isPendingRequest(y){return y in this.pendingRequests}abortRequest(y){const d=this.pendingRequests[y].xhr;delete this.pendingRequests[y],d.abort()}}class S{constructor(y){this._source=y,this._manager=new I(y.url,{httpHeaders:y.httpHeaders,withCredentials:y.withCredentials}),this._rangeChunkSize=y.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(y){const d=this._rangeRequestReaders.indexOf(y);d>=0&&this._rangeRequestReaders.splice(d,1)}getFullReader(){return(0,p.assert)(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new g(this._manager,this._source),this._fullRequestReader}getRangeReader(y,d){const _=new w(this._manager,y,d);return _.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(_),_}cancelAllRequests(y){var d;(d=this._fullRequestReader)==null||d.cancel(y);for(const _ of this._rangeRequestReaders.slice(0))_.cancel(y)}}f.PDFNetworkStream=S;class g{constructor(y,d){this._manager=y;const _={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=d.url,this._fullRequestId=y.requestFull(_),this._headersReceivedCapability=(0,p.createPromiseCapability)(),this._disableRange=d.disableRange||!1,this._contentLength=d.length,this._rangeChunkSize=d.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const y=this._fullRequestId,d=this._manager.getRequestXhr(y),_=P=>d.getResponseHeader(P),{allowRangeRequests:s,suggestedLength:r}=(0,T.validateRangeRequestCapabilities)({getResponseHeader:_,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});s&&(this._isRangeSupported=!0),this._contentLength=r||this._contentLength,this._filename=(0,T.extractFilenameFromHeader)(_),this._isRangeSupported&&this._manager.abortRequest(y),this._headersReceivedCapability.resolve()}_onDone(y){if(y&&(this._requests.length>0?this._requests.shift().resolve({value:y.chunk,done:!1}):this._cachedChunks.push(y.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const d of this._requests)d.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(y){this._storedError=(0,T.createResponseStatusError)(y,this._url),this._headersReceivedCapability.reject(this._storedError);for(const d of this._requests)d.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(y){var d;(d=this.onProgress)==null||d.call(this,{loaded:y.loaded,total:y.lengthComputable?y.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const y=(0,p.createPromiseCapability)();return this._requests.push(y),y.promise}cancel(y){this._done=!0,this._headersReceivedCapability.reject(y);for(const d of this._requests)d.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class w{constructor(y,d,_){this._manager=y;const s={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=y.url,this._requestId=y.requestRange(d,_,s),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){var y;(y=this.onClosed)==null||y.call(this,this)}_onDone(y){const d=y.chunk;this._requests.length>0?this._requests.shift().resolve({value:d,done:!1}):this._queuedChunk=d,this._done=!0;for(const _ of this._requests)_.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(y){this._storedError=(0,T.createResponseStatusError)(y,this._url);for(const d of this._requests)d.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(y){var d;this.isStreamingSupported||(d=this.onProgress)==null||d.call(this,{loaded:y.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const d=this._queuedChunk;return this._queuedChunk=null,{value:d,done:!1}}if(this._done)return{value:void 0,done:!0};const y=(0,p.createPromiseCapability)();return this._requests.push(y),y.promise}cancel(y){this._done=!0;for(const d of this._requests)d.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}},(ot,f,z)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.PDFFetchStream=void 0;var p=z(1),T=z(22);function $(w,C,y){return{method:"GET",headers:w,signal:y.signal,mode:"cors",credentials:C?"include":"same-origin",redirect:"follow"}}function G(w){const C=new Headers;for(const y in w){const d=w[y];d!==void 0&&C.append(y,d)}return C}function et(w){return w instanceof Uint8Array?w.buffer:w instanceof ArrayBuffer?w:((0,p.warn)(`getArrayBuffer - unexpected data format: ${w}`),new Uint8Array(w).buffer)}class I{constructor(C){this.source=C,this.isHttp=/^https?:/i.test(C.url),this.httpHeaders=this.isHttp&&C.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var C;return((C=this._fullRequestReader)==null?void 0:C._loaded)??0}getFullReader(){return(0,p.assert)(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new S(this),this._fullRequestReader}getRangeReader(C,y){if(y<=this._progressiveDataLength)return null;const d=new g(this,C,y);return this._rangeRequestReaders.push(d),d}cancelAllRequests(C){var y;(y=this._fullRequestReader)==null||y.cancel(C);for(const d of this._rangeRequestReaders.slice(0))d.cancel(C)}}f.PDFFetchStream=I;class S{constructor(C){this._stream=C,this._reader=null,this._loaded=0,this._filename=null;const y=C.source;this._withCredentials=y.withCredentials||!1,this._contentLength=y.length,this._headersCapability=(0,p.createPromiseCapability)(),this._disableRange=y.disableRange||!1,this._rangeChunkSize=y.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!y.disableStream,this._isRangeSupported=!y.disableRange,this._headers=G(this._stream.httpHeaders);const d=y.url;fetch(d,$(this._headers,this._withCredentials,this._abortController)).then(_=>{if(!(0,T.validateResponseStatus)(_.status))throw(0,T.createResponseStatusError)(_.status,d);this._reader=_.body.getReader(),this._headersCapability.resolve();const s=R=>_.headers.get(R),{allowRangeRequests:r,suggestedLength:P}=(0,T.validateRangeRequestCapabilities)({getResponseHeader:s,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=r,this._contentLength=P||this._contentLength,this._filename=(0,T.extractFilenameFromHeader)(s),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new p.AbortException("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var d;await this._headersCapability.promise;const{value:C,done:y}=await this._reader.read();return y?{value:C,done:y}:(this._loaded+=C.byteLength,(d=this.onProgress)==null||d.call(this,{loaded:this._loaded,total:this._contentLength}),{value:et(C),done:!1})}cancel(C){var y;(y=this._reader)==null||y.cancel(C),this._abortController.abort()}}class g{constructor(C,y,d){this._stream=C,this._reader=null,this._loaded=0;const _=C.source;this._withCredentials=_.withCredentials||!1,this._readCapability=(0,p.createPromiseCapability)(),this._isStreamingSupported=!_.disableStream,this._abortController=new AbortController,this._headers=G(this._stream.httpHeaders),this._headers.append("Range",`bytes=${y}-${d-1}`);const s=_.url;fetch(s,$(this._headers,this._withCredentials,this._abortController)).then(r=>{if(!(0,T.validateResponseStatus)(r.status))throw(0,T.createResponseStatusError)(r.status,s);this._readCapability.resolve(),this._reader=r.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var d;await this._readCapability.promise;const{value:C,done:y}=await this._reader.read();return y?{value:C,done:y}:(this._loaded+=C.byteLength,(d=this.onProgress)==null||d.call(this,{loaded:this._loaded}),{value:et(C),done:!1})}cancel(C){var y;(y=this._reader)==null||y.cancel(C),this._abortController.abort()}}},(ot,f,z)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.TextLayerRenderTask=void 0,f.renderTextLayer=_,f.updateTextLayer=s;var p=z(1),T=z(6);const $=1e5,G=30,et=.8,I=new Map;function S(r,P){let R;if(P&&p.FeatureTest.isOffscreenCanvasSupported)R=new OffscreenCanvas(r,r).getContext("2d",{alpha:!1});else{const A=document.createElement("canvas");A.width=A.height=r,R=A.getContext("2d",{alpha:!1})}return R}function g(r,P){const R=I.get(r);if(R)return R;const A=S(G,P);A.font=`${G}px ${r}`;const t=A.measureText("");let l=t.fontBoundingBoxAscent,a=Math.abs(t.fontBoundingBoxDescent);if(l){const u=l/(l+a);return I.set(r,u),A.canvas.width=A.canvas.height=0,u}A.strokeStyle="red",A.clearRect(0,0,G,G),A.strokeText("g",0,0);let n=A.getImageData(0,0,G,G).data;a=0;for(let u=n.length-1-3;u>=0;u-=4)if(n[u]>0){a=Math.ceil(u/4/G);break}A.clearRect(0,0,G,G),A.strokeText("A",0,G),n=A.getImageData(0,0,G,G).data,l=0;for(let u=0,E=n.length;u<E;u+=4)if(n[u]>0){l=G-Math.floor(u/4/G);break}if(A.canvas.width=A.canvas.height=0,l){const u=l/(l+a);return I.set(r,u),u}return I.set(r,et),et}function w(r,P,R){const A=document.createElement("span"),t={angle:0,canvasWidth:0,hasText:P.str!=="",hasEOL:P.hasEOL,fontSize:0};r._textDivs.push(A);const l=p.Util.transform(r._transform,P.transform);let a=Math.atan2(l[1],l[0]);const n=R[P.fontName];n.vertical&&(a+=Math.PI/2);const u=Math.hypot(l[2],l[3]),E=u*g(n.fontFamily,r._isOffscreenCanvasSupported);let i,M;a===0?(i=l[4],M=l[5]-E):(i=l[4]+E*Math.sin(a),M=l[5]-E*Math.cos(a));const V="calc(var(--scale-factor)*",Y=A.style;r._container===r._rootContainer?(Y.left=`${(100*i/r._pageWidth).toFixed(2)}%`,Y.top=`${(100*M/r._pageHeight).toFixed(2)}%`):(Y.left=`${V}${i.toFixed(2)}px)`,Y.top=`${V}${M.toFixed(2)}px)`),Y.fontSize=`${V}${u.toFixed(2)}px)`,Y.fontFamily=n.fontFamily,t.fontSize=u,A.setAttribute("role","presentation"),A.textContent=P.str,A.dir=P.dir,r._fontInspectorEnabled&&(A.dataset.fontName=P.fontName),a!==0&&(t.angle=a*(180/Math.PI));let Q=!1;if(P.str.length>1)Q=!0;else if(P.str!==" "&&P.transform[0]!==P.transform[3]){const st=Math.abs(P.transform[0]),ft=Math.abs(P.transform[3]);st!==ft&&Math.max(st,ft)/Math.min(st,ft)>1.5&&(Q=!0)}Q&&(t.canvasWidth=n.vertical?P.height:P.width),r._textDivProperties.set(A,t),r._isReadableStream&&r._layoutText(A)}function C(r){const{div:P,scale:R,properties:A,ctx:t,prevFontSize:l,prevFontFamily:a}=r,{style:n}=P;let u="";if(A.canvasWidth!==0&&A.hasText){const{fontFamily:E}=n,{canvasWidth:i,fontSize:M}=A;(l!==M||a!==E)&&(t.font=`${M*R}px ${E}`,r.prevFontSize=M,r.prevFontFamily=E);const{width:V}=t.measureText(P.textContent);V>0&&(u=`scaleX(${i*R/V})`)}A.angle!==0&&(u=`rotate(${A.angle}deg) ${u}`),u.length>0&&(n.transform=u)}function y(r){if(r._canceled)return;const P=r._textDivs,R=r._capability;if(P.length>$){R.resolve();return}if(!r._isReadableStream)for(const t of P)r._layoutText(t);R.resolve()}class d{constructor({textContentSource:P,container:R,viewport:A,textDivs:t,textDivProperties:l,textContentItemsStr:a,isOffscreenCanvasSupported:n}){var V;this._textContentSource=P,this._isReadableStream=P instanceof ReadableStream,this._container=this._rootContainer=R,this._textDivs=t||[],this._textContentItemsStr=a||[],this._isOffscreenCanvasSupported=n,this._fontInspectorEnabled=!!((V=globalThis.FontInspector)!=null&&V.enabled),this._reader=null,this._textDivProperties=l||new WeakMap,this._canceled=!1,this._capability=(0,p.createPromiseCapability)(),this._layoutTextParams={prevFontSize:null,prevFontFamily:null,div:null,scale:A.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:S(0,n)};const{pageWidth:u,pageHeight:E,pageX:i,pageY:M}=A.rawDims;this._transform=[1,0,0,-1,-i,M+E],this._pageWidth=u,this._pageHeight=E,(0,T.setLayerDimensions)(R,A),this._capability.promise.finally(()=>{this._layoutTextParams=null}).catch(()=>{})}get promise(){return this._capability.promise}cancel(){this._canceled=!0,this._reader&&(this._reader.cancel(new p.AbortException("TextLayer task cancelled.")).catch(()=>{}),this._reader=null),this._capability.reject(new p.AbortException("TextLayer task cancelled."))}_processItems(P,R){for(const A of P){if(A.str===void 0){if(A.type==="beginMarkedContentProps"||A.type==="beginMarkedContent"){const t=this._container;this._container=document.createElement("span"),this._container.classList.add("markedContent"),A.id!==null&&this._container.setAttribute("id",`${A.id}`),t.append(this._container)}else A.type==="endMarkedContent"&&(this._container=this._container.parentNode);continue}this._textContentItemsStr.push(A.str),w(this,A,R)}}_layoutText(P){const R=this._layoutTextParams.properties=this._textDivProperties.get(P);if(this._layoutTextParams.div=P,C(this._layoutTextParams),R.hasText&&this._container.append(P),R.hasEOL){const A=document.createElement("br");A.setAttribute("role","presentation"),this._container.append(A)}}_render(){const P=(0,p.createPromiseCapability)();let R=Object.create(null);if(this._isReadableStream){const A=()=>{this._reader.read().then(({value:t,done:l})=>{if(l){P.resolve();return}Object.assign(R,t.styles),this._processItems(t.items,R),A()},P.reject)};this._reader=this._textContentSource.getReader(),A()}else if(this._textContentSource){const{items:A,styles:t}=this._textContentSource;this._processItems(A,t),P.resolve()}else throw new Error('No "textContentSource" parameter specified.');P.promise.then(()=>{R=null,y(this)},this._capability.reject)}}f.TextLayerRenderTask=d;function _(r){!r.textContentSource&&(r.textContent||r.textContentStream)&&((0,T.deprecated)("The TextLayerRender `textContent`/`textContentStream` parameters will be removed in the future, please use `textContentSource` instead."),r.textContentSource=r.textContent||r.textContentStream);const{container:P,viewport:R}=r,A=getComputedStyle(P),t=A.getPropertyValue("visibility"),l=parseFloat(A.getPropertyValue("--scale-factor"));t==="visible"&&(!l||Math.abs(l-R.scale)>1e-15)&&console.error("The `--scale-factor` CSS-variable must be set, to the same value as `viewport.scale`, either on the `container`-element itself or higher up in the DOM.");const a=new d(r);return a._render(),a}function s({container:r,viewport:P,textDivs:R,textDivProperties:A,isOffscreenCanvasSupported:t,mustRotate:l=!0,mustRescale:a=!0}){if(l&&(0,T.setLayerDimensions)(r,{rotation:P.rotation}),a){const n=S(0,t),E={prevFontSize:null,prevFontFamily:null,div:null,scale:P.scale*(globalThis.devicePixelRatio||1),properties:null,ctx:n};for(const i of R)E.properties=A.get(i),E.div=i,C(E)}}},(ot,f,z)=>{var S,g,w,C,y,d,_,s,r,be,R,Be,t,Ae,a,ye;Object.defineProperty(f,"__esModule",{value:!0}),f.AnnotationEditorLayer=void 0;var p=z(1),T=z(5),$=z(28),G=z(29),et=z(6);const u=class{constructor(i){Z(this,r);Z(this,R);Z(this,t);Z(this,a);Z(this,S,void 0);Z(this,g,!1);Z(this,w,this.pointerup.bind(this));Z(this,C,this.pointerdown.bind(this));Z(this,y,new Map);Z(this,d,!1);Z(this,_,!1);Z(this,s,void 0);u._initialized||(u._initialized=!0,$.FreeTextEditor.initialize(i.l10n),G.InkEditor.initialize(i.l10n)),i.uiManager.registerEditorTypes([$.FreeTextEditor,G.InkEditor]),pt(this,s,i.uiManager),this.pageIndex=i.pageIndex,this.div=i.div,pt(this,S,i.accessibilityManager),m(this,s).addLayer(this)}get isEmpty(){return m(this,y).size===0}updateToolbar(i){m(this,s).updateToolbar(i)}updateMode(i=m(this,s).getMode()){lt(this,a,ye).call(this),i===p.AnnotationEditorType.INK?(this.addInkEditorIfNeeded(!1),this.disableClick()):this.enableClick(),m(this,s).unselectAll(),i!==p.AnnotationEditorType.NONE&&(this.div.classList.toggle("freeTextEditing",i===p.AnnotationEditorType.FREETEXT),this.div.classList.toggle("inkEditing",i===p.AnnotationEditorType.INK),this.div.hidden=!1)}addInkEditorIfNeeded(i){if(!i&&m(this,s).getMode()!==p.AnnotationEditorType.INK)return;if(!i){for(const V of m(this,y).values())if(V.isEmpty()){V.setInBackground();return}}lt(this,t,Ae).call(this,{offsetX:0,offsetY:0}).setInBackground()}setEditingState(i){m(this,s).setEditingState(i)}addCommands(i){m(this,s).addCommands(i)}enable(){this.div.style.pointerEvents="auto";for(const i of m(this,y).values())i.enableEditing()}disable(){this.div.style.pointerEvents="none";for(const i of m(this,y).values())i.disableEditing();lt(this,a,ye).call(this),this.isEmpty&&(this.div.hidden=!0)}setActiveEditor(i){m(this,s).getActive()!==i&&m(this,s).setActiveEditor(i)}enableClick(){this.div.addEventListener("pointerdown",m(this,C)),this.div.addEventListener("pointerup",m(this,w))}disableClick(){this.div.removeEventListener("pointerdown",m(this,C)),this.div.removeEventListener("pointerup",m(this,w))}attach(i){m(this,y).set(i.id,i)}detach(i){var M;m(this,y).delete(i.id),(M=m(this,S))==null||M.removePointerInTextLayer(i.contentDiv)}remove(i){m(this,s).removeEditor(i),this.detach(i),i.div.style.display="none",setTimeout(()=>{i.div.style.display="",i.div.remove(),i.isAttachedToDOM=!1,document.activeElement===document.body&&m(this,s).focusMainContainer()},0),m(this,_)||this.addInkEditorIfNeeded(!1)}add(i){if(lt(this,r,be).call(this,i),m(this,s).addEditor(i),this.attach(i),!i.isAttachedToDOM){const M=i.render();this.div.append(M),i.isAttachedToDOM=!0}this.moveEditorInDOM(i),i.onceAdded(),m(this,s).addToAnnotationStorage(i)}moveEditorInDOM(i){var M;(M=m(this,S))==null||M.moveElementInDOM(this.div,i.div,i.contentDiv,!0)}addOrRebuild(i){i.needsToBeRebuilt()?i.rebuild():this.add(i)}addANewEditor(i){const M=()=>{this.addOrRebuild(i)},V=()=>{i.remove()};this.addCommands({cmd:M,undo:V,mustExec:!0})}addUndoableEditor(i){const M=()=>{this.addOrRebuild(i)},V=()=>{i.remove()};this.addCommands({cmd:M,undo:V,mustExec:!1})}getNextId(){return m(this,s).getId()}deserialize(i){switch(i.annotationType){case p.AnnotationEditorType.FREETEXT:return $.FreeTextEditor.deserialize(i,this,m(this,s));case p.AnnotationEditorType.INK:return G.InkEditor.deserialize(i,this,m(this,s))}return null}setSelected(i){m(this,s).setSelected(i)}toggleSelected(i){m(this,s).toggleSelected(i)}isSelected(i){return m(this,s).isSelected(i)}unselect(i){m(this,s).unselect(i)}pointerup(i){const{isMac:M}=p.FeatureTest.platform;if(!(i.button!==0||i.ctrlKey&&M)&&i.target===this.div&&m(this,d)){if(pt(this,d,!1),!m(this,g)){pt(this,g,!0);return}lt(this,t,Ae).call(this,i)}}pointerdown(i){const{isMac:M}=p.FeatureTest.platform;if(i.button!==0||i.ctrlKey&&M||i.target!==this.div)return;pt(this,d,!0);const V=m(this,s).getActive();pt(this,g,!V||V.isEmpty())}drop(i){const M=i.dataTransfer.getData("text/plain"),V=m(this,s).getEditor(M);if(!V)return;i.preventDefault(),i.dataTransfer.dropEffect="move",lt(this,r,be).call(this,V);const Y=this.div.getBoundingClientRect(),Q=i.clientX-Y.x,st=i.clientY-Y.y;V.translate(Q-V.startX,st-V.startY),this.moveEditorInDOM(V),V.div.focus()}dragover(i){i.preventDefault()}destroy(){var i,M;((i=m(this,s).getActive())==null?void 0:i.parent)===this&&m(this,s).setActiveEditor(null);for(const V of m(this,y).values())(M=m(this,S))==null||M.removePointerInTextLayer(V.contentDiv),V.setParent(null),V.isAttachedToDOM=!1,V.div.remove();this.div=null,m(this,y).clear(),m(this,s).removeLayer(this)}render({viewport:i}){this.viewport=i,(0,et.setLayerDimensions)(this.div,i),(0,T.bindEvents)(this,this.div,["dragover","drop"]);for(const M of m(this,s).getEditors(this.pageIndex))this.add(M);this.updateMode()}update({viewport:i}){m(this,s).commitOrRemove(),this.viewport=i,(0,et.setLayerDimensions)(this.div,{rotation:i.rotation}),this.updateMode()}get pageDimensions(){const{pageWidth:i,pageHeight:M}=this.viewport.rawDims;return[i,M]}};let I=u;S=new WeakMap,g=new WeakMap,w=new WeakMap,C=new WeakMap,y=new WeakMap,d=new WeakMap,_=new WeakMap,s=new WeakMap,r=new WeakSet,be=function(i){var M;i.parent!==this&&(this.attach(i),(M=i.parent)==null||M.detach(i),i.setParent(this),i.div&&i.isAttachedToDOM&&(i.div.remove(),this.div.append(i.div)))},R=new WeakSet,Be=function(i){switch(m(this,s).getMode()){case p.AnnotationEditorType.FREETEXT:return new $.FreeTextEditor(i);case p.AnnotationEditorType.INK:return new G.InkEditor(i)}return null},t=new WeakSet,Ae=function(i){const M=this.getNextId(),V=lt(this,R,Be).call(this,{parent:this,id:M,x:i.offsetX,y:i.offsetY,uiManager:m(this,s)});return V&&this.add(V),V},a=new WeakSet,ye=function(){pt(this,_,!0);for(const i of m(this,y).values())i.isEmpty()&&i.remove();pt(this,_,!1)},Dt(I,"_initialized",!1),f.AnnotationEditorLayer=I},(ot,f,z)=>{var et,I,S,g,w,C,y,d,_,s,Ue,P,We,A,He,l,ve;Object.defineProperty(f,"__esModule",{value:!0}),f.FreeTextEditor=void 0;var p=z(1),T=z(5),$=z(4);const n=class extends $.AnnotationEditor{constructor(i){super({...i,name:"freeTextEditor"});Z(this,s);Z(this,P);Z(this,A);Z(this,l);Z(this,et,this.editorDivBlur.bind(this));Z(this,I,this.editorDivFocus.bind(this));Z(this,S,this.editorDivInput.bind(this));Z(this,g,this.editorDivKeydown.bind(this));Z(this,w,void 0);Z(this,C,"");Z(this,y,`${this.id}-editor`);Z(this,d,!1);Z(this,_,void 0);pt(this,w,i.color||n._defaultColor||$.AnnotationEditor._defaultLineColor),pt(this,_,i.fontSize||n._defaultFontSize)}static initialize(i){this._l10nPromise=new Map(["free_text2_default_content","editor_free_text2_aria_label"].map(V=>[V,i.get(V)]));const M=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(M.getPropertyValue("--freetext-padding"))}static updateDefaultParams(i,M){switch(i){case p.AnnotationEditorParamsType.FREETEXT_SIZE:n._defaultFontSize=M;break;case p.AnnotationEditorParamsType.FREETEXT_COLOR:n._defaultColor=M;break}}updateParams(i,M){switch(i){case p.AnnotationEditorParamsType.FREETEXT_SIZE:lt(this,s,Ue).call(this,M);break;case p.AnnotationEditorParamsType.FREETEXT_COLOR:lt(this,P,We).call(this,M);break}}static get defaultPropertiesToUpdate(){return[[p.AnnotationEditorParamsType.FREETEXT_SIZE,n._defaultFontSize],[p.AnnotationEditorParamsType.FREETEXT_COLOR,n._defaultColor||$.AnnotationEditor._defaultLineColor]]}get propertiesToUpdate(){return[[p.AnnotationEditorParamsType.FREETEXT_SIZE,m(this,_)],[p.AnnotationEditorParamsType.FREETEXT_COLOR,m(this,w)]]}getInitialTranslation(){const i=this.parentScale;return[-n._internalPadding*i,-(n._internalPadding+m(this,_))*i]}rebuild(){super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this))}enableEditMode(){this.isInEditMode()||(this.parent.setEditingState(!1),this.parent.updateToolbar(p.AnnotationEditorType.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this.div.draggable=!1,this.div.removeAttribute("aria-activedescendant"),this.editorDiv.addEventListener("keydown",m(this,g)),this.editorDiv.addEventListener("focus",m(this,I)),this.editorDiv.addEventListener("blur",m(this,et)),this.editorDiv.addEventListener("input",m(this,S)))}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",m(this,y)),this.div.draggable=!0,this.editorDiv.removeEventListener("keydown",m(this,g)),this.editorDiv.removeEventListener("focus",m(this,I)),this.editorDiv.removeEventListener("blur",m(this,et)),this.editorDiv.removeEventListener("input",m(this,S)),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freeTextEditing"))}focusin(i){super.focusin(i),i.target!==this.editorDiv&&this.editorDiv.focus()}onceAdded(){this.width||(this.enableEditMode(),this.editorDiv.focus())}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent.setEditingState(!0),this.parent.div.classList.add("freeTextEditing"),super.remove()}commit(){this.isInEditMode()&&(super.commit(),m(this,d)||(pt(this,d,!0),this.parent.addUndoableEditor(this)),this.disableEditMode(),pt(this,C,lt(this,A,He).call(this).trimEnd()),lt(this,l,ve).call(this))}shouldGetKeyboardEvents(){return this.isInEditMode()}dblclick(i){this.enableEditMode(),this.editorDiv.focus()}keydown(i){i.target===this.div&&i.key==="Enter"&&(this.enableEditMode(),this.editorDiv.focus())}editorDivKeydown(i){n._keyboardManager.exec(this,i)}editorDivFocus(i){this.isEditing=!0}editorDivBlur(i){this.isEditing=!1}editorDivInput(i){this.parent.div.classList.toggle("freeTextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let i,M;this.width&&(i=this.x,M=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",m(this,y)),this.enableEditing(),n._l10nPromise.get("editor_free_text2_aria_label").then(Y=>{var Q;return(Q=this.editorDiv)==null?void 0:Q.setAttribute("aria-label",Y)}),n._l10nPromise.get("free_text2_default_content").then(Y=>{var Q;return(Q=this.editorDiv)==null?void 0:Q.setAttribute("default-content",Y)}),this.editorDiv.contentEditable=!0;const{style:V}=this.editorDiv;if(V.fontSize=`calc(${m(this,_)}px * var(--scale-factor))`,V.color=m(this,w),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),(0,T.bindEvents)(this,this.div,["dblclick","keydown"]),this.width){const[Y,Q]=this.parentDimensions;this.setAt(i*Y,M*Q,this.width*Y,this.height*Q);for(const st of m(this,C).split(`
`)){const ft=document.createElement("div");ft.append(st?document.createTextNode(st):document.createElement("br")),this.editorDiv.append(ft)}this.div.draggable=!0,this.editorDiv.contentEditable=!1}else this.div.draggable=!1,this.editorDiv.contentEditable=!0;return this.div}get contentDiv(){return this.editorDiv}static deserialize(i,M,V){const Y=super.deserialize(i,M,V);return pt(Y,_,i.fontSize),pt(Y,w,p.Util.makeHexColor(...i.color)),pt(Y,C,i.value),Y}serialize(){if(this.isEmpty())return null;const i=n._internalPadding*this.parentScale,M=this.getRect(i,i),V=$.AnnotationEditor._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:m(this,w));return{annotationType:p.AnnotationEditorType.FREETEXT,color:V,fontSize:m(this,_),value:m(this,C),pageIndex:this.pageIndex,rect:M,rotation:this.rotation}}};let G=n;et=new WeakMap,I=new WeakMap,S=new WeakMap,g=new WeakMap,w=new WeakMap,C=new WeakMap,y=new WeakMap,d=new WeakMap,_=new WeakMap,s=new WeakSet,Ue=function(i){const M=Y=>{this.editorDiv.style.fontSize=`calc(${Y}px * var(--scale-factor))`,this.translate(0,-(Y-m(this,_))*this.parentScale),pt(this,_,Y),lt(this,l,ve).call(this)},V=m(this,_);this.addCommands({cmd:()=>{M(i)},undo:()=>{M(V)},mustExec:!0,type:p.AnnotationEditorParamsType.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},P=new WeakSet,We=function(i){const M=m(this,w);this.addCommands({cmd:()=>{pt(this,w,this.editorDiv.style.color=i)},undo:()=>{pt(this,w,this.editorDiv.style.color=M)},mustExec:!0,type:p.AnnotationEditorParamsType.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},A=new WeakSet,He=function(){const i=this.editorDiv.getElementsByTagName("div");if(i.length===0)return this.editorDiv.innerText;const M=[];for(const V of i)M.push(V.innerText.replace(/\r\n?|\n/,""));return M.join(`
`)},l=new WeakSet,ve=function(){const[i,M]=this.parentDimensions;let V;if(this.isAttachedToDOM)V=this.div.getBoundingClientRect();else{const{currentLayer:Y,div:Q}=this,st=Q.style.display;Q.style.display="hidden",Y.div.append(this.div),V=Q.getBoundingClientRect(),Q.remove(),Q.style.display=st}this.width=V.width/i,this.height=V.height/M},Dt(G,"_freeTextDefaultContent",""),Dt(G,"_l10nPromise"),Dt(G,"_internalPadding",0),Dt(G,"_defaultColor",null),Dt(G,"_defaultFontSize",10),Dt(G,"_keyboardManager",new T.KeyboardManager([[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],n.prototype.commitOrRemove]])),Dt(G,"_type","freetext"),f.FreeTextEditor=G},(ot,f,z)=>{var S,g,w,C,y,d,_,s,r,P,R,A,t,l,a,qe,u,Ge,i,Ve,V,Xe,Q,Se,ft,$e,dt,ze,yt,Ye,c,Gt,v,Ee,D,ae,H,oe,X,Yt,k,Ce,o,le,x,Te,N,Ke,tt,Je,at,Qe,ct,xe,gt,ce,At,Kt,F,Pe;Object.defineProperty(f,"__esModule",{value:!0}),f.InkEditor=void 0,Object.defineProperty(f,"fitCurve",{enumerable:!0,get:function(){return $.fitCurve}});var p=z(1),T=z(4),$=z(30),G=z(5);const et=16,W=class extends T.AnnotationEditor{constructor(J){super({...J,name:"inkEditor"});Z(this,a);Z(this,u);Z(this,i);Z(this,V);Z(this,Q);Z(this,ft);Z(this,dt);Z(this,yt);Z(this,c);Z(this,v);Z(this,D);Z(this,H);Z(this,X);Z(this,k);Z(this,o);Z(this,N);Z(this,tt);Z(this,at);Z(this,ct);Z(this,gt);Z(this,At);Z(this,F);Z(this,S,0);Z(this,g,0);Z(this,w,0);Z(this,C,this.canvasPointermove.bind(this));Z(this,y,this.canvasPointerleave.bind(this));Z(this,d,this.canvasPointerup.bind(this));Z(this,_,this.canvasPointerdown.bind(this));Z(this,s,!1);Z(this,r,!1);Z(this,P,null);Z(this,R,null);Z(this,A,0);Z(this,t,0);Z(this,l,null);this.color=J.color||null,this.thickness=J.thickness||null,this.opacity=J.opacity||null,this.paths=[],this.bezierPath2D=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0}static initialize(J){this._l10nPromise=new Map(["editor_ink_canvas_aria_label","editor_ink2_aria_label"].map(ht=>[ht,J.get(ht)]))}static updateDefaultParams(J,ht){switch(J){case p.AnnotationEditorParamsType.INK_THICKNESS:W._defaultThickness=ht;break;case p.AnnotationEditorParamsType.INK_COLOR:W._defaultColor=ht;break;case p.AnnotationEditorParamsType.INK_OPACITY:W._defaultOpacity=ht/100;break}}updateParams(J,ht){switch(J){case p.AnnotationEditorParamsType.INK_THICKNESS:lt(this,a,qe).call(this,ht);break;case p.AnnotationEditorParamsType.INK_COLOR:lt(this,u,Ge).call(this,ht);break;case p.AnnotationEditorParamsType.INK_OPACITY:lt(this,i,Ve).call(this,ht);break}}static get defaultPropertiesToUpdate(){return[[p.AnnotationEditorParamsType.INK_THICKNESS,W._defaultThickness],[p.AnnotationEditorParamsType.INK_COLOR,W._defaultColor||T.AnnotationEditor._defaultLineColor],[p.AnnotationEditorParamsType.INK_OPACITY,Math.round(W._defaultOpacity*100)]]}get propertiesToUpdate(){return[[p.AnnotationEditorParamsType.INK_THICKNESS,this.thickness||W._defaultThickness],[p.AnnotationEditorParamsType.INK_COLOR,this.color||W._defaultColor||T.AnnotationEditor._defaultLineColor],[p.AnnotationEditorParamsType.INK_OPACITY,Math.round(100*(this.opacity??W._defaultOpacity))]]}rebuild(){super.rebuild(),this.div!==null&&(this.canvas||(lt(this,D,ae).call(this),lt(this,H,oe).call(this)),this.isAttachedToDOM||(this.parent.add(this),lt(this,X,Yt).call(this)),lt(this,At,Kt).call(this))}remove(){this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,m(this,R).disconnect(),pt(this,R,null),super.remove())}setParent(J){!this.parent&&J?this._uiManager.removeShouldRescale(this):this.parent&&J===null&&this._uiManager.addShouldRescale(this),super.setParent(J)}onScaleChanging(){const[J,ht]=this.parentDimensions,vt=this.width*J,St=this.height*ht;this.setDimensions(vt,St)}enableEditMode(){m(this,s)||this.canvas===null||(super.enableEditMode(),this.div.draggable=!1,this.canvas.addEventListener("pointerdown",m(this,_)),this.canvas.addEventListener("pointerup",m(this,d)))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this.div.draggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",m(this,_)),this.canvas.removeEventListener("pointerup",m(this,d)))}onceAdded(){this.div.draggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}commit(){m(this,s)||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),pt(this,s,!0),this.div.classList.add("disabled"),lt(this,At,Kt).call(this,!0),this.parent.addInkEditorIfNeeded(!0),this.parent.moveEditorInDOM(this),this.div.focus({preventScroll:!0}))}focusin(J){super.focusin(J),this.enableEditMode()}canvasPointerdown(J){J.button!==0||!this.isInEditMode()||m(this,s)||(this.setInForeground(),J.type!=="mouse"&&this.div.focus(),J.stopPropagation(),this.canvas.addEventListener("pointerleave",m(this,y)),this.canvas.addEventListener("pointermove",m(this,C)),lt(this,ft,$e).call(this,J.offsetX,J.offsetY))}canvasPointermove(J){J.stopPropagation(),lt(this,dt,ze).call(this,J.offsetX,J.offsetY)}canvasPointerup(J){J.button===0&&this.isInEditMode()&&this.currentPath.length!==0&&(J.stopPropagation(),lt(this,v,Ee).call(this,J),this.setInBackground())}canvasPointerleave(J){lt(this,v,Ee).call(this,J),this.setInBackground()}render(){if(this.div)return this.div;let J,ht;this.width&&(J=this.x,ht=this.y),super.render(),W._l10nPromise.get("editor_ink2_aria_label").then(wt=>{var xt;return(xt=this.div)==null?void 0:xt.setAttribute("aria-label",wt)});const[vt,St,Ft,kt]=lt(this,V,Xe).call(this);if(this.setAt(vt,St,0,0),this.setDims(Ft,kt),lt(this,D,ae).call(this),this.width){const[wt,xt]=this.parentDimensions;this.setAt(J*wt,ht*xt,this.width*wt,this.height*xt),pt(this,r,!0),lt(this,X,Yt).call(this),this.setDims(this.width*wt,this.height*xt),lt(this,c,Gt).call(this),lt(this,F,Pe).call(this),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return lt(this,H,oe).call(this),this.div}setDimensions(J,ht){const vt=Math.round(J),St=Math.round(ht);if(m(this,A)===vt&&m(this,t)===St)return;pt(this,A,vt),pt(this,t,St),this.canvas.style.visibility="hidden",m(this,S)&&Math.abs(m(this,S)-J/ht)>.01&&(ht=Math.ceil(J/m(this,S)),this.setDims(J,ht));const[Ft,kt]=this.parentDimensions;this.width=J/Ft,this.height=ht/kt,m(this,s)&&lt(this,k,Ce).call(this,J,ht),lt(this,X,Yt).call(this),lt(this,c,Gt).call(this),this.canvas.style.visibility="visible",this.fixDims()}static deserialize(J,ht,vt){var Mt,Ot;const St=super.deserialize(J,ht,vt);St.thickness=J.thickness,St.color=p.Util.makeHexColor(...J.color),St.opacity=J.opacity;const[Ft,kt]=St.pageDimensions,wt=St.width*Ft,xt=St.height*kt,Rt=St.parentScale,Tt=J.thickness/2;pt(St,S,wt/xt),pt(St,s,!0),pt(St,A,Math.round(wt)),pt(St,t,Math.round(xt));for(const{bezier:Lt}of J.paths){const jt=[];St.paths.push(jt);let It=Rt*(Lt[0]-Tt),Bt=Rt*(xt-Lt[1]-Tt);for(let Ut=2,Zt=Lt.length;Ut<Zt;Ut+=6){const te=Rt*(Lt[Ut]-Tt),ee=Rt*(xt-Lt[Ut+1]-Tt),se=Rt*(Lt[Ut+2]-Tt),ne=Rt*(xt-Lt[Ut+3]-Tt),Fe=Rt*(Lt[Ut+4]-Tt),Re=Rt*(xt-Lt[Ut+5]-Tt);jt.push([[It,Bt],[te,ee],[se,ne],[Fe,Re]]),It=Fe,Bt=Re}const Ht=lt(this,x,Te).call(this,jt);St.bezierPath2D.push(Ht)}const Nt=lt(Mt=St,ct,xe).call(Mt);return pt(St,w,Math.max(et,Nt[2]-Nt[0])),pt(St,g,Math.max(et,Nt[3]-Nt[1])),lt(Ot=St,k,Ce).call(Ot,wt,xt),St}serialize(){if(this.isEmpty())return null;const J=this.getRect(0,0),ht=this.rotation%180===0?J[3]-J[1]:J[2]-J[0],vt=T.AnnotationEditor._colorManager.convert(this.ctx.strokeStyle);return{annotationType:p.AnnotationEditorType.INK,color:vt,thickness:this.thickness,opacity:this.opacity,paths:lt(this,N,Ke).call(this,this.scaleFactor/this.parentScale,this.translationX,this.translationY,ht),pageIndex:this.pageIndex,rect:J,rotation:this.rotation}}};let I=W;S=new WeakMap,g=new WeakMap,w=new WeakMap,C=new WeakMap,y=new WeakMap,d=new WeakMap,_=new WeakMap,s=new WeakMap,r=new WeakMap,P=new WeakMap,R=new WeakMap,A=new WeakMap,t=new WeakMap,l=new WeakMap,a=new WeakSet,qe=function(J){const ht=this.thickness;this.addCommands({cmd:()=>{this.thickness=J,lt(this,At,Kt).call(this)},undo:()=>{this.thickness=ht,lt(this,At,Kt).call(this)},mustExec:!0,type:p.AnnotationEditorParamsType.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})},u=new WeakSet,Ge=function(J){const ht=this.color;this.addCommands({cmd:()=>{this.color=J,lt(this,c,Gt).call(this)},undo:()=>{this.color=ht,lt(this,c,Gt).call(this)},mustExec:!0,type:p.AnnotationEditorParamsType.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})},i=new WeakSet,Ve=function(J){J/=100;const ht=this.opacity;this.addCommands({cmd:()=>{this.opacity=J,lt(this,c,Gt).call(this)},undo:()=>{this.opacity=ht,lt(this,c,Gt).call(this)},mustExec:!0,type:p.AnnotationEditorParamsType.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})},V=new WeakSet,Xe=function(){const{parentRotation:J,parentDimensions:[ht,vt]}=this;switch(J){case 90:return[0,vt,vt,ht];case 180:return[ht,vt,ht,vt];case 270:return[ht,0,vt,ht];default:return[0,0,ht,vt]}},Q=new WeakSet,Se=function(){const{ctx:J,color:ht,opacity:vt,thickness:St,parentScale:Ft,scaleFactor:kt}=this;J.lineWidth=St*Ft/kt,J.lineCap="round",J.lineJoin="round",J.miterLimit=10,J.strokeStyle=`${ht}${(0,G.opacityToHex)(vt)}`},ft=new WeakSet,$e=function(J,ht){this.isEditing=!0,m(this,r)||(pt(this,r,!0),lt(this,X,Yt).call(this),this.thickness||(this.thickness=W._defaultThickness),this.color||(this.color=W._defaultColor||T.AnnotationEditor._defaultLineColor),this.opacity??(this.opacity=W._defaultOpacity)),this.currentPath.push([J,ht]),pt(this,P,null),lt(this,Q,Se).call(this),this.ctx.beginPath(),this.ctx.moveTo(J,ht),pt(this,l,()=>{m(this,l)&&(m(this,P)&&(this.isEmpty()?(this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)):lt(this,c,Gt).call(this),this.ctx.lineTo(...m(this,P)),pt(this,P,null),this.ctx.stroke()),window.requestAnimationFrame(m(this,l)))}),window.requestAnimationFrame(m(this,l))},dt=new WeakSet,ze=function(J,ht){const[vt,St]=this.currentPath.at(-1);J===vt&&ht===St||(this.currentPath.push([J,ht]),pt(this,P,[J,ht]))},yt=new WeakSet,Ye=function(J,ht){var Rt;this.ctx.closePath(),pt(this,l,null),J=Math.min(Math.max(J,0),this.canvas.width),ht=Math.min(Math.max(ht,0),this.canvas.height);const[vt,St]=this.currentPath.at(-1);(J!==vt||ht!==St)&&this.currentPath.push([J,ht]);let Ft;if(this.currentPath.length!==1)Ft=(0,$.fitCurve)(this.currentPath,30,null);else{const Tt=[J,ht];Ft=[[Tt,Tt.slice(),Tt.slice(),Tt]]}const kt=lt(Rt=W,x,Te).call(Rt,Ft);this.currentPath.length=0;const wt=()=>{this.paths.push(Ft),this.bezierPath2D.push(kt),this.rebuild()},xt=()=>{this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(lt(this,D,ae).call(this),lt(this,H,oe).call(this)),lt(this,At,Kt).call(this))};this.addCommands({cmd:wt,undo:xt,mustExec:!0})},c=new WeakSet,Gt=function(){if(this.isEmpty()){lt(this,o,le).call(this);return}lt(this,Q,Se).call(this);const{canvas:J,ctx:ht}=this;ht.setTransform(1,0,0,1,0,0),ht.clearRect(0,0,J.width,J.height),lt(this,o,le).call(this);for(const vt of this.bezierPath2D)ht.stroke(vt)},v=new WeakSet,Ee=function(J){lt(this,yt,Ye).call(this,J.offsetX,J.offsetY),this.canvas.removeEventListener("pointerleave",m(this,y)),this.canvas.removeEventListener("pointermove",m(this,C)),this.addToAnnotationStorage()},D=new WeakSet,ae=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",W._l10nPromise.get("editor_ink_canvas_aria_label").then(J=>{var ht;return(ht=this.canvas)==null?void 0:ht.setAttribute("aria-label",J)}),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")},H=new WeakSet,oe=function(){pt(this,R,new ResizeObserver(J=>{const ht=J[0].contentRect;ht.width&&ht.height&&this.setDimensions(ht.width,ht.height)})),m(this,R).observe(this.div)},X=new WeakSet,Yt=function(){if(!m(this,r))return;const[J,ht]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*J),this.canvas.height=Math.ceil(this.height*ht),lt(this,o,le).call(this)},k=new WeakSet,Ce=function(J,ht){const vt=lt(this,gt,ce).call(this),St=(J-vt)/m(this,w),Ft=(ht-vt)/m(this,g);this.scaleFactor=Math.min(St,Ft)},o=new WeakSet,le=function(){const J=lt(this,gt,ce).call(this)/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+J,this.translationY*this.scaleFactor+J)},x=new WeakSet,Te=function(J){const ht=new Path2D;for(let vt=0,St=J.length;vt<St;vt++){const[Ft,kt,wt,xt]=J[vt];vt===0&&ht.moveTo(...Ft),ht.bezierCurveTo(kt[0],kt[1],wt[0],wt[1],xt[0],xt[1])}return ht},N=new WeakSet,Ke=function(J,ht,vt,St){const kt=[],wt=this.thickness/2;let xt,Rt;for(const Tt of this.paths){xt=[],Rt=[];for(let Nt=0,Mt=Tt.length;Nt<Mt;Nt++){const[Ot,Lt,jt,It]=Tt[Nt],Bt=J*(Ot[0]+ht)+wt,Ht=St-J*(Ot[1]+vt)-wt,Ut=J*(Lt[0]+ht)+wt,Zt=St-J*(Lt[1]+vt)-wt,te=J*(jt[0]+ht)+wt,ee=St-J*(jt[1]+vt)-wt,se=J*(It[0]+ht)+wt,ne=St-J*(It[1]+vt)-wt;Nt===0&&(xt.push(Bt,Ht),Rt.push(Bt,Ht)),xt.push(Ut,Zt,te,ee,se,ne),lt(this,tt,Je).call(this,Bt,Ht,Ut,Zt,te,ee,se,ne,4,Rt)}kt.push({bezier:xt,points:Rt})}return kt},tt=new WeakSet,Je=function(J,ht,vt,St,Ft,kt,wt,xt,Rt,Tt){if(lt(this,at,Qe).call(this,J,ht,vt,St,Ft,kt,wt,xt)){Tt.push(wt,xt);return}for(let Nt=1;Nt<Rt-1;Nt++){const Mt=Nt/Rt,Ot=1-Mt;let Lt=Mt*J+Ot*vt,jt=Mt*ht+Ot*St,It=Mt*vt+Ot*Ft,Bt=Mt*St+Ot*kt;const Ht=Mt*Ft+Ot*wt,Ut=Mt*kt+Ot*xt;Lt=Mt*Lt+Ot*It,jt=Mt*jt+Ot*Bt,It=Mt*It+Ot*Ht,Bt=Mt*Bt+Ot*Ut,Lt=Mt*Lt+Ot*It,jt=Mt*jt+Ot*Bt,Tt.push(Lt,jt)}Tt.push(wt,xt)},at=new WeakSet,Qe=function(J,ht,vt,St,Ft,kt,wt,xt){const Tt=(3*vt-2*J-wt)**2,Nt=(3*St-2*ht-xt)**2,Mt=(3*Ft-J-2*wt)**2,Ot=(3*kt-ht-2*xt)**2;return Math.max(Tt,Mt)+Math.max(Nt,Ot)<=10},ct=new WeakSet,xe=function(){let J=1/0,ht=-1/0,vt=1/0,St=-1/0;for(const Ft of this.paths)for(const[kt,wt,xt,Rt]of Ft){const Tt=p.Util.bezierBoundingBox(...kt,...wt,...xt,...Rt);J=Math.min(J,Tt[0]),vt=Math.min(vt,Tt[1]),ht=Math.max(ht,Tt[2]),St=Math.max(St,Tt[3])}return[J,vt,ht,St]},gt=new WeakSet,ce=function(){return m(this,s)?Math.ceil(this.thickness*this.parentScale):0},At=new WeakSet,Kt=function(J=!1){if(this.isEmpty())return;if(!m(this,s)){lt(this,c,Gt).call(this);return}const ht=lt(this,ct,xe).call(this),vt=lt(this,gt,ce).call(this);pt(this,w,Math.max(et,ht[2]-ht[0])),pt(this,g,Math.max(et,ht[3]-ht[1]));const St=Math.ceil(vt+m(this,w)*this.scaleFactor),Ft=Math.ceil(vt+m(this,g)*this.scaleFactor),[kt,wt]=this.parentDimensions;this.width=St/kt,this.height=Ft/wt,pt(this,S,St/Ft),lt(this,F,Pe).call(this);const xt=this.translationX,Rt=this.translationY;this.translationX=-ht[0],this.translationY=-ht[1],lt(this,X,Yt).call(this),lt(this,c,Gt).call(this),pt(this,A,St),pt(this,t,Ft),this.setDims(St,Ft);const Tt=J?vt/this.scaleFactor/2:0;this.translate(xt-this.translationX-Tt,Rt-this.translationY-Tt)},F=new WeakSet,Pe=function(){const{style:J}=this.div;m(this,S)>=1?(J.minHeight=`${et}px`,J.minWidth=`${Math.round(m(this,S)*et)}px`):(J.minWidth=`${et}px`,J.minHeight=`${Math.round(et/m(this,S))}px`)},Z(I,x),Dt(I,"_defaultColor",null),Dt(I,"_defaultOpacity",1),Dt(I,"_defaultThickness",1),Dt(I,"_l10nPromise"),Dt(I,"_type","ink"),f.InkEditor=I},(ot,f,z)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.fitCurve=void 0;const p=z(31);f.fitCurve=p},ot=>{function f(d,_,s){if(!Array.isArray(d))throw new TypeError("First argument should be an array");if(d.forEach(A=>{if(!Array.isArray(A)||A.some(t=>typeof t!="number")||A.length!==d[0].length)throw Error("Each point should be an array of numbers. Each point should have the same amount of numbers.")}),d=d.filter((A,t)=>t===0||!A.every((l,a)=>l===d[t-1][a])),d.length<2)return[];const r=d.length,P=w(d[1],d[0]),R=w(d[r-2],d[r-1]);return z(d,P,R,_,s)}function z(d,_,s,r,P){var A,t,l,a,n,u,E,i,M,V,Y,Q,st;if(d.length===2)return Q=C.vectorLen(C.subtract(d[0],d[1]))/3,A=[d[0],C.addArrays(d[0],C.mulItems(_,Q)),C.addArrays(d[1],C.mulItems(s,Q)),d[1]],[A];if(t=et(d),[A,a,u]=p(d,t,t,_,s,P),a===0||a<r)return[A];if(a<r*r)for(l=t,n=a,E=u,st=0;st<20;st++){if(l=$(A,d,l),[A,a,u]=p(d,t,l,_,s,P),a<r)return[A];if(u===E){let ft=a/n;if(ft>.9999&&ft<1.0001)break}n=a,E=u}return Y=[],i=C.subtract(d[u-1],d[u+1]),i.every(ft=>ft===0)&&(i=C.subtract(d[u-1],d[u]),[i[0],i[1]]=[-i[1],i[0]]),M=C.normalize(i),V=C.mulItems(M,-1),Y=Y.concat(z(d.slice(0,u+1),_,M,r,P)),Y=Y.concat(z(d.slice(u),V,s,r,P)),Y}function p(d,_,s,r,P,R){var A,t,l;return A=T(d,s,r,P),[t,l]=I(d,A,_),R&&R({bez:A,points:d,params:_,maxErr:t,maxPoint:l}),[A,t,l]}function T(d,_,s,r){var P,R,A,t,l,a,n,u,E,i,M,V,Y,Q,st,ft,nt,dt=d[0],bt=d[d.length-1];for(P=[dt,null,null,bt],R=C.zeros_Xx2x2(_.length),Y=0,Q=_.length;Y<Q;Y++)ft=_[Y],nt=1-ft,A=R[Y],A[0]=C.mulItems(s,3*ft*(nt*nt)),A[1]=C.mulItems(r,3*nt*(ft*ft));for(t=[[0,0],[0,0]],l=[0,0],Y=0,Q=d.length;Y<Q;Y++)ft=_[Y],A=R[Y],t[0][0]+=C.dot(A[0],A[0]),t[0][1]+=C.dot(A[0],A[1]),t[1][0]+=C.dot(A[0],A[1]),t[1][1]+=C.dot(A[1],A[1]),st=C.subtract(d[Y],y.q([dt,dt,bt,bt],ft)),l[0]+=C.dot(A[0],st),l[1]+=C.dot(A[1],st);return a=t[0][0]*t[1][1]-t[1][0]*t[0][1],n=t[0][0]*l[1]-t[1][0]*l[0],u=l[0]*t[1][1]-l[1]*t[0][1],E=a===0?0:u/a,i=a===0?0:n/a,V=C.vectorLen(C.subtract(dt,bt)),M=1e-6*V,E<M||i<M?(P[1]=C.addArrays(dt,C.mulItems(s,V/3)),P[2]=C.addArrays(bt,C.mulItems(r,V/3))):(P[1]=C.addArrays(dt,C.mulItems(s,E)),P[2]=C.addArrays(bt,C.mulItems(r,i))),P}function $(d,_,s){return s.map((r,P)=>G(d,_[P],r))}function G(d,_,s){var r=C.subtract(y.q(d,s),_),P=y.qprime(d,s),R=C.mulMatrix(r,P),A=C.sum(C.squareItems(P))+2*C.mulMatrix(r,y.qprimeprime(d,s));return A===0?s:s-R/A}function et(d){var _=[],s,r,P;return d.forEach((R,A)=>{s=A?r+C.vectorLen(C.subtract(R,P)):0,_.push(s),r=s,P=R}),_=_.map(R=>R/r),_}function I(d,_,s){var r,P,R,A,t,l,a,n;P=0,R=Math.floor(d.length/2);const u=S(_,10);for(t=0,l=d.length;t<l;t++)a=d[t],n=g(_,s[t],u,10),A=C.subtract(y.q(_,n),a),r=A[0]*A[0]+A[1]*A[1],r>P&&(P=r,R=t);return[P,R]}var S=function(d,_){for(var s,r=[0],P=d[0],R=0,A=1;A<=_;A++)s=y.q(d,A/_),R+=C.vectorLen(C.subtract(s,P)),r.push(R),P=s;return r=r.map(t=>t/R),r};function g(d,_,s,r){if(_<0)return 0;if(_>1)return 1;for(var P,R,A,t,l,a=1;a<=r;a++)if(_<=s[a]){t=(a-1)/r,A=a/r,R=s[a-1],P=s[a],l=(_-R)/(P-R)*(A-t)+t;break}return l}function w(d,_){return C.normalize(C.subtract(d,_))}class C{static zeros_Xx2x2(_){for(var s=[];_--;)s.push([0,0]);return s}static mulItems(_,s){return _.map(r=>r*s)}static mulMatrix(_,s){return _.reduce((r,P,R)=>r+P*s[R],0)}static subtract(_,s){return _.map((r,P)=>r-s[P])}static addArrays(_,s){return _.map((r,P)=>r+s[P])}static addItems(_,s){return _.map(r=>r+s)}static sum(_){return _.reduce((s,r)=>s+r)}static dot(_,s){return C.mulMatrix(_,s)}static vectorLen(_){return Math.hypot(..._)}static divItems(_,s){return _.map(r=>r/s)}static squareItems(_){return _.map(s=>s*s)}static normalize(_){return this.divItems(_,this.vectorLen(_))}}class y{static q(_,s){var r=1-s,P=C.mulItems(_[0],r*r*r),R=C.mulItems(_[1],3*r*r*s),A=C.mulItems(_[2],3*r*s*s),t=C.mulItems(_[3],s*s*s);return C.addArrays(C.addArrays(P,R),C.addArrays(A,t))}static qprime(_,s){var r=1-s,P=C.mulItems(C.subtract(_[1],_[0]),3*r*r),R=C.mulItems(C.subtract(_[2],_[1]),6*r*s),A=C.mulItems(C.subtract(_[3],_[2]),3*s*s);return C.addArrays(C.addArrays(P,R),A)}static qprimeprime(_,s){return C.addArrays(C.mulItems(C.addArrays(C.subtract(_[2],C.mulItems(_[1],2)),_[0]),6*(1-s)),C.mulItems(C.addArrays(C.subtract(_[3],C.mulItems(_[2],2)),_[1]),6*s))}}ot.exports=f,ot.exports.fitCubic=z,ot.exports.createTangent=w},(ot,f,z)=>{var c,Xt,v,Ze,q,we,K,ke;Object.defineProperty(f,"__esModule",{value:!0}),f.AnnotationLayer=void 0;var p=z(1),T=z(6),$=z(3),G=z(33),et=z(34);const I=1e3,S=9,g=new WeakSet;function w(k){return{width:k[2]-k[0],height:k[3]-k[1]}}class C{static create(e){switch(e.data.annotationType){case p.AnnotationType.LINK:return new d(e);case p.AnnotationType.TEXT:return new _(e);case p.AnnotationType.WIDGET:switch(e.data.fieldType){case"Tx":return new r(e);case"Btn":return e.data.radioButton?new R(e):e.data.checkBox?new P(e):new A(e);case"Ch":return new t(e)}return new s(e);case p.AnnotationType.POPUP:return new l(e);case p.AnnotationType.FREETEXT:return new n(e);case p.AnnotationType.LINE:return new u(e);case p.AnnotationType.SQUARE:return new E(e);case p.AnnotationType.CIRCLE:return new i(e);case p.AnnotationType.POLYLINE:return new M(e);case p.AnnotationType.CARET:return new Y(e);case p.AnnotationType.INK:return new Q(e);case p.AnnotationType.POLYGON:return new V(e);case p.AnnotationType.HIGHLIGHT:return new st(e);case p.AnnotationType.UNDERLINE:return new ft(e);case p.AnnotationType.SQUIGGLY:return new nt(e);case p.AnnotationType.STRIKEOUT:return new dt(e);case p.AnnotationType.STAMP:return new bt(e);case p.AnnotationType.FILEATTACHMENT:return new yt(e);default:return new y(e)}}}class y{constructor(e,{isRenderable:o=!1,ignoreBorder:b=!1,createQuadrilaterals:x=!1}={}){this.isRenderable=o,this.data=e.data,this.layer=e.layer,this.page=e.page,this.viewport=e.viewport,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,o&&(this.container=this._createContainer(b)),x&&(this.quadrilaterals=this._createQuadrilaterals(b))}_createContainer(e=!1){const{data:o,page:b,viewport:x}=this,O=document.createElement("section");O.setAttribute("data-annotation-id",o.id),o.noRotate&&O.classList.add("norotate");const{pageWidth:N,pageHeight:it,pageX:tt,pageY:rt}=x.rawDims,{width:at,height:ut}=w(o.rect),ct=p.Util.normalizeRect([o.rect[0],b.view[3]-o.rect[1]+b.view[1],o.rect[2],b.view[3]-o.rect[3]+b.view[1]]);if(!e&&o.borderStyle.width>0){O.style.borderWidth=`${o.borderStyle.width}px`;const gt=o.borderStyle.horizontalCornerRadius,Et=o.borderStyle.verticalCornerRadius;if(gt>0||Et>0){const Pt=`calc(${gt}px * var(--scale-factor)) / calc(${Et}px * var(--scale-factor))`;O.style.borderRadius=Pt}else if(this instanceof R){const Pt=`calc(${at}px * var(--scale-factor)) / calc(${ut}px * var(--scale-factor))`;O.style.borderRadius=Pt}switch(o.borderStyle.style){case p.AnnotationBorderStyleType.SOLID:O.style.borderStyle="solid";break;case p.AnnotationBorderStyleType.DASHED:O.style.borderStyle="dashed";break;case p.AnnotationBorderStyleType.BEVELED:(0,p.warn)("Unimplemented border style: beveled");break;case p.AnnotationBorderStyleType.INSET:(0,p.warn)("Unimplemented border style: inset");break;case p.AnnotationBorderStyleType.UNDERLINE:O.style.borderBottomStyle="solid";break}const At=o.borderColor||null;At?O.style.borderColor=p.Util.makeHexColor(At[0]|0,At[1]|0,At[2]|0):O.style.borderWidth=0}O.style.left=`${100*(ct[0]-tt)/N}%`,O.style.top=`${100*(ct[1]-rt)/it}%`;const{rotation:mt}=o;return o.hasOwnCanvas||mt===0?(O.style.width=`${100*at/N}%`,O.style.height=`${100*ut/it}%`):this.setRotation(mt,O),O}setRotation(e,o=this.container){const{pageWidth:b,pageHeight:x}=this.viewport.rawDims,{width:O,height:N}=w(this.data.rect);let it,tt;e%180===0?(it=100*O/b,tt=100*N/x):(it=100*N/b,tt=100*O/x),o.style.width=`${it}%`,o.style.height=`${tt}%`,o.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(o,b,x)=>{const O=x.detail[o];x.target.style[b]=G.ColorConverters[`${O[0]}_HTML`](O.slice(1))};return(0,p.shadow)(this,"_commonActions",{display:o=>{const b=o.detail.display%2===1;this.container.style.visibility=b?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:b,print:o.detail.display===0||o.detail.display===3})},print:o=>{this.annotationStorage.setValue(this.data.id,{print:o.detail.print})},hidden:o=>{this.container.style.visibility=o.detail.hidden?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{hidden:o.detail.hidden})},focus:o=>{setTimeout(()=>o.target.focus({preventScroll:!1}),0)},userName:o=>{o.target.title=o.detail.userName},readonly:o=>{o.detail.readonly?o.target.setAttribute("readonly",""):o.target.removeAttribute("readonly")},required:o=>{this._setRequired(o.target,o.detail.required)},bgColor:o=>{e("bgColor","backgroundColor",o)},fillColor:o=>{e("fillColor","backgroundColor",o)},fgColor:o=>{e("fgColor","color",o)},textColor:o=>{e("textColor","color",o)},borderColor:o=>{e("borderColor","borderColor",o)},strokeColor:o=>{e("strokeColor","borderColor",o)},rotation:o=>{const b=o.detail.rotation;this.setRotation(b),this.annotationStorage.setValue(this.data.id,{rotation:b})}})}_dispatchEventFromSandbox(e,o){const b=this._commonActions;for(const x of Object.keys(o.detail)){const O=e[x]||b[x];O==null||O(o)}}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const o=this.annotationStorage.getRawValue(this.data.id);if(!o)return;const b=this._commonActions;for(const[x,O]of Object.entries(o)){const N=b[x];if(N){const it={detail:{[x]:O},target:e};N(it),delete o[x]}}}_createQuadrilaterals(e=!1){if(!this.data.quadPoints)return null;const o=[],b=this.data.rect;for(const x of this.data.quadPoints)this.data.rect=[x[2].x,x[2].y,x[1].x,x[1].y],o.push(this._createContainer(e));return this.data.rect=b,o}_createPopup(e,o){let b=this.container;this.quadrilaterals&&(e=e||this.quadrilaterals,b=this.quadrilaterals[0]),e||(e=document.createElement("div"),e.classList.add("popupTriggerArea"),b.append(e));const O=new a({container:b,trigger:e,color:o.color,titleObj:o.titleObj,modificationDate:o.modificationDate,contentsObj:o.contentsObj,richText:o.richText,hideWrapper:!0}).render();O.style.left="100%",b.append(O)}_renderQuadrilaterals(e){for(const o of this.quadrilaterals)o.classList.add(e);return this.quadrilaterals}render(){(0,p.unreachable)("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,o=null){const b=[];if(this._fieldObjects){const x=this._fieldObjects[e];if(x)for(const{page:O,id:N,exportValues:it}of x){if(O===-1||N===o)continue;const tt=typeof it=="string"?it:null,rt=document.querySelector(`[data-element-id="${N}"]`);if(rt&&!g.has(rt)){(0,p.warn)(`_getElementsByName - element not allowed: ${N}`);continue}b.push({id:N,exportValue:tt,domElement:rt})}return b}for(const x of document.getElementsByName(e)){const{exportValue:O}=x,N=x.getAttribute("data-element-id");N!==o&&g.has(x)&&b.push({id:N,exportValue:O,domElement:x})}return b}}class d extends y{constructor(o,b=null){super(o,{isRenderable:!0,ignoreBorder:!!(b!=null&&b.ignoreBorder),createQuadrilaterals:!0});Z(this,c);Z(this,v);this.isTooltipOnly=o.data.isTooltipOnly}render(){const{data:o,linkService:b}=this,x=document.createElement("a");x.setAttribute("data-element-id",o.id);let O=!1;return o.url?(b.addLinkAttributes(x,o.url,o.newWindow),O=!0):o.action?(this._bindNamedAction(x,o.action),O=!0):o.attachment?(this._bindAttachment(x,o.attachment),O=!0):o.setOCGState?(lt(this,v,Ze).call(this,x,o.setOCGState),O=!0):o.dest?(this._bindLink(x,o.dest),O=!0):(o.actions&&(o.actions.Action||o.actions["Mouse Up"]||o.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(x,o),O=!0),o.resetForm?(this._bindResetFormAction(x,o.resetForm),O=!0):this.isTooltipOnly&&!O&&(this._bindLink(x,""),O=!0)),this.quadrilaterals?this._renderQuadrilaterals("linkAnnotation").map((N,it)=>{const tt=it===0?x:x.cloneNode();return N.append(tt),N}):(this.container.classList.add("linkAnnotation"),O&&this.container.append(x),this.container)}_bindLink(o,b){o.href=this.linkService.getDestinationHash(b),o.onclick=()=>(b&&this.linkService.goToDestination(b),!1),(b||b==="")&&lt(this,c,Xt).call(this)}_bindNamedAction(o,b){o.href=this.linkService.getAnchorUrl(""),o.onclick=()=>(this.linkService.executeNamedAction(b),!1),lt(this,c,Xt).call(this)}_bindAttachment(o,b){o.href=this.linkService.getAnchorUrl(""),o.onclick=()=>{var x;return(x=this.downloadManager)==null||x.openOrDownloadData(this.container,b.content,b.filename),!1},lt(this,c,Xt).call(this)}_bindJSAction(o,b){o.href=this.linkService.getAnchorUrl("");const x=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const O of Object.keys(b.actions)){const N=x.get(O);N&&(o[N]=()=>{var it;return(it=this.linkService.eventBus)==null||it.dispatch("dispatcheventinsandbox",{source:this,detail:{id:b.id,name:O}}),!1})}o.onclick||(o.onclick=()=>!1),lt(this,c,Xt).call(this)}_bindResetFormAction(o,b){const x=o.onclick;if(x||(o.href=this.linkService.getAnchorUrl("")),lt(this,c,Xt).call(this),!this._fieldObjects){(0,p.warn)('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),x||(o.onclick=()=>!1);return}o.onclick=()=>{var ut;x==null||x();const{fields:O,refs:N,include:it}=b,tt=[];if(O.length!==0||N.length!==0){const ct=new Set(N);for(const mt of O){const gt=this._fieldObjects[mt]||[];for(const{id:Et}of gt)ct.add(Et)}for(const mt of Object.values(this._fieldObjects))for(const gt of mt)ct.has(gt.id)===it&&tt.push(gt)}else for(const ct of Object.values(this._fieldObjects))tt.push(...ct);const rt=this.annotationStorage,at=[];for(const ct of tt){const{id:mt}=ct;switch(at.push(mt),ct.type){case"text":{const Et=ct.defaultValue||"";rt.setValue(mt,{value:Et});break}case"checkbox":case"radiobutton":{const Et=ct.defaultValue===ct.exportValues;rt.setValue(mt,{value:Et});break}case"combobox":case"listbox":{const Et=ct.defaultValue||"";rt.setValue(mt,{value:Et});break}default:continue}const gt=document.querySelector(`[data-element-id="${mt}"]`);if(gt){if(!g.has(gt)){(0,p.warn)(`_bindResetFormAction - element not allowed: ${mt}`);continue}}else continue;gt.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((ut=this.linkService.eventBus)==null||ut.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:at,name:"ResetForm"}})),!1}}}c=new WeakSet,Xt=function(){this.container.setAttribute("data-internal-link","")},v=new WeakSet,Ze=function(o,b){o.href=this.linkService.getAnchorUrl(""),o.onclick=()=>(this.linkService.executeSetOCGState(b),!1),lt(this,c,Xt).call(this)};class _ extends y{constructor(e){var b,x,O;const o=!!(e.data.hasPopup||(b=e.data.titleObj)!=null&&b.str||(x=e.data.contentsObj)!=null&&x.str||(O=e.data.richText)!=null&&O.str);super(e,{isRenderable:o})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.alt="[{{type}} Annotation]",e.dataset.l10nId="text_annotation_type",e.dataset.l10nArgs=JSON.stringify({type:this.data.name}),this.data.hasPopup||this._createPopup(e,this.data),this.container.append(e),this.container}}class s extends y{render(){return this.data.alternativeText&&(this.container.title=this.data.alternativeText),this.container}_getKeyModifier(e){const{isWin:o,isMac:b}=p.FeatureTest.platform;return o&&e.ctrlKey||b&&e.metaKey}_setEventListener(e,o,b,x){o.includes("mouse")?e.addEventListener(o,O=>{var N;(N=this.linkService.eventBus)==null||N.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:b,value:x(O),shift:O.shiftKey,modifier:this._getKeyModifier(O)}})}):e.addEventListener(o,O=>{var N;(N=this.linkService.eventBus)==null||N.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:b,value:x(O)}})})}_setEventListeners(e,o,b){var x;for(const[O,N]of o)(N==="Action"||(x=this.data.actions)!=null&&x[N])&&this._setEventListener(e,O,N,b)}_setBackgroundColor(e){const o=this.data.backgroundColor||null;e.style.backgroundColor=o===null?"transparent":p.Util.makeHexColor(o[0],o[1],o[2])}_setTextStyle(e){const o=["left","center","right"],{fontColor:b}=this.data.defaultAppearanceData,x=this.data.defaultAppearanceData.fontSize||S,O=e.style;let N;const it=2,tt=rt=>Math.round(10*rt)/10;if(this.data.multiLine){const rt=Math.abs(this.data.rect[3]-this.data.rect[1]-it),at=Math.round(rt/(p.LINE_FACTOR*x))||1,ut=rt/at;N=Math.min(x,tt(ut/p.LINE_FACTOR))}else{const rt=Math.abs(this.data.rect[3]-this.data.rect[1]-it);N=Math.min(x,tt(rt/p.LINE_FACTOR))}O.fontSize=`calc(${N}px * var(--scale-factor))`,O.color=p.Util.makeHexColor(b[0],b[1],b[2]),this.data.textAlignment!==null&&(O.textAlign=o[this.data.textAlignment])}_setRequired(e,o){o?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",o)}}class r extends s{constructor(e){const o=e.renderForms||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:o})}setPropertyOnSiblings(e,o,b,x){const O=this.annotationStorage;for(const N of this._getElementsByName(e.name,e.id))N.domElement&&(N.domElement[o]=b),O.setValue(N.id,{[x]:b})}render(){var x;const e=this.annotationStorage,o=this.data.id;this.container.classList.add("textWidgetAnnotation");let b=null;if(this.renderForms){const O=e.getValue(o,{value:this.data.fieldValue});let N=O.formattedValue||O.value||"";const it=e.getValue(o,{charLimit:this.data.maxLen}).charLimit;it&&N.length>it&&(N=N.slice(0,it));const tt={userValue:N,formattedValue:null,lastCommittedValue:null,commitKey:1};this.data.multiLine?(b=document.createElement("textarea"),b.textContent=N,this.data.doNotScroll&&(b.style.overflowY="hidden")):(b=document.createElement("input"),b.type="text",b.setAttribute("value",N),this.data.doNotScroll&&(b.style.overflowX="hidden")),g.add(b),b.setAttribute("data-element-id",o),b.disabled=this.data.readOnly,b.name=this.data.fieldName,b.tabIndex=I,this._setRequired(b,this.data.required),it&&(b.maxLength=it),b.addEventListener("input",at=>{e.setValue(o,{value:at.target.value}),this.setPropertyOnSiblings(b,"value",at.target.value,"value")}),b.addEventListener("resetform",at=>{const ut=this.data.defaultFieldValue??"";b.value=tt.userValue=ut,tt.formattedValue=null});let rt=at=>{const{formattedValue:ut}=tt;ut!=null&&(at.target.value=ut),at.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){b.addEventListener("focus",ut=>{const{target:ct}=ut;tt.userValue&&(ct.value=tt.userValue),tt.lastCommittedValue=ct.value,tt.commitKey=1}),b.addEventListener("updatefromsandbox",ut=>{const ct={value(mt){tt.userValue=mt.detail.value??"",e.setValue(o,{value:tt.userValue.toString()}),mt.target.value=tt.userValue},formattedValue(mt){const{formattedValue:gt}=mt.detail;tt.formattedValue=gt,gt!=null&&mt.target!==document.activeElement&&(mt.target.value=gt),e.setValue(o,{formattedValue:gt})},selRange(mt){mt.target.setSelectionRange(...mt.detail.selRange)},charLimit:mt=>{var Pt;const{charLimit:gt}=mt.detail,{target:Et}=mt;if(gt===0){Et.removeAttribute("maxLength");return}Et.setAttribute("maxLength",gt);let At=tt.userValue;!At||At.length<=gt||(At=At.slice(0,gt),Et.value=tt.userValue=At,e.setValue(o,{value:At}),(Pt=this.linkService.eventBus)==null||Pt.dispatch("dispatcheventinsandbox",{source:this,detail:{id:o,name:"Keystroke",value:At,willCommit:!0,commitKey:1,selStart:Et.selectionStart,selEnd:Et.selectionEnd}}))}};this._dispatchEventFromSandbox(ct,ut)}),b.addEventListener("keydown",ut=>{var gt;tt.commitKey=1;let ct=-1;if(ut.key==="Escape"?ct=0:ut.key==="Enter"&&!this.data.multiLine?ct=2:ut.key==="Tab"&&(tt.commitKey=3),ct===-1)return;const{value:mt}=ut.target;tt.lastCommittedValue!==mt&&(tt.lastCommittedValue=mt,tt.userValue=mt,(gt=this.linkService.eventBus)==null||gt.dispatch("dispatcheventinsandbox",{source:this,detail:{id:o,name:"Keystroke",value:mt,willCommit:!0,commitKey:ct,selStart:ut.target.selectionStart,selEnd:ut.target.selectionEnd}}))});const at=rt;rt=null,b.addEventListener("blur",ut=>{var mt;if(!ut.relatedTarget)return;const{value:ct}=ut.target;tt.userValue=ct,tt.lastCommittedValue!==ct&&((mt=this.linkService.eventBus)==null||mt.dispatch("dispatcheventinsandbox",{source:this,detail:{id:o,name:"Keystroke",value:ct,willCommit:!0,commitKey:tt.commitKey,selStart:ut.target.selectionStart,selEnd:ut.target.selectionEnd}})),at(ut)}),(x=this.data.actions)!=null&&x.Keystroke&&b.addEventListener("beforeinput",ut=>{var B;tt.lastCommittedValue=null;const{data:ct,target:mt}=ut,{value:gt,selectionStart:Et,selectionEnd:At}=mt;let Pt=Et,F=At;switch(ut.inputType){case"deleteWordBackward":{const W=gt.substring(0,Et).match(/\w*[^\w]*$/);W&&(Pt-=W[0].length);break}case"deleteWordForward":{const W=gt.substring(Et).match(/^[^\w]*\w*/);W&&(F+=W[0].length);break}case"deleteContentBackward":Et===At&&(Pt-=1);break;case"deleteContentForward":Et===At&&(F+=1);break}ut.preventDefault(),(B=this.linkService.eventBus)==null||B.dispatch("dispatcheventinsandbox",{source:this,detail:{id:o,name:"Keystroke",value:gt,change:ct||"",willCommit:!1,selStart:Pt,selEnd:F}})}),this._setEventListeners(b,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],ut=>ut.target.value)}if(rt&&b.addEventListener("blur",rt),this.data.comb){const ut=(this.data.rect[2]-this.data.rect[0])/it;b.classList.add("comb"),b.style.letterSpacing=`calc(${ut}px * var(--scale-factor) - 1ch)`}}else b=document.createElement("div"),b.textContent=this.data.fieldValue,b.style.verticalAlign="middle",b.style.display="table-cell";return this._setTextStyle(b),this._setBackgroundColor(b),this._setDefaultPropertiesFromJS(b),this.container.append(b),this.container}}class P extends s{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,o=this.data,b=o.id;let x=e.getValue(b,{value:o.exportValue===o.fieldValue}).value;typeof x=="string"&&(x=x!=="Off",e.setValue(b,{value:x})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const O=document.createElement("input");return g.add(O),O.setAttribute("data-element-id",b),O.disabled=o.readOnly,this._setRequired(O,this.data.required),O.type="checkbox",O.name=o.fieldName,x&&O.setAttribute("checked",!0),O.setAttribute("exportValue",o.exportValue),O.tabIndex=I,O.addEventListener("change",N=>{const{name:it,checked:tt}=N.target;for(const rt of this._getElementsByName(it,b)){const at=tt&&rt.exportValue===o.exportValue;rt.domElement&&(rt.domElement.checked=at),e.setValue(rt.id,{value:at})}e.setValue(b,{value:tt})}),O.addEventListener("resetform",N=>{const it=o.defaultFieldValue||"Off";N.target.checked=it===o.exportValue}),this.enableScripting&&this.hasJSActions&&(O.addEventListener("updatefromsandbox",N=>{const it={value(tt){tt.target.checked=tt.detail.value!=="Off",e.setValue(b,{value:tt.target.checked})}};this._dispatchEventFromSandbox(it,N)}),this._setEventListeners(O,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],N=>N.target.checked)),this._setBackgroundColor(O),this._setDefaultPropertiesFromJS(O),this.container.append(O),this.container}}class R extends s{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,o=this.data,b=o.id;let x=e.getValue(b,{value:o.fieldValue===o.buttonValue}).value;typeof x=="string"&&(x=x!==o.buttonValue,e.setValue(b,{value:x}));const O=document.createElement("input");if(g.add(O),O.setAttribute("data-element-id",b),O.disabled=o.readOnly,this._setRequired(O,this.data.required),O.type="radio",O.name=o.fieldName,x&&O.setAttribute("checked",!0),O.tabIndex=I,O.addEventListener("change",N=>{const{name:it,checked:tt}=N.target;for(const rt of this._getElementsByName(it,b))e.setValue(rt.id,{value:!1});e.setValue(b,{value:tt})}),O.addEventListener("resetform",N=>{const it=o.defaultFieldValue;N.target.checked=it!=null&&it===o.buttonValue}),this.enableScripting&&this.hasJSActions){const N=o.buttonValue;O.addEventListener("updatefromsandbox",it=>{const tt={value:rt=>{const at=N===rt.detail.value;for(const ut of this._getElementsByName(rt.target.name)){const ct=at&&ut.id===b;ut.domElement&&(ut.domElement.checked=ct),e.setValue(ut.id,{value:ct})}}};this._dispatchEventFromSandbox(tt,it)}),this._setEventListeners(O,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],it=>it.target.checked)}return this._setBackgroundColor(O),this._setDefaultPropertiesFromJS(O),this.container.append(O),this.container}}class A extends d{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton"),this.data.alternativeText&&(e.title=this.data.alternativeText);const o=e.lastChild;return this.enableScripting&&this.hasJSActions&&o&&(this._setDefaultPropertiesFromJS(o),o.addEventListener("updatefromsandbox",b=>{this._dispatchEventFromSandbox({},b)})),e}}class t extends s{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,o=this.data.id,b=e.getValue(o,{value:this.data.fieldValue}),x=document.createElement("select");g.add(x),x.setAttribute("data-element-id",o),x.disabled=this.data.readOnly,this._setRequired(x,this.data.required),x.name=this.data.fieldName,x.tabIndex=I;let O=this.data.combo&&this.data.options.length>0;this.data.combo||(x.size=this.data.options.length,this.data.multiSelect&&(x.multiple=!0)),x.addEventListener("resetform",at=>{const ut=this.data.defaultFieldValue;for(const ct of x.options)ct.selected=ct.value===ut});for(const at of this.data.options){const ut=document.createElement("option");ut.textContent=at.displayValue,ut.value=at.exportValue,b.value.includes(at.exportValue)&&(ut.setAttribute("selected",!0),O=!1),x.append(ut)}let N=null;if(O){const at=document.createElement("option");at.value=" ",at.setAttribute("hidden",!0),at.setAttribute("selected",!0),x.prepend(at),N=()=>{at.remove(),x.removeEventListener("input",N),N=null},x.addEventListener("input",N)}const it=at=>{const ut=at?"value":"textContent",{options:ct,multiple:mt}=x;return mt?Array.prototype.filter.call(ct,gt=>gt.selected).map(gt=>gt[ut]):ct.selectedIndex===-1?null:ct[ct.selectedIndex][ut]};let tt=it(!1);const rt=at=>{const ut=at.target.options;return Array.prototype.map.call(ut,ct=>({displayValue:ct.textContent,exportValue:ct.value}))};return this.enableScripting&&this.hasJSActions?(x.addEventListener("updatefromsandbox",at=>{const ut={value(ct){N==null||N();const mt=ct.detail.value,gt=new Set(Array.isArray(mt)?mt:[mt]);for(const Et of x.options)Et.selected=gt.has(Et.value);e.setValue(o,{value:it(!0)}),tt=it(!1)},multipleSelection(ct){x.multiple=!0},remove(ct){const mt=x.options,gt=ct.detail.remove;mt[gt].selected=!1,x.remove(gt),mt.length>0&&Array.prototype.findIndex.call(mt,At=>At.selected)===-1&&(mt[0].selected=!0),e.setValue(o,{value:it(!0),items:rt(ct)}),tt=it(!1)},clear(ct){for(;x.length!==0;)x.remove(0);e.setValue(o,{value:null,items:[]}),tt=it(!1)},insert(ct){const{index:mt,displayValue:gt,exportValue:Et}=ct.detail.insert,At=x.children[mt],Pt=document.createElement("option");Pt.textContent=gt,Pt.value=Et,At?At.before(Pt):x.append(Pt),e.setValue(o,{value:it(!0),items:rt(ct)}),tt=it(!1)},items(ct){const{items:mt}=ct.detail;for(;x.length!==0;)x.remove(0);for(const gt of mt){const{displayValue:Et,exportValue:At}=gt,Pt=document.createElement("option");Pt.textContent=Et,Pt.value=At,x.append(Pt)}x.options.length>0&&(x.options[0].selected=!0),e.setValue(o,{value:it(!0),items:rt(ct)}),tt=it(!1)},indices(ct){const mt=new Set(ct.detail.indices);for(const gt of ct.target.options)gt.selected=mt.has(gt.index);e.setValue(o,{value:it(!0)}),tt=it(!1)},editable(ct){ct.target.disabled=!ct.detail.editable}};this._dispatchEventFromSandbox(ut,at)}),x.addEventListener("input",at=>{var ct;const ut=it(!0);e.setValue(o,{value:ut}),at.preventDefault(),(ct=this.linkService.eventBus)==null||ct.dispatch("dispatcheventinsandbox",{source:this,detail:{id:o,name:"Keystroke",value:tt,changeEx:ut,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(x,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],at=>at.target.value)):x.addEventListener("input",function(at){e.setValue(o,{value:it(!0)})}),this.data.combo&&this._setTextStyle(x),this._setBackgroundColor(x),this._setDefaultPropertiesFromJS(x),this.container.append(x),this.container}}const D=class extends y{constructor(e){var x,O,N;const{data:o}=e,b=!D.IGNORE_TYPES.has(o.parentType)&&!!((x=o.titleObj)!=null&&x.str||(O=o.contentsObj)!=null&&O.str||(N=o.richText)!=null&&N.str);super(e,{isRenderable:b})}render(){this.container.classList.add("popupAnnotation");const e=this.layer.querySelectorAll(`[data-annotation-id="${this.data.parentId}"]`);if(e.length===0)return this.container;const o=new a({container:this.container,trigger:Array.from(e),color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText}),b=this.page,x=p.Util.normalizeRect([this.data.parentRect[0],b.view[3]-this.data.parentRect[1]+b.view[1],this.data.parentRect[2],b.view[3]-this.data.parentRect[3]+b.view[1]]),O=x[0]+this.data.parentRect[2]-this.data.parentRect[0],N=x[1],{pageWidth:it,pageHeight:tt,pageX:rt,pageY:at}=this.viewport.rawDims;return this.container.style.left=`${100*(O-rt)/it}%`,this.container.style.top=`${100*(N-at)/tt}%`,this.container.append(o.render()),this.container}};let l=D;Dt(l,"IGNORE_TYPES",new Set(["Line","Square","Circle","PolyLine","Polygon","Ink"]));class a{constructor(e){this.container=e.container,this.trigger=e.trigger,this.color=e.color,this.titleObj=e.titleObj,this.modificationDate=e.modificationDate,this.contentsObj=e.contentsObj,this.richText=e.richText,this.hideWrapper=e.hideWrapper||!1,this.pinned=!1}render(){var it,tt;const o=document.createElement("div");o.classList.add("popupWrapper"),this.hideElement=this.hideWrapper?o:this.container,this.hideElement.hidden=!0;const b=document.createElement("div");b.classList.add("popup");const x=this.color;if(x){const rt=.7*(255-x[0])+x[0],at=.7*(255-x[1])+x[1],ut=.7*(255-x[2])+x[2];b.style.backgroundColor=p.Util.makeHexColor(rt|0,at|0,ut|0)}const O=document.createElement("h1");O.dir=this.titleObj.dir,O.textContent=this.titleObj.str,b.append(O);const N=T.PDFDateString.toDateObject(this.modificationDate);if(N){const rt=document.createElement("span");rt.classList.add("popupDate"),rt.textContent="{{date}}, {{time}}",rt.dataset.l10nId="annotation_date_string",rt.dataset.l10nArgs=JSON.stringify({date:N.toLocaleDateString(),time:N.toLocaleTimeString()}),b.append(rt)}if((it=this.richText)!=null&&it.str&&(!((tt=this.contentsObj)!=null&&tt.str)||this.contentsObj.str===this.richText.str))et.XfaLayer.render({xfaHtml:this.richText.html,intent:"richText",div:b}),b.lastChild.classList.add("richText","popupContent");else{const rt=this._formatContents(this.contentsObj);b.append(rt)}Array.isArray(this.trigger)||(this.trigger=[this.trigger]);for(const rt of this.trigger)rt.addEventListener("click",this._toggle.bind(this)),rt.addEventListener("mouseover",this._show.bind(this,!1)),rt.addEventListener("mouseout",this._hide.bind(this,!1));return b.addEventListener("click",this._hide.bind(this,!0)),o.append(b),o}_formatContents({str:e,dir:o}){const b=document.createElement("p");b.classList.add("popupContent"),b.dir=o;const x=e.split(/(?:\r\n?|\n)/);for(let O=0,N=x.length;O<N;++O){const it=x[O];b.append(document.createTextNode(it)),O<N-1&&b.append(document.createElement("br"))}return b}_toggle(){this.pinned?this._hide(!0):this._show(!0)}_show(e=!1){e&&(this.pinned=!0),this.hideElement.hidden&&(this.hideElement.hidden=!1,this.container.style.zIndex=parseInt(this.container.style.zIndex)+1e3)}_hide(e=!0){e&&(this.pinned=!1),!this.hideElement.hidden&&!this.pinned&&(this.hideElement.hidden=!0,this.container.style.zIndex=parseInt(this.container.style.zIndex)-1e3)}}class n extends y{constructor(e){var b,x,O;const o=!!(e.data.hasPopup||(b=e.data.titleObj)!=null&&b.str||(x=e.data.contentsObj)!=null&&x.str||(O=e.data.richText)!=null&&O.str);super(e,{isRenderable:o,ignoreBorder:!0}),this.textContent=e.data.textContent}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const o of this.textContent){const b=document.createElement("span");b.textContent=o,e.append(b)}this.container.append(e)}return this.data.hasPopup||this._createPopup(null,this.data),this.container}}class u extends y{constructor(e){var b,x,O;const o=!!(e.data.hasPopup||(b=e.data.titleObj)!=null&&b.str||(x=e.data.contentsObj)!=null&&x.str||(O=e.data.richText)!=null&&O.str);super(e,{isRenderable:o,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const e=this.data,{width:o,height:b}=w(e.rect),x=this.svgFactory.create(o,b,!0),O=this.svgFactory.createElement("svg:line");return O.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),O.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),O.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),O.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),O.setAttribute("stroke-width",e.borderStyle.width||1),O.setAttribute("stroke","transparent"),O.setAttribute("fill","transparent"),x.append(O),this.container.append(x),this._createPopup(O,e),this.container}}class E extends y{constructor(e){var b,x,O;const o=!!(e.data.hasPopup||(b=e.data.titleObj)!=null&&b.str||(x=e.data.contentsObj)!=null&&x.str||(O=e.data.richText)!=null&&O.str);super(e,{isRenderable:o,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const e=this.data,{width:o,height:b}=w(e.rect),x=this.svgFactory.create(o,b,!0),O=e.borderStyle.width,N=this.svgFactory.createElement("svg:rect");return N.setAttribute("x",O/2),N.setAttribute("y",O/2),N.setAttribute("width",o-O),N.setAttribute("height",b-O),N.setAttribute("stroke-width",O||1),N.setAttribute("stroke","transparent"),N.setAttribute("fill","transparent"),x.append(N),this.container.append(x),this._createPopup(N,e),this.container}}class i extends y{constructor(e){var b,x,O;const o=!!(e.data.hasPopup||(b=e.data.titleObj)!=null&&b.str||(x=e.data.contentsObj)!=null&&x.str||(O=e.data.richText)!=null&&O.str);super(e,{isRenderable:o,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const e=this.data,{width:o,height:b}=w(e.rect),x=this.svgFactory.create(o,b,!0),O=e.borderStyle.width,N=this.svgFactory.createElement("svg:ellipse");return N.setAttribute("cx",o/2),N.setAttribute("cy",b/2),N.setAttribute("rx",o/2-O/2),N.setAttribute("ry",b/2-O/2),N.setAttribute("stroke-width",O||1),N.setAttribute("stroke","transparent"),N.setAttribute("fill","transparent"),x.append(N),this.container.append(x),this._createPopup(N,e),this.container}}class M extends y{constructor(e){var b,x,O;const o=!!(e.data.hasPopup||(b=e.data.titleObj)!=null&&b.str||(x=e.data.contentsObj)!=null&&x.str||(O=e.data.richText)!=null&&O.str);super(e,{isRenderable:o,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const e=this.data,{width:o,height:b}=w(e.rect),x=this.svgFactory.create(o,b,!0);let O=[];for(const it of e.vertices){const tt=it.x-e.rect[0],rt=e.rect[3]-it.y;O.push(tt+","+rt)}O=O.join(" ");const N=this.svgFactory.createElement(this.svgElementName);return N.setAttribute("points",O),N.setAttribute("stroke-width",e.borderStyle.width||1),N.setAttribute("stroke","transparent"),N.setAttribute("fill","transparent"),x.append(N),this.container.append(x),this._createPopup(N,e),this.container}}class V extends M{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Y extends y{constructor(e){var b,x,O;const o=!!(e.data.hasPopup||(b=e.data.titleObj)!=null&&b.str||(x=e.data.contentsObj)!=null&&x.str||(O=e.data.richText)!=null&&O.str);super(e,{isRenderable:o,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),this.data.hasPopup||this._createPopup(null,this.data),this.container}}class Q extends y{constructor(e){var b,x,O;const o=!!(e.data.hasPopup||(b=e.data.titleObj)!=null&&b.str||(x=e.data.contentsObj)!=null&&x.str||(O=e.data.richText)!=null&&O.str);super(e,{isRenderable:o,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const e=this.data,{width:o,height:b}=w(e.rect),x=this.svgFactory.create(o,b,!0);for(const O of e.inkLists){let N=[];for(const tt of O){const rt=tt.x-e.rect[0],at=e.rect[3]-tt.y;N.push(`${rt},${at}`)}N=N.join(" ");const it=this.svgFactory.createElement(this.svgElementName);it.setAttribute("points",N),it.setAttribute("stroke-width",e.borderStyle.width||1),it.setAttribute("stroke","transparent"),it.setAttribute("fill","transparent"),this._createPopup(it,e),x.append(it)}return this.container.append(x),this.container}}class st extends y{constructor(e){var b,x,O;const o=!!(e.data.hasPopup||(b=e.data.titleObj)!=null&&b.str||(x=e.data.contentsObj)!=null&&x.str||(O=e.data.richText)!=null&&O.str);super(e,{isRenderable:o,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("highlightAnnotation"):(this.container.classList.add("highlightAnnotation"),this.container)}}class ft extends y{constructor(e){var b,x,O;const o=!!(e.data.hasPopup||(b=e.data.titleObj)!=null&&b.str||(x=e.data.contentsObj)!=null&&x.str||(O=e.data.richText)!=null&&O.str);super(e,{isRenderable:o,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("underlineAnnotation"):(this.container.classList.add("underlineAnnotation"),this.container)}}class nt extends y{constructor(e){var b,x,O;const o=!!(e.data.hasPopup||(b=e.data.titleObj)!=null&&b.str||(x=e.data.contentsObj)!=null&&x.str||(O=e.data.richText)!=null&&O.str);super(e,{isRenderable:o,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("squigglyAnnotation"):(this.container.classList.add("squigglyAnnotation"),this.container)}}class dt extends y{constructor(e){var b,x,O;const o=!!(e.data.hasPopup||(b=e.data.titleObj)!=null&&b.str||(x=e.data.contentsObj)!=null&&x.str||(O=e.data.richText)!=null&&O.str);super(e,{isRenderable:o,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return this.data.hasPopup||this._createPopup(null,this.data),this.quadrilaterals?this._renderQuadrilaterals("strikeoutAnnotation"):(this.container.classList.add("strikeoutAnnotation"),this.container)}}class bt extends y{constructor(e){var b,x,O;const o=!!(e.data.hasPopup||(b=e.data.titleObj)!=null&&b.str||(x=e.data.contentsObj)!=null&&x.str||(O=e.data.richText)!=null&&O.str);super(e,{isRenderable:o,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),this.data.hasPopup||this._createPopup(null,this.data),this.container}}class yt extends y{constructor(e){var x;super(e,{isRenderable:!0});const{filename:o,content:b}=this.data.file;this.filename=(0,T.getFilenameFromUrl)(o,!0),this.content=b,(x=this.linkService.eventBus)==null||x.dispatch("fileattachmentannotation",{source:this,filename:o,content:b})}render(){var o,b;this.container.classList.add("fileAttachmentAnnotation");let e;return this.data.hasAppearance?e=document.createElement("div"):(e=document.createElement("img"),e.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(this.data.name)?"paperclip":"pushpin"}.svg`),e.classList.add("popupTriggerArea"),e.addEventListener("dblclick",this._download.bind(this)),!this.data.hasPopup&&((o=this.data.titleObj)!=null&&o.str||(b=this.data.contentsObj)!=null&&b.str||this.data.richText)&&this._createPopup(e,this.data),this.container.append(e),this.container}_download(){var e;(e=this.downloadManager)==null||e.openOrDownloadData(this.container,this.content,this.filename)}}const L=class{static render(e){var tt,rt;const{annotations:o,div:b,viewport:x,accessibilityManager:O}=e;(0,T.setLayerDimensions)(b,x);const N={data:null,layer:b,page:e.page,viewport:x,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new T.DOMSVGFactory,annotationStorage:e.annotationStorage||new $.AnnotationStorage,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects};let it=0;for(const at of o){if(at.noHTML)continue;if(at.annotationType!==p.AnnotationType.POPUP){const{width:mt,height:gt}=w(at.rect);if(mt<=0||gt<=0)continue}N.data=at;const ut=C.create(N);if(!ut.isRenderable)continue;const ct=ut.render();if(at.hidden&&(ct.style.visibility="hidden"),Array.isArray(ct))for(const mt of ct)mt.style.zIndex=it++,lt(tt=L,q,we).call(tt,mt,at.id,b,O);else ct.style.zIndex=it++,ut instanceof l?b.prepend(ct):lt(rt=L,q,we).call(rt,ct,at.id,b,O)}lt(this,K,ke).call(this,b,e.annotationCanvasMap)}static update(e){const{annotationCanvasMap:o,div:b,viewport:x}=e;(0,T.setLayerDimensions)(b,{rotation:x.rotation}),lt(this,K,ke).call(this,b,o),b.hidden=!1}};let U=L;q=new WeakSet,we=function(e,o,b,x){const O=e.firstChild||e;O.id=`${T.AnnotationPrefix}${o}`,b.append(e),x==null||x.moveElementInDOM(b,e,O,!1)},K=new WeakSet,ke=function(e,o){if(o){for(const[b,x]of o){const O=e.querySelector(`[data-annotation-id="${b}"]`);if(!O)continue;const{firstChild:N}=O;N?N.nodeName==="CANVAS"?N.replaceWith(x):N.before(x):O.append(x)}o.clear()}},Z(U,q),Z(U,K),f.AnnotationLayer=U},(ot,f)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.ColorConverters=void 0;function z(T){return Math.floor(Math.max(0,Math.min(1,T))*255).toString(16).padStart(2,"0")}class p{static CMYK_G([$,G,et,I]){return["G",1-Math.min(1,.3*$+.59*et+.11*G+I)]}static G_CMYK([$]){return["CMYK",0,0,0,1-$]}static G_RGB([$]){return["RGB",$,$,$]}static G_HTML([$]){const G=z($);return`#${G}${G}${G}`}static RGB_G([$,G,et]){return["G",.3*$+.59*G+.11*et]}static RGB_HTML([$,G,et]){const I=z($),S=z(G),g=z(et);return`#${I}${S}${g}`}static T_HTML(){return"#00000000"}static CMYK_RGB([$,G,et,I]){return["RGB",1-Math.min(1,$+I),1-Math.min(1,et+I),1-Math.min(1,G+I)]}static CMYK_HTML($){const G=this.CMYK_RGB($).slice(1);return this.RGB_HTML(G)}static RGB_CMYK([$,G,et]){const I=1-$,S=1-G,g=1-et,w=Math.min(I,S,g);return["CMYK",I,S,g,w]}}f.ColorConverters=p},(ot,f,z)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.XfaLayer=void 0;var p=z(19);class T{static setupStorage(G,et,I,S,g){const w=S.getValue(et,{value:null});switch(I.name){case"textarea":if(w.value!==null&&(G.textContent=w.value),g==="print")break;G.addEventListener("input",C=>{S.setValue(et,{value:C.target.value})});break;case"input":if(I.attributes.type==="radio"||I.attributes.type==="checkbox"){if(w.value===I.attributes.xfaOn?G.setAttribute("checked",!0):w.value===I.attributes.xfaOff&&G.removeAttribute("checked"),g==="print")break;G.addEventListener("change",C=>{S.setValue(et,{value:C.target.checked?C.target.getAttribute("xfaOn"):C.target.getAttribute("xfaOff")})})}else{if(w.value!==null&&G.setAttribute("value",w.value),g==="print")break;G.addEventListener("input",C=>{S.setValue(et,{value:C.target.value})})}break;case"select":if(w.value!==null)for(const C of I.children)C.attributes.value===w.value&&(C.attributes.selected=!0);G.addEventListener("input",C=>{const y=C.target.options,d=y.selectedIndex===-1?"":y[y.selectedIndex].value;S.setValue(et,{value:d})});break}}static setAttributes({html:G,element:et,storage:I=null,intent:S,linkService:g}){const{attributes:w}=et,C=G instanceof HTMLAnchorElement;w.type==="radio"&&(w.name=`${w.name}-${S}`);for(const[y,d]of Object.entries(w))if(d!=null)switch(y){case"class":d.length&&G.setAttribute(y,d.join(" "));break;case"dataId":break;case"id":G.setAttribute("data-element-id",d);break;case"style":Object.assign(G.style,d);break;case"textContent":G.textContent=d;break;default:(!C||y!=="href"&&y!=="newWindow")&&G.setAttribute(y,d)}C&&g.addLinkAttributes(G,w.href,w.newWindow),I&&w.dataId&&this.setupStorage(G,w.dataId,et,I)}static render(G){var _;const et=G.annotationStorage,I=G.linkService,S=G.xfaHtml,g=G.intent||"display",w=document.createElement(S.name);S.attributes&&this.setAttributes({html:w,element:S,intent:g,linkService:I});const C=[[S,-1,w]],y=G.div;if(y.append(w),G.viewport){const s=`matrix(${G.viewport.transform.join(",")})`;y.style.transform=s}g!=="richText"&&y.setAttribute("class","xfaLayer xfaFont");const d=[];for(;C.length>0;){const[s,r,P]=C.at(-1);if(r+1===s.children.length){C.pop();continue}const R=s.children[++C.at(-1)[1]];if(R===null)continue;const{name:A}=R;if(A==="#text"){const l=document.createTextNode(R.value);d.push(l),P.append(l);continue}let t;if((_=R==null?void 0:R.attributes)!=null&&_.xmlns?t=document.createElementNS(R.attributes.xmlns,A):t=document.createElement(A),P.append(t),R.attributes&&this.setAttributes({html:t,element:R,storage:et,intent:g,linkService:I}),R.children&&R.children.length>0)C.push([R,-1,t]);else if(R.value){const l=document.createTextNode(R.value);p.XfaText.shouldBuildText(A)&&d.push(l),t.append(l)}}for(const s of y.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))s.setAttribute("readOnly",!0);return{textDivs:d}}static update(G){const et=`matrix(${G.viewport.transform.join(",")})`;G.div.style.transform=et,G.div.hidden=!1}}f.XfaLayer=T},(ot,f,z)=>{Object.defineProperty(f,"__esModule",{value:!0}),f.SVGGraphics=void 0;var p=z(6),T=z(1),$=z(10);let G=class{constructor(){(0,T.unreachable)("Not implemented: SVGGraphics")}};f.SVGGraphics=G;{let _=function(t){let l=[];const a=[];for(const n of t){if(n.fn==="save"){l.push({fnId:92,fn:"group",items:[]}),a.push(l),l=l.at(-1).items;continue}n.fn==="restore"?l=a.pop():l.push(n)}return l},s=function(t){if(Number.isInteger(t))return t.toString();const l=t.toFixed(10);let a=l.length-1;if(l[a]!=="0")return l;do a--;while(l[a]==="0");return l.substring(0,l[a]==="."?a:a+1)},r=function(t){if(t[4]===0&&t[5]===0){if(t[1]===0&&t[2]===0)return t[0]===1&&t[3]===1?"":`scale(${s(t[0])} ${s(t[3])})`;if(t[0]===t[3]&&t[1]===-t[2]){const l=Math.acos(t[0])*180/Math.PI;return`rotate(${s(l)})`}}else if(t[0]===1&&t[1]===0&&t[2]===0&&t[3]===1)return`translate(${s(t[4])} ${s(t[5])})`;return`matrix(${s(t[0])} ${s(t[1])} ${s(t[2])} ${s(t[3])} ${s(t[4])} ${s(t[5])})`};const et={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},I="http://www.w3.org/XML/1998/namespace",S="http://www.w3.org/1999/xlink",g=["butt","round","square"],w=["miter","round","bevel"],C=function(t,l="",a=!1){if(URL.createObjectURL&&typeof Blob<"u"&&!a)return URL.createObjectURL(new Blob([t],{type:l}));const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";let u=`data:${l};base64,`;for(let E=0,i=t.length;E<i;E+=3){const M=t[E]&255,V=t[E+1]&255,Y=t[E+2]&255,Q=M>>2,st=(M&3)<<4|V>>4,ft=E+1<i?(V&15)<<2|Y>>6:64,nt=E+2<i?Y&63:64;u+=n[Q]+n[st]+n[ft]+n[nt]}return u},y=function(){const t=new Uint8Array([137,80,78,71,13,10,26,10]),l=12,a=new Int32Array(256);for(let Y=0;Y<256;Y++){let Q=Y;for(let st=0;st<8;st++)Q&1?Q=3988292384^Q>>1&2147483647:Q=Q>>1&2147483647;a[Y]=Q}function n(Y,Q,st){let ft=-1;for(let nt=Q;nt<st;nt++){const dt=(ft^Y[nt])&255,bt=a[dt];ft=ft>>>8^bt}return ft^-1}function u(Y,Q,st,ft){let nt=ft;const dt=Q.length;st[nt]=dt>>24&255,st[nt+1]=dt>>16&255,st[nt+2]=dt>>8&255,st[nt+3]=dt&255,nt+=4,st[nt]=Y.charCodeAt(0)&255,st[nt+1]=Y.charCodeAt(1)&255,st[nt+2]=Y.charCodeAt(2)&255,st[nt+3]=Y.charCodeAt(3)&255,nt+=4,st.set(Q,nt),nt+=Q.length;const bt=n(st,ft+4,nt);st[nt]=bt>>24&255,st[nt+1]=bt>>16&255,st[nt+2]=bt>>8&255,st[nt+3]=bt&255}function E(Y,Q,st){let ft=1,nt=0;for(let dt=Q;dt<st;++dt)ft=(ft+(Y[dt]&255))%65521,nt=(nt+ft)%65521;return nt<<16|ft}function i(Y){if(!$.isNodeJS)return M(Y);try{let Q;parseInt(process.versions.node)>=8?Q=Y:Q=Buffer.from(Y);const st=require$$5.deflateSync(Q,{level:9});return st instanceof Uint8Array?st:new Uint8Array(st)}catch(Q){(0,T.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+Q)}return M(Y)}function M(Y){let Q=Y.length;const st=65535,ft=Math.ceil(Q/st),nt=new Uint8Array(2+Q+ft*5+4);let dt=0;nt[dt++]=120,nt[dt++]=156;let bt=0;for(;Q>st;)nt[dt++]=0,nt[dt++]=255,nt[dt++]=255,nt[dt++]=0,nt[dt++]=0,nt.set(Y.subarray(bt,bt+st),dt),dt+=st,bt+=st,Q-=st;nt[dt++]=1,nt[dt++]=Q&255,nt[dt++]=Q>>8&255,nt[dt++]=~Q&65535&255,nt[dt++]=(~Q&65535)>>8&255,nt.set(Y.subarray(bt),dt),dt+=Y.length-bt;const yt=E(Y,0,Y.length);return nt[dt++]=yt>>24&255,nt[dt++]=yt>>16&255,nt[dt++]=yt>>8&255,nt[dt++]=yt&255,nt}function V(Y,Q,st,ft){const nt=Y.width,dt=Y.height;let bt,yt,U;const c=Y.data;switch(Q){case T.ImageKind.GRAYSCALE_1BPP:yt=0,bt=1,U=nt+7>>3;break;case T.ImageKind.RGB_24BPP:yt=2,bt=8,U=nt*3;break;case T.ImageKind.RGBA_32BPP:yt=6,bt=8,U=nt*4;break;default:throw new Error("invalid format")}const h=new Uint8Array((1+U)*dt);let v=0,j=0;for(let L=0;L<dt;++L)h[v++]=0,h.set(c.subarray(j,j+U),v),j+=U,v+=U;if(Q===T.ImageKind.GRAYSCALE_1BPP&&ft){v=0;for(let L=0;L<dt;L++){v++;for(let k=0;k<U;k++)h[v++]^=255}}const D=new Uint8Array([nt>>24&255,nt>>16&255,nt>>8&255,nt&255,dt>>24&255,dt>>16&255,dt>>8&255,dt&255,bt,yt,0,0,0]),q=i(h),H=t.length+l*3+D.length+q.length,K=new Uint8Array(H);let X=0;return K.set(t,X),X+=t.length,u("IHDR",D,K,X),X+=l+D.length,u("IDATA",q,K,X),X+=l+q.length,u("IEND",new Uint8Array(0),K,X),C(K,"image/png",st)}return function(Q,st,ft){const nt=Q.kind===void 0?T.ImageKind.GRAYSCALE_1BPP:Q.kind;return V(Q,nt,st,ft)}}();class d{constructor(){this.fontSizeScale=1,this.fontWeight=et.fontWeight,this.fontSize=0,this.textMatrix=T.IDENTITY_MATRIX,this.fontMatrix=T.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=T.TextRenderingMode.FILL,this.textMatrixScale=1,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=et.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}clone(){return Object.create(this)}setCurrentPoint(l,a){this.x=l,this.y=a}}let P=0,R=0,A=0;f.SVGGraphics=G=class{constructor(t,l,a=!1){(0,p.deprecated)("The SVG back-end is no longer maintained and *may* be removed in the future."),this.svgFactory=new p.DOMSVGFactory,this.current=new d,this.transformMatrix=T.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=t,this.objs=l,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!a,this._operatorIdMapping=[];for(const n in T.OPS)this._operatorIdMapping[T.OPS[n]]=n}getObject(t,l=null){return typeof t=="string"?t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t):l}save(){this.transformStack.push(this.transformMatrix);const t=this.current;this.extraStack.push(t),this.current=t.clone()}restore(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null}group(t){this.save(),this.executeOpTree(t),this.restore()}loadDependencies(t){const l=t.fnArray,a=t.argsArray;for(let n=0,u=l.length;n<u;n++)if(l[n]===T.OPS.dependency)for(const E of a[n]){const i=E.startsWith("g_")?this.commonObjs:this.objs,M=new Promise(V=>{i.get(E,V)});this.current.dependencies.push(M)}return Promise.all(this.current.dependencies)}transform(t,l,a,n,u,E){const i=[t,l,a,n,u,E];this.transformMatrix=T.Util.transform(this.transformMatrix,i),this.tgrp=null}getSVG(t,l){this.viewport=l;const a=this._initialize(l);return this.loadDependencies(t).then(()=>(this.transformMatrix=T.IDENTITY_MATRIX,this.executeOpTree(this.convertOpList(t)),a))}convertOpList(t){const l=this._operatorIdMapping,a=t.argsArray,n=t.fnArray,u=[];for(let E=0,i=n.length;E<i;E++){const M=n[E];u.push({fnId:M,fn:l[M],args:a[E]})}return _(u)}executeOpTree(t){for(const l of t){const a=l.fn,n=l.fnId,u=l.args;switch(n|0){case T.OPS.beginText:this.beginText();break;case T.OPS.dependency:break;case T.OPS.setLeading:this.setLeading(u);break;case T.OPS.setLeadingMoveText:this.setLeadingMoveText(u[0],u[1]);break;case T.OPS.setFont:this.setFont(u);break;case T.OPS.showText:this.showText(u[0]);break;case T.OPS.showSpacedText:this.showText(u[0]);break;case T.OPS.endText:this.endText();break;case T.OPS.moveText:this.moveText(u[0],u[1]);break;case T.OPS.setCharSpacing:this.setCharSpacing(u[0]);break;case T.OPS.setWordSpacing:this.setWordSpacing(u[0]);break;case T.OPS.setHScale:this.setHScale(u[0]);break;case T.OPS.setTextMatrix:this.setTextMatrix(u[0],u[1],u[2],u[3],u[4],u[5]);break;case T.OPS.setTextRise:this.setTextRise(u[0]);break;case T.OPS.setTextRenderingMode:this.setTextRenderingMode(u[0]);break;case T.OPS.setLineWidth:this.setLineWidth(u[0]);break;case T.OPS.setLineJoin:this.setLineJoin(u[0]);break;case T.OPS.setLineCap:this.setLineCap(u[0]);break;case T.OPS.setMiterLimit:this.setMiterLimit(u[0]);break;case T.OPS.setFillRGBColor:this.setFillRGBColor(u[0],u[1],u[2]);break;case T.OPS.setStrokeRGBColor:this.setStrokeRGBColor(u[0],u[1],u[2]);break;case T.OPS.setStrokeColorN:this.setStrokeColorN(u);break;case T.OPS.setFillColorN:this.setFillColorN(u);break;case T.OPS.shadingFill:this.shadingFill(u[0]);break;case T.OPS.setDash:this.setDash(u[0],u[1]);break;case T.OPS.setRenderingIntent:this.setRenderingIntent(u[0]);break;case T.OPS.setFlatness:this.setFlatness(u[0]);break;case T.OPS.setGState:this.setGState(u[0]);break;case T.OPS.fill:this.fill();break;case T.OPS.eoFill:this.eoFill();break;case T.OPS.stroke:this.stroke();break;case T.OPS.fillStroke:this.fillStroke();break;case T.OPS.eoFillStroke:this.eoFillStroke();break;case T.OPS.clip:this.clip("nonzero");break;case T.OPS.eoClip:this.clip("evenodd");break;case T.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case T.OPS.paintImageXObject:this.paintImageXObject(u[0]);break;case T.OPS.paintInlineImageXObject:this.paintInlineImageXObject(u[0]);break;case T.OPS.paintImageMaskXObject:this.paintImageMaskXObject(u[0]);break;case T.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(u[0],u[1]);break;case T.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case T.OPS.closePath:this.closePath();break;case T.OPS.closeStroke:this.closeStroke();break;case T.OPS.closeFillStroke:this.closeFillStroke();break;case T.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case T.OPS.nextLine:this.nextLine();break;case T.OPS.transform:this.transform(u[0],u[1],u[2],u[3],u[4],u[5]);break;case T.OPS.constructPath:this.constructPath(u[0],u[1]);break;case T.OPS.endPath:this.endPath();break;case 92:this.group(l.items);break;default:(0,T.warn)(`Unimplemented operator ${a}`);break}}}setWordSpacing(t){this.current.wordSpacing=t}setCharSpacing(t){this.current.charSpacing=t}nextLine(){this.moveText(0,this.current.leading)}setTextMatrix(t,l,a,n,u,E){const i=this.current;i.textMatrix=i.lineMatrix=[t,l,a,n,u,E],i.textMatrixScale=Math.hypot(t,l),i.x=i.lineX=0,i.y=i.lineY=0,i.xcoords=[],i.ycoords=[],i.tspan=this.svgFactory.createElement("svg:tspan"),i.tspan.setAttributeNS(null,"font-family",i.fontFamily),i.tspan.setAttributeNS(null,"font-size",`${s(i.fontSize)}px`),i.tspan.setAttributeNS(null,"y",s(-i.y)),i.txtElement=this.svgFactory.createElement("svg:text"),i.txtElement.append(i.tspan)}beginText(){const t=this.current;t.x=t.lineX=0,t.y=t.lineY=0,t.textMatrix=T.IDENTITY_MATRIX,t.lineMatrix=T.IDENTITY_MATRIX,t.textMatrixScale=1,t.tspan=this.svgFactory.createElement("svg:tspan"),t.txtElement=this.svgFactory.createElement("svg:text"),t.txtgrp=this.svgFactory.createElement("svg:g"),t.xcoords=[],t.ycoords=[]}moveText(t,l){const a=this.current;a.x=a.lineX+=t,a.y=a.lineY+=l,a.xcoords=[],a.ycoords=[],a.tspan=this.svgFactory.createElement("svg:tspan"),a.tspan.setAttributeNS(null,"font-family",a.fontFamily),a.tspan.setAttributeNS(null,"font-size",`${s(a.fontSize)}px`),a.tspan.setAttributeNS(null,"y",s(-a.y))}showText(t){const l=this.current,a=l.font,n=l.fontSize;if(n===0)return;const u=l.fontSizeScale,E=l.charSpacing,i=l.wordSpacing,M=l.fontDirection,V=l.textHScale*M,Y=a.vertical,Q=Y?1:-1,st=a.defaultVMetrics,ft=n*l.fontMatrix[0];let nt=0;for(const yt of t){if(yt===null){nt+=M*i;continue}else if(typeof yt=="number"){nt+=Q*yt*n/1e3;continue}const U=(yt.isSpace?i:0)+E,c=yt.fontChar;let h,v,j=yt.width;if(Y){let q;const H=yt.vmetric||st;q=yt.vmetric?H[1]:j*.5,q=-q*ft;const K=H[2]*ft;j=H?-H[0]:j,h=q/u,v=(nt+K)/u}else h=nt/u,v=0;(yt.isInFont||a.missingFile)&&(l.xcoords.push(l.x+h),Y&&l.ycoords.push(-l.y+v),l.tspan.textContent+=c);let D;Y?D=j*ft-U*M:D=j*ft+U*M,nt+=D}l.tspan.setAttributeNS(null,"x",l.xcoords.map(s).join(" ")),Y?l.tspan.setAttributeNS(null,"y",l.ycoords.map(s).join(" ")):l.tspan.setAttributeNS(null,"y",s(-l.y)),Y?l.y-=nt:l.x+=nt*V,l.tspan.setAttributeNS(null,"font-family",l.fontFamily),l.tspan.setAttributeNS(null,"font-size",`${s(l.fontSize)}px`),l.fontStyle!==et.fontStyle&&l.tspan.setAttributeNS(null,"font-style",l.fontStyle),l.fontWeight!==et.fontWeight&&l.tspan.setAttributeNS(null,"font-weight",l.fontWeight);const dt=l.textRenderingMode&T.TextRenderingMode.FILL_STROKE_MASK;if(dt===T.TextRenderingMode.FILL||dt===T.TextRenderingMode.FILL_STROKE?(l.fillColor!==et.fillColor&&l.tspan.setAttributeNS(null,"fill",l.fillColor),l.fillAlpha<1&&l.tspan.setAttributeNS(null,"fill-opacity",l.fillAlpha)):l.textRenderingMode===T.TextRenderingMode.ADD_TO_PATH?l.tspan.setAttributeNS(null,"fill","transparent"):l.tspan.setAttributeNS(null,"fill","none"),dt===T.TextRenderingMode.STROKE||dt===T.TextRenderingMode.FILL_STROKE){const yt=1/(l.textMatrixScale||1);this._setStrokeAttributes(l.tspan,yt)}let bt=l.textMatrix;l.textRise!==0&&(bt=bt.slice(),bt[5]+=l.textRise),l.txtElement.setAttributeNS(null,"transform",`${r(bt)} scale(${s(V)}, -1)`),l.txtElement.setAttributeNS(I,"xml:space","preserve"),l.txtElement.append(l.tspan),l.txtgrp.append(l.txtElement),this._ensureTransformGroup().append(l.txtElement)}setLeadingMoveText(t,l){this.setLeading(-l),this.moveText(t,l)}addFontStyle(t){if(!t.data)throw new Error('addFontStyle: No font data available, ensure that the "fontExtraProperties" API parameter is set.');this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.append(this.cssStyle));const l=C(t.data,t.mimetype,this.forceDataSchema);this.cssStyle.textContent+=`@font-face { font-family: "${t.loadedName}"; src: url(${l}); }
`}setFont(t){const l=this.current,a=this.commonObjs.get(t[0]);let n=t[1];l.font=a,this.embedFonts&&!a.missingFile&&!this.embeddedFonts[a.loadedName]&&(this.addFontStyle(a),this.embeddedFonts[a.loadedName]=a),l.fontMatrix=a.fontMatrix||T.FONT_IDENTITY_MATRIX;let u="normal";a.black?u="900":a.bold&&(u="bold");const E=a.italic?"italic":"normal";n<0?(n=-n,l.fontDirection=-1):l.fontDirection=1,l.fontSize=n,l.fontFamily=a.loadedName,l.fontWeight=u,l.fontStyle=E,l.tspan=this.svgFactory.createElement("svg:tspan"),l.tspan.setAttributeNS(null,"y",s(-l.y)),l.xcoords=[],l.ycoords=[]}endText(){var l;const t=this.current;t.textRenderingMode&T.TextRenderingMode.ADD_TO_PATH_FLAG&&((l=t.txtElement)!=null&&l.hasChildNodes())&&(t.element=t.txtElement,this.clip("nonzero"),this.endPath())}setLineWidth(t){t>0&&(this.current.lineWidth=t)}setLineCap(t){this.current.lineCap=g[t]}setLineJoin(t){this.current.lineJoin=w[t]}setMiterLimit(t){this.current.miterLimit=t}setStrokeAlpha(t){this.current.strokeAlpha=t}setStrokeRGBColor(t,l,a){this.current.strokeColor=T.Util.makeHexColor(t,l,a)}setFillAlpha(t){this.current.fillAlpha=t}setFillRGBColor(t,l,a){this.current.fillColor=T.Util.makeHexColor(t,l,a),this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[],this.current.ycoords=[]}setStrokeColorN(t){this.current.strokeColor=this._makeColorN_Pattern(t)}setFillColorN(t){this.current.fillColor=this._makeColorN_Pattern(t)}shadingFill(t){const l=this.viewport.width,a=this.viewport.height,n=T.Util.inverseTransform(this.transformMatrix),u=T.Util.applyTransform([0,0],n),E=T.Util.applyTransform([0,a],n),i=T.Util.applyTransform([l,0],n),M=T.Util.applyTransform([l,a],n),V=Math.min(u[0],E[0],i[0],M[0]),Y=Math.min(u[1],E[1],i[1],M[1]),Q=Math.max(u[0],E[0],i[0],M[0]),st=Math.max(u[1],E[1],i[1],M[1]),ft=this.svgFactory.createElement("svg:rect");ft.setAttributeNS(null,"x",V),ft.setAttributeNS(null,"y",Y),ft.setAttributeNS(null,"width",Q-V),ft.setAttributeNS(null,"height",st-Y),ft.setAttributeNS(null,"fill",this._makeShadingPattern(t)),this.current.fillAlpha<1&&ft.setAttributeNS(null,"fill-opacity",this.current.fillAlpha),this._ensureTransformGroup().append(ft)}_makeColorN_Pattern(t){return t[0]==="TilingPattern"?this._makeTilingPattern(t):this._makeShadingPattern(t)}_makeTilingPattern(t){const l=t[1],a=t[2],n=t[3]||T.IDENTITY_MATRIX,[u,E,i,M]=t[4],V=t[5],Y=t[6],Q=t[7],st=`shading${A++}`,[ft,nt,dt,bt]=T.Util.normalizeRect([...T.Util.applyTransform([u,E],n),...T.Util.applyTransform([i,M],n)]),[yt,U]=T.Util.singularValueDecompose2dScale(n),c=V*yt,h=Y*U,v=this.svgFactory.createElement("svg:pattern");v.setAttributeNS(null,"id",st),v.setAttributeNS(null,"patternUnits","userSpaceOnUse"),v.setAttributeNS(null,"width",c),v.setAttributeNS(null,"height",h),v.setAttributeNS(null,"x",`${ft}`),v.setAttributeNS(null,"y",`${nt}`);const j=this.svg,D=this.transformMatrix,q=this.current.fillColor,H=this.current.strokeColor,K=this.svgFactory.create(dt-ft,bt-nt);if(this.svg=K,this.transformMatrix=n,Q===2){const X=T.Util.makeHexColor(...l);this.current.fillColor=X,this.current.strokeColor=X}return this.executeOpTree(this.convertOpList(a)),this.svg=j,this.transformMatrix=D,this.current.fillColor=q,this.current.strokeColor=H,v.append(K.childNodes[0]),this.defs.append(v),`url(#${st})`}_makeShadingPattern(t){switch(typeof t=="string"&&(t=this.objs.get(t)),t[0]){case"RadialAxial":const l=`shading${A++}`,a=t[3];let n;switch(t[1]){case"axial":const u=t[4],E=t[5];n=this.svgFactory.createElement("svg:linearGradient"),n.setAttributeNS(null,"id",l),n.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),n.setAttributeNS(null,"x1",u[0]),n.setAttributeNS(null,"y1",u[1]),n.setAttributeNS(null,"x2",E[0]),n.setAttributeNS(null,"y2",E[1]);break;case"radial":const i=t[4],M=t[5],V=t[6],Y=t[7];n=this.svgFactory.createElement("svg:radialGradient"),n.setAttributeNS(null,"id",l),n.setAttributeNS(null,"gradientUnits","userSpaceOnUse"),n.setAttributeNS(null,"cx",M[0]),n.setAttributeNS(null,"cy",M[1]),n.setAttributeNS(null,"r",Y),n.setAttributeNS(null,"fx",i[0]),n.setAttributeNS(null,"fy",i[1]),n.setAttributeNS(null,"fr",V);break;default:throw new Error(`Unknown RadialAxial type: ${t[1]}`)}for(const u of a){const E=this.svgFactory.createElement("svg:stop");E.setAttributeNS(null,"offset",u[0]),E.setAttributeNS(null,"stop-color",u[1]),n.append(E)}return this.defs.append(n),`url(#${l})`;case"Mesh":return(0,T.warn)("Unimplemented pattern Mesh"),null;case"Dummy":return"hotpink";default:throw new Error(`Unknown IR type: ${t[0]}`)}}setDash(t,l){this.current.dashArray=t,this.current.dashPhase=l}constructPath(t,l){const a=this.current;let n=a.x,u=a.y,E=[],i=0;for(const M of t)switch(M|0){case T.OPS.rectangle:n=l[i++],u=l[i++];const V=l[i++],Y=l[i++],Q=n+V,st=u+Y;E.push("M",s(n),s(u),"L",s(Q),s(u),"L",s(Q),s(st),"L",s(n),s(st),"Z");break;case T.OPS.moveTo:n=l[i++],u=l[i++],E.push("M",s(n),s(u));break;case T.OPS.lineTo:n=l[i++],u=l[i++],E.push("L",s(n),s(u));break;case T.OPS.curveTo:n=l[i+4],u=l[i+5],E.push("C",s(l[i]),s(l[i+1]),s(l[i+2]),s(l[i+3]),s(n),s(u)),i+=6;break;case T.OPS.curveTo2:E.push("C",s(n),s(u),s(l[i]),s(l[i+1]),s(l[i+2]),s(l[i+3])),n=l[i+2],u=l[i+3],i+=4;break;case T.OPS.curveTo3:n=l[i+2],u=l[i+3],E.push("C",s(l[i]),s(l[i+1]),s(n),s(u),s(n),s(u)),i+=4;break;case T.OPS.closePath:E.push("Z");break}E=E.join(" "),a.path&&t.length>0&&t[0]!==T.OPS.rectangle&&t[0]!==T.OPS.moveTo?E=a.path.getAttributeNS(null,"d")+E:(a.path=this.svgFactory.createElement("svg:path"),this._ensureTransformGroup().append(a.path)),a.path.setAttributeNS(null,"d",E),a.path.setAttributeNS(null,"fill","none"),a.element=a.path,a.setCurrentPoint(n,u)}endPath(){const t=this.current;if(t.path=null,!this.pendingClip)return;if(!t.element){this.pendingClip=null;return}const l=`clippath${P++}`,a=this.svgFactory.createElement("svg:clipPath");a.setAttributeNS(null,"id",l),a.setAttributeNS(null,"transform",r(this.transformMatrix));const n=t.element.cloneNode(!0);if(this.pendingClip==="evenodd"?n.setAttributeNS(null,"clip-rule","evenodd"):n.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,a.append(n),this.defs.append(a),t.activeClipUrl){t.clipGroup=null;for(const u of this.extraStack)u.clipGroup=null;a.setAttributeNS(null,"clip-path",t.activeClipUrl)}t.activeClipUrl=`url(#${l})`,this.tgrp=null}clip(t){this.pendingClip=t}closePath(){const t=this.current;if(t.path){const l=`${t.path.getAttributeNS(null,"d")}Z`;t.path.setAttributeNS(null,"d",l)}}setLeading(t){this.current.leading=-t}setTextRise(t){this.current.textRise=t}setTextRenderingMode(t){this.current.textRenderingMode=t}setHScale(t){this.current.textHScale=t/100}setRenderingIntent(t){}setFlatness(t){}setGState(t){for(const[l,a]of t)switch(l){case"LW":this.setLineWidth(a);break;case"LC":this.setLineCap(a);break;case"LJ":this.setLineJoin(a);break;case"ML":this.setMiterLimit(a);break;case"D":this.setDash(a[0],a[1]);break;case"RI":this.setRenderingIntent(a);break;case"FL":this.setFlatness(a);break;case"Font":this.setFont(a);break;case"CA":this.setStrokeAlpha(a);break;case"ca":this.setFillAlpha(a);break;default:(0,T.warn)(`Unimplemented graphic state operator ${l}`);break}}fill(){const t=this.current;t.element&&(t.element.setAttributeNS(null,"fill",t.fillColor),t.element.setAttributeNS(null,"fill-opacity",t.fillAlpha),this.endPath())}stroke(){const t=this.current;t.element&&(this._setStrokeAttributes(t.element),t.element.setAttributeNS(null,"fill","none"),this.endPath())}_setStrokeAttributes(t,l=1){const a=this.current;let n=a.dashArray;l!==1&&n.length>0&&(n=n.map(function(u){return l*u})),t.setAttributeNS(null,"stroke",a.strokeColor),t.setAttributeNS(null,"stroke-opacity",a.strokeAlpha),t.setAttributeNS(null,"stroke-miterlimit",s(a.miterLimit)),t.setAttributeNS(null,"stroke-linecap",a.lineCap),t.setAttributeNS(null,"stroke-linejoin",a.lineJoin),t.setAttributeNS(null,"stroke-width",s(l*a.lineWidth)+"px"),t.setAttributeNS(null,"stroke-dasharray",n.map(s).join(" ")),t.setAttributeNS(null,"stroke-dashoffset",s(l*a.dashPhase)+"px")}eoFill(){var t;(t=this.current.element)==null||t.setAttributeNS(null,"fill-rule","evenodd"),this.fill()}fillStroke(){this.stroke(),this.fill()}eoFillStroke(){var t;(t=this.current.element)==null||t.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()}closeStroke(){this.closePath(),this.stroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.closePath(),this.eoFillStroke()}paintSolidColorImageMask(){const t=this.svgFactory.createElement("svg:rect");t.setAttributeNS(null,"x","0"),t.setAttributeNS(null,"y","0"),t.setAttributeNS(null,"width","1px"),t.setAttributeNS(null,"height","1px"),t.setAttributeNS(null,"fill",this.current.fillColor),this._ensureTransformGroup().append(t)}paintImageXObject(t){const l=this.getObject(t);if(!l){(0,T.warn)(`Dependent image with object ID ${t} is not ready yet`);return}this.paintInlineImageXObject(l)}paintInlineImageXObject(t,l){const a=t.width,n=t.height,u=y(t,this.forceDataSchema,!!l),E=this.svgFactory.createElement("svg:rect");E.setAttributeNS(null,"x","0"),E.setAttributeNS(null,"y","0"),E.setAttributeNS(null,"width",s(a)),E.setAttributeNS(null,"height",s(n)),this.current.element=E,this.clip("nonzero");const i=this.svgFactory.createElement("svg:image");i.setAttributeNS(S,"xlink:href",u),i.setAttributeNS(null,"x","0"),i.setAttributeNS(null,"y",s(-n)),i.setAttributeNS(null,"width",s(a)+"px"),i.setAttributeNS(null,"height",s(n)+"px"),i.setAttributeNS(null,"transform",`scale(${s(1/a)} ${s(-1/n)})`),l?l.append(i):this._ensureTransformGroup().append(i)}paintImageMaskXObject(t){const l=this.getObject(t.data,t);if(l.bitmap){(0,T.warn)("paintImageMaskXObject: ImageBitmap support is not implemented, ensure that the `isOffscreenCanvasSupported` API parameter is disabled.");return}const a=this.current,n=l.width,u=l.height,E=a.fillColor;a.maskId=`mask${R++}`;const i=this.svgFactory.createElement("svg:mask");i.setAttributeNS(null,"id",a.maskId);const M=this.svgFactory.createElement("svg:rect");M.setAttributeNS(null,"x","0"),M.setAttributeNS(null,"y","0"),M.setAttributeNS(null,"width",s(n)),M.setAttributeNS(null,"height",s(u)),M.setAttributeNS(null,"fill",E),M.setAttributeNS(null,"mask",`url(#${a.maskId})`),this.defs.append(i),this._ensureTransformGroup().append(M),this.paintInlineImageXObject(l,i)}paintFormXObjectBegin(t,l){if(Array.isArray(t)&&t.length===6&&this.transform(t[0],t[1],t[2],t[3],t[4],t[5]),l){const a=l[2]-l[0],n=l[3]-l[1],u=this.svgFactory.createElement("svg:rect");u.setAttributeNS(null,"x",l[0]),u.setAttributeNS(null,"y",l[1]),u.setAttributeNS(null,"width",s(a)),u.setAttributeNS(null,"height",s(n)),this.current.element=u,this.clip("nonzero"),this.endPath()}}paintFormXObjectEnd(){}_initialize(t){const l=this.svgFactory.create(t.width,t.height),a=this.svgFactory.createElement("svg:defs");l.append(a),this.defs=a;const n=this.svgFactory.createElement("svg:g");return n.setAttributeNS(null,"transform",r(t.transform)),l.append(n),this.svg=n,l}_ensureClipGroup(){if(!this.current.clipGroup){const t=this.svgFactory.createElement("svg:g");t.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.append(t),this.current.clipGroup=t}return this.current.clipGroup}_ensureTransformGroup(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",r(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().append(this.tgrp):this.svg.append(this.tgrp)),this.tgrp}}}}],__webpack_module_cache__={};function __w_pdfjs_require__(ot){var f=__webpack_module_cache__[ot];if(f!==void 0)return f.exports;var z=__webpack_module_cache__[ot]={exports:{}};return __webpack_modules__[ot](z,z.exports,__w_pdfjs_require__),z.exports}var __webpack_exports__={};return(()=>{var ot=__webpack_exports__;Object.defineProperty(ot,"__esModule",{value:!0}),Object.defineProperty(ot,"AbortException",{enumerable:!0,get:function(){return f.AbortException}}),Object.defineProperty(ot,"AnnotationEditorLayer",{enumerable:!0,get:function(){return $.AnnotationEditorLayer}}),Object.defineProperty(ot,"AnnotationEditorParamsType",{enumerable:!0,get:function(){return f.AnnotationEditorParamsType}}),Object.defineProperty(ot,"AnnotationEditorType",{enumerable:!0,get:function(){return f.AnnotationEditorType}}),Object.defineProperty(ot,"AnnotationEditorUIManager",{enumerable:!0,get:function(){return G.AnnotationEditorUIManager}}),Object.defineProperty(ot,"AnnotationLayer",{enumerable:!0,get:function(){return et.AnnotationLayer}}),Object.defineProperty(ot,"AnnotationMode",{enumerable:!0,get:function(){return f.AnnotationMode}}),Object.defineProperty(ot,"CMapCompressionType",{enumerable:!0,get:function(){return f.CMapCompressionType}}),Object.defineProperty(ot,"FeatureTest",{enumerable:!0,get:function(){return f.FeatureTest}}),Object.defineProperty(ot,"GlobalWorkerOptions",{enumerable:!0,get:function(){return I.GlobalWorkerOptions}}),Object.defineProperty(ot,"InvalidPDFException",{enumerable:!0,get:function(){return f.InvalidPDFException}}),Object.defineProperty(ot,"MissingPDFException",{enumerable:!0,get:function(){return f.MissingPDFException}}),Object.defineProperty(ot,"OPS",{enumerable:!0,get:function(){return f.OPS}}),Object.defineProperty(ot,"PDFDataRangeTransport",{enumerable:!0,get:function(){return z.PDFDataRangeTransport}}),Object.defineProperty(ot,"PDFDateString",{enumerable:!0,get:function(){return p.PDFDateString}}),Object.defineProperty(ot,"PDFWorker",{enumerable:!0,get:function(){return z.PDFWorker}}),Object.defineProperty(ot,"PasswordResponses",{enumerable:!0,get:function(){return f.PasswordResponses}}),Object.defineProperty(ot,"PermissionFlag",{enumerable:!0,get:function(){return f.PermissionFlag}}),Object.defineProperty(ot,"PixelsPerInch",{enumerable:!0,get:function(){return p.PixelsPerInch}}),Object.defineProperty(ot,"RenderingCancelledException",{enumerable:!0,get:function(){return p.RenderingCancelledException}}),Object.defineProperty(ot,"SVGGraphics",{enumerable:!0,get:function(){return S.SVGGraphics}}),Object.defineProperty(ot,"UnexpectedResponseException",{enumerable:!0,get:function(){return f.UnexpectedResponseException}}),Object.defineProperty(ot,"Util",{enumerable:!0,get:function(){return f.Util}}),Object.defineProperty(ot,"VerbosityLevel",{enumerable:!0,get:function(){return f.VerbosityLevel}}),Object.defineProperty(ot,"XfaLayer",{enumerable:!0,get:function(){return g.XfaLayer}}),Object.defineProperty(ot,"build",{enumerable:!0,get:function(){return z.build}}),Object.defineProperty(ot,"createPromiseCapability",{enumerable:!0,get:function(){return f.createPromiseCapability}}),Object.defineProperty(ot,"createValidAbsoluteUrl",{enumerable:!0,get:function(){return f.createValidAbsoluteUrl}}),Object.defineProperty(ot,"getDocument",{enumerable:!0,get:function(){return z.getDocument}}),Object.defineProperty(ot,"getFilenameFromUrl",{enumerable:!0,get:function(){return p.getFilenameFromUrl}}),Object.defineProperty(ot,"getPdfFilenameFromUrl",{enumerable:!0,get:function(){return p.getPdfFilenameFromUrl}}),Object.defineProperty(ot,"getXfaPageViewport",{enumerable:!0,get:function(){return p.getXfaPageViewport}}),Object.defineProperty(ot,"isDataScheme",{enumerable:!0,get:function(){return p.isDataScheme}}),Object.defineProperty(ot,"isPdfFile",{enumerable:!0,get:function(){return p.isPdfFile}}),Object.defineProperty(ot,"loadScript",{enumerable:!0,get:function(){return p.loadScript}}),Object.defineProperty(ot,"renderTextLayer",{enumerable:!0,get:function(){return T.renderTextLayer}}),Object.defineProperty(ot,"setLayerDimensions",{enumerable:!0,get:function(){return p.setLayerDimensions}}),Object.defineProperty(ot,"shadow",{enumerable:!0,get:function(){return f.shadow}}),Object.defineProperty(ot,"updateTextLayer",{enumerable:!0,get:function(){return T.updateTextLayer}}),Object.defineProperty(ot,"version",{enumerable:!0,get:function(){return z.version}});var f=__w_pdfjs_require__(1),z=__w_pdfjs_require__(2),p=__w_pdfjs_require__(6),T=__w_pdfjs_require__(26),$=__w_pdfjs_require__(27),G=__w_pdfjs_require__(5),et=__w_pdfjs_require__(32),I=__w_pdfjs_require__(14),S=__w_pdfjs_require__(35),g=__w_pdfjs_require__(34)})(),__webpack_exports__})())})(pdf);var pdfExports=pdf.exports;const PdfViewer_svelte_svelte_type_style_lang="";function create_fragment$1(ot){let f,z;return{c(){f=element("div"),z=element("div"),this.h()},l(p){f=claim_element(p,"DIV",{class:!0});var T=children(f);z=claim_element(T,"DIV",{class:!0,style:!0}),children(z).forEach(detach),T.forEach(detach),this.h()},h(){attr(z,"class","pdf-wrapper svelte-r9i6p1"),set_style(z,"--scale-factor","1.2"),attr(f,"class","pdf-container svelte-r9i6p1")},m(p,T){insert_hydration(p,f,T),append_hydration(f,z),ot[2](z)},p:noop,i:noop,o:noop,d(p){p&&detach(f),ot[2](null)}}}function instance$1(ot,f,z){pdfExports.GlobalWorkerOptions.workerSrc="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.5.141/pdf.worker.min.js";let{url:p=""}=f,T;async function $(I){const S=I.getViewport({scale:1.2}),g=document.createElement("div");g.style.marginBottom="16px",g.style.position="relative",g.id=`page-${I._pageIndex+1}`;const w=document.createElement("canvas"),C=w.getContext("2d");if(!C)return;w.height=S.height,w.width=S.width,g.appendChild(w),T.appendChild(g),I.render({canvasContext:C,viewport:S});const y=document.createElement("div");y.className="textLayer";const d=await I.getTextContent();pdfExports.renderTextLayer({textContentSource:d,viewport:I.getViewport(),container:y}),g.appendChild(y)}let G=!1;onMount(async()=>{const I=await pdfExports.getDocument(p).promise;if(!G)for(let S=1;S<=I.numPages;S++)I.getPage(S).then($)}),onDestroy(()=>{G=!0});function et(I){binding_callbacks[I?"unshift":"push"](()=>{T=I,z(0,T)})}return ot.$$set=I=>{"url"in I&&z(1,p=I.url)},[T,p,et]}class PdfViewer extends SvelteComponent{constructor(f){super(),init(this,f,instance$1,create_fragment$1,safe_not_equal,{url:1})}}function create_if_block_1(ot){let f,z,p,T,$,G,et,I,S,g,w=ot[1].name+"",C,y,d,_,s=ot[1].id+"",r,P,R,A,t,l,a,n,u,E,i,M,V,Y,Q,st,ft;return M=new ChatPanel({props:{documentId:ot[1].id,onSubmit:ot[3]}}),st=new PdfViewer({props:{url:ot[2]}}),{c(){f=element("div"),z=element("div"),p=element("div"),T=element("div"),$=element("div"),G=element("span"),et=text("description"),I=space(),S=element("div"),g=element("h1"),C=text(w),y=space(),d=element("p"),_=text("Document ID: "),r=text(s),P=space(),R=element("a"),A=element("span"),t=text("arrow_back"),l=space(),a=element("span"),n=text("Back to Documents"),u=space(),E=element("div"),i=element("div"),create_component(M.$$.fragment),V=space(),Y=element("div"),Q=element("div"),create_component(st.$$.fragment),this.h()},l(nt){f=claim_element(nt,"DIV",{class:!0});var dt=children(f);z=claim_element(dt,"DIV",{class:!0});var bt=children(z);p=claim_element(bt,"DIV",{class:!0});var yt=children(p);T=claim_element(yt,"DIV",{class:!0});var U=children(T);$=claim_element(U,"DIV",{class:!0});var c=children($);G=claim_element(c,"SPAN",{class:!0});var h=children(G);et=claim_text(h,"description"),h.forEach(detach),c.forEach(detach),I=claim_space(U),S=claim_element(U,"DIV",{});var v=children(S);g=claim_element(v,"H1",{class:!0});var j=children(g);C=claim_text(j,w),j.forEach(detach),y=claim_space(v),d=claim_element(v,"P",{class:!0});var D=children(d);_=claim_text(D,"Document ID: "),r=claim_text(D,s),D.forEach(detach),v.forEach(detach),U.forEach(detach),P=claim_space(yt),R=claim_element(yt,"A",{href:!0,class:!0});var q=children(R);A=claim_element(q,"SPAN",{class:!0});var H=children(A);t=claim_text(H,"arrow_back"),H.forEach(detach),l=claim_space(q),a=claim_element(q,"SPAN",{});var K=children(a);n=claim_text(K,"Back to Documents"),K.forEach(detach),q.forEach(detach),yt.forEach(detach),bt.forEach(detach),u=claim_space(dt),E=claim_element(dt,"DIV",{class:!0,style:!0});var X=children(E);i=claim_element(X,"DIV",{class:!0});var L=children(i);claim_component(M.$$.fragment,L),L.forEach(detach),V=claim_space(X),Y=claim_element(X,"DIV",{class:!0});var k=children(Y);Q=claim_element(k,"DIV",{class:!0});var e=children(Q);claim_component(st.$$.fragment,e),e.forEach(detach),k.forEach(detach),X.forEach(detach),dt.forEach(detach),this.h()},h(){attr(G,"class","material-icons text-white"),attr($,"class","w-12 h-12 bg-gradient-to-br from-primary-500 to-accent-500 rounded-xl flex items-center justify-center shadow-soft"),attr(g,"class","text-2xl font-bold text-secondary-800"),attr(d,"class","text-secondary-500"),attr(T,"class","flex items-center space-x-4"),attr(A,"class","material-icons text-sm"),attr(R,"href","/documents"),attr(R,"class","btn-secondary flex items-center space-x-2"),attr(p,"class","flex items-center justify-between"),attr(z,"class","glass-effect rounded-2xl p-6 shadow-large"),attr(i,"class","lg:col-span-1 chat-panel-wrapper h-full overflow-hidden"),attr(Q,"class","glass-effect rounded-2xl overflow-hidden shadow-large h-full"),attr(Y,"class","lg:col-span-2"),attr(E,"class","grid grid-cols-1 lg:grid-cols-3 gap-6"),set_style(E,"height","calc(100vh - 200px)"),attr(f,"class","space-y-6")},m(nt,dt){insert_hydration(nt,f,dt),append_hydration(f,z),append_hydration(z,p),append_hydration(p,T),append_hydration(T,$),append_hydration($,G),append_hydration(G,et),append_hydration(T,I),append_hydration(T,S),append_hydration(S,g),append_hydration(g,C),append_hydration(S,y),append_hydration(S,d),append_hydration(d,_),append_hydration(d,r),append_hydration(p,P),append_hydration(p,R),append_hydration(R,A),append_hydration(A,t),append_hydration(R,l),append_hydration(R,a),append_hydration(a,n),append_hydration(f,u),append_hydration(f,E),append_hydration(E,i),mount_component(M,i,null),append_hydration(E,V),append_hydration(E,Y),append_hydration(Y,Q),mount_component(st,Q,null),ft=!0},p:noop,i(nt){ft||(transition_in(M.$$.fragment,nt),transition_in(st.$$.fragment,nt),ft=!0)},o(nt){transition_out(M.$$.fragment,nt),transition_out(st.$$.fragment,nt),ft=!1},d(nt){nt&&detach(f),destroy_component(M),destroy_component(st)}}}function create_if_block(ot){let f,z,p,T,$,G,et,I,S,g=ot[0].error+"",w,C,y,d,_,s;return{c(){f=element("div"),z=element("div"),p=element("span"),T=text("error_outline"),$=space(),G=element("h3"),et=text("Error Loading Document"),I=space(),S=element("p"),w=text(g),C=space(),y=element("a"),d=element("span"),_=text("arrow_back"),s=text(`
			Back to Documents`),this.h()},l(r){f=claim_element(r,"DIV",{class:!0});var P=children(f);z=claim_element(P,"DIV",{class:!0});var R=children(z);p=claim_element(R,"SPAN",{class:!0});var A=children(p);T=claim_text(A,"error_outline"),A.forEach(detach),R.forEach(detach),$=claim_space(P),G=claim_element(P,"H3",{class:!0});var t=children(G);et=claim_text(t,"Error Loading Document"),t.forEach(detach),I=claim_space(P),S=claim_element(P,"P",{class:!0});var l=children(S);w=claim_text(l,g),l.forEach(detach),C=claim_space(P),y=claim_element(P,"A",{href:!0,class:!0});var a=children(y);d=claim_element(a,"SPAN",{class:!0});var n=children(d);_=claim_text(n,"arrow_back"),n.forEach(detach),s=claim_text(a,`
			Back to Documents`),a.forEach(detach),P.forEach(detach),this.h()},h(){attr(p,"class","material-icons text-4xl text-red-400"),attr(z,"class","w-24 h-24 bg-gradient-to-br from-red-100 to-red-200 rounded-full flex items-center justify-center mx-auto mb-6"),attr(G,"class","text-xl font-semibold text-secondary-700 mb-2"),attr(S,"class","text-secondary-500 mb-6"),attr(d,"class","material-icons mr-2"),attr(y,"href","/documents"),attr(y,"class","btn-primary"),attr(f,"class","text-center py-16")},m(r,P){insert_hydration(r,f,P),append_hydration(f,z),append_hydration(z,p),append_hydration(p,T),append_hydration(f,$),append_hydration(f,G),append_hydration(G,et),append_hydration(f,I),append_hydration(f,S),append_hydration(S,w),append_hydration(f,C),append_hydration(f,y),append_hydration(y,d),append_hydration(d,_),append_hydration(y,s)},p(r,P){P&1&&g!==(g=r[0].error+"")&&set_data(w,g)},i:noop,o:noop,d(r){r&&detach(f)}}}function create_fragment(ot){let f,z,p,T,$,G;f=new AuthGuard({});const et=[create_if_block,create_if_block_1],I=[];function S(g,w){return g[0].error?0:g[1]?1:-1}return~(p=S(ot))&&(T=I[p]=et[p](ot)),{c(){create_component(f.$$.fragment),z=space(),T&&T.c(),$=empty()},l(g){claim_component(f.$$.fragment,g),z=claim_space(g),T&&T.l(g),$=empty()},m(g,w){mount_component(f,g,w),insert_hydration(g,z,w),~p&&I[p].m(g,w),insert_hydration(g,$,w),G=!0},p(g,[w]){let C=p;p=S(g),p===C?~p&&I[p].p(g,w):(T&&(group_outros(),transition_out(I[C],1,1,()=>{I[C]=null}),check_outros()),~p?(T=I[p],T?T.p(g,w):(T=I[p]=et[p](g),T.c()),transition_in(T,1),T.m($.parentNode,$)):T=null)},i(g){G||(transition_in(f.$$.fragment,g),transition_in(T),G=!0)},o(g){transition_out(f.$$.fragment,g),transition_out(T),G=!1},d(g){destroy_component(f,g),g&&detach(z),~p&&I[p].d(g),g&&detach($)}}}function instance(ot,f,z){let{data:p}=f;const T=p.document,$=p.documentUrl;function G(et,I){sendMessage({role:"user",content:et},{useStreaming:I,documentId:T.id})}return beforeNavigate(resetAll),ot.$$set=et=>{"data"in et&&z(0,p=et.data)},[p,T,$,G]}class Page extends SvelteComponent{constructor(f){super(),init(this,f,instance,create_fragment,safe_not_equal,{data:0})}}export{Page as default};
